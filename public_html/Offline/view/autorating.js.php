<?php
//dezend by http://www.yunlu99.com/
echo 'function view_autorating_data(questionID)' . "\r\n" . '{' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionName = \'<span class=red>*</span>\';' . "\r\n" . '	}' . "\r\n" . '	questionName +=  qQuotaChar(QtnListArray[questionID].questionName);' . "\r\n" . '	questionName += \'&nbsp;<span class=notes>[自动评分题]</span>\';' . "\r\n" . '	dataqtn = "{";' . "\r\n" . '	dataqtn += " questionName:\'"+qJsonCharFilter(questionName)+"\',";' . "\r\n" . '' . "\r\n" . '	//来源问题及选项' . "\r\n" . '	var theBaseID = QtnListArray[questionID].baseID;' . "\r\n" . '	var theBaseQtnArray = QtnListArray[theBaseID];' . "\r\n" . '	var theCheckBoxListArray = CheckBoxListArray[theBaseQtnArray.questionID];' . "\r\n" . '' . "\r\n" . '	var optionAutoArray = [];' . "\r\n" . '	var optionMinMaxArray = [];' . "\r\n" . '	var i=0;' . "\r\n" . '	for( var question_checkboxID in theCheckBoxListArray )' . "\r\n" . '	{' . "\r\n" . '		var theQuestionArray = theCheckBoxListArray[question_checkboxID];' . "\r\n" . '		optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '		optionMinMaxArray[i] = question_checkboxID;' . "\r\n" . '		i++;' . "\r\n" . '	}' . "\r\n" . '	//有其他项' . "\r\n" . '	if( theBaseQtnArray.isHaveOther == 1 )' . "\r\n" . '	{' . "\r\n" . '		optionMinMaxArray[i] = 0;' . "\r\n" . '		var theOtherValue = dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID]];' . "\r\n" . '		if( theOtherValue != \'\' )' . "\r\n" . '		{' . "\r\n" . '			optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText+"("+theOtherValue+")");' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	dataqtn += " qtns:[ ";' . "\r\n" . '	for( var tmp in optionMinMaxArray )' . "\r\n" . '	{' . "\r\n" . '		var optionAutoID = optionMinMaxArray[tmp];' . "\r\n" . '		var optionAutoName = optionAutoArray[optionAutoID];' . "\r\n" . '' . "\r\n" . '		dataqtn += "{ ";' . "\r\n" . '		dataqtn += "optionName:\'"+optionAutoName+"\',";' . "\r\n" . '		' . "\r\n" . '		switch(QtnListArray[questionID].isSelect)' . "\r\n" . '		{' . "\r\n" . '			case 1:  //开放回复' . "\r\n" . '				var the_question_answer_id = \'option_\'+questionID+\'_\'+optionAutoID;' . "\r\n" . '				var the_question_answer_value = dataRow.rows[0][dataIndex[the_question_answer_id]];' . "\r\n" . '				if( the_question_answer_value != \'\' && the_question_answer_value != \'0\' && the_question_answer_value != \'0.00\' )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isHaveOther == 1 && the_question_answer_value < QtnListArray[questionID].maxOption) ' . "\r\n" . '					{' . "\r\n" . '						dataqtn += "optionAnswer:\'"+the_question_answer_value+"("+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID+\'_\'+optionAutoID]])+")\'";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						dataqtn += "optionAnswer:\'"+the_question_answer_value+"\'";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionAnswer:\'跳过\'";' . "\r\n" . '				}' . "\r\n" . '			break;' . "\r\n" . '			case 0:' . "\r\n" . '				var the_question_answer_id = \'option_\'+questionID+\'_\'+optionAutoID;' . "\r\n" . '				var the_question_answer_value = dataRow.rows[0][dataIndex[the_question_answer_id]];' . "\r\n" . '				if( the_question_answer_value != \'0\' && the_question_answer_value != \'\' )' . "\r\n" . '				{' . "\r\n" . '					if( the_question_answer_value != \'99\' )' . "\r\n" . '					{' . "\r\n" . '						var theValue = the_question_answer_value*QtnListArray[questionID].weight;' . "\r\n" . '						if( QtnListArray[questionID].isHaveOther == 1 && theValue < QtnListArray[questionID].maxOption) ' . "\r\n" . '						{' . "\r\n" . '							dataqtn += "optionAnswer:\'"+theValue+"("+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID+\'_\'+optionAutoID]])+")\'";' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							dataqtn += "optionAnswer:\'"+theValue+"\'";' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						dataqtn += "optionAnswer:\'不清楚\'";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionAnswer:\'跳过\'";' . "\r\n" . '				}' . "\r\n" . '			break;' . "\r\n" . '			case 2:' . "\r\n" . '				var the_question_answer_id = \'option_\'+questionID+\'_\'+optionAutoID;' . "\r\n" . '				var the_question_answer_value = dataRow.rows[0][dataIndex[the_question_answer_id]];' . "\r\n" . '				if( the_question_answer_value != \'0\' && the_question_answer_value != \'\' )' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionAnswer:\'"+the_question_answer_value+"\'";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionAnswer:\'跳过\'";' . "\r\n" . '				}' . "\r\n" . '			break;' . "\r\n" . '		}' . "\r\n" . '		dataqtn += "},";' . "\r\n" . '	}' . "\r\n" . '	dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '' . "\r\n" . '	var tplText = \'<table width="100%"><tr><td class="question">{$questionName}</td></tr><tr><td><table cellSpacing=0 cellPadding=0>{foreach $qtns as $i => $qtn}<tr><td class="option">&nbsp;<span class="option">{$qtn.optionName}：</span><font color=red>{$qtn.optionAnswer}</font></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '' . "\r\n" . '    var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '    survey_content_data_html += t.fetch(jsondata);' . "\r\n" . '	jsondata = null;' . "\r\n" . '	optionMinMaxArray = null;' . "\r\n" . '	optionAutoArray = null;' . "\r\n" . '}';

?>
