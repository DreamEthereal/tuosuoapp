<?php
//dezend by http://www.yunlu99.com/
echo 'function view_rank_data(questionID)' . "\r\n" . '{' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var minOption = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionName = \'<span class=red>*</span>\';' . "\r\n" . '		if( QtnListArray[questionID].minOption != 0 )' . "\r\n" . '		{' . "\r\n" . '			 minOption += \'<span class=notes>[最少\'+QtnListArray[questionID].minOption+\'项]</span>\';' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	questionName += qQuotaChar(QtnListArray[questionID].questionName);' . "\r\n" . '	questionName += \'&nbsp;<span class=notes>[排序题]</span>\';' . "\r\n" . '	questionName += minOption;' . "\r\n" . '	dataqtn = "{";' . "\r\n" . '	dataqtn += " questionName:\'"+qJsonCharFilter(questionName)+"\',";' . "\r\n" . '' . "\r\n" . '	if( QtnListArray[questionID].isHaveOther == 1 )' . "\r\n" . '	{' . "\r\n" . '		dataqtn += " isHaveOther:\'\',";' . "\r\n" . '		dataqtn += " otherText:\'"+qJsonCharFilter(QtnListArray[questionID].otherText)+"\',";' . "\r\n" . '		if( dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID]] != \'\' )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " textOtherValue:\'"+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID]])+"\',";' . "\r\n" . '			dataqtn += " optionAnswer_0:\'"+dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_0\']]+"\',";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " textOtherValue:\'\',";' . "\r\n" . '			dataqtn += " optionAnswer_0:\'跳过\',";' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		dataqtn += " isHaveOther:\'none\',";' . "\r\n" . '		dataqtn += " otherText:\'\',";' . "\r\n" . '		dataqtn += " textOtherValue:\'\',";' . "\r\n" . '		dataqtn += " optionAnswer_0:\'\',";' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	if( QtnListArray[questionID].isHaveWhy == 1 )' . "\r\n" . '	{' . "\r\n" . '		dataqtn += " isHaveWhy:\'\',";' . "\r\n" . '		dataqtn += " textWhyValue:\'"+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextWhyValue_\'+questionID]])+"\',";' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		dataqtn += " isHaveWhy:\'none\',";' . "\r\n" . '		dataqtn += " textWhyValue:\'\',";' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	dataqtn += " qtns:[ ";' . "\r\n" . '	for( var question_rankID in RankListArray[questionID] )' . "\r\n" . '	{' . "\r\n" . '		dataqtn += "{ ";' . "\r\n" . '		dataqtn += "optionName:\'"+qJsonCharFilter(RankListArray[questionID][question_rankID].optionName)+"\',";' . "\r\n" . '		var the_question_answer_id = \'option_\'+questionID+\'_\'+question_rankID;' . "\r\n" . '		var the_question_answer_value = dataRow.rows[0][dataIndex[the_question_answer_id]];' . "\r\n" . '		if( the_question_answer_value != \'0\' && the_question_answer_value != \'\' )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += "optionAnswer:\'"+the_question_answer_value+"\'";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += "optionAnswer:\'跳过\'";' . "\r\n" . '		}' . "\r\n" . '		dataqtn += "},";' . "\r\n" . '	}' . "\r\n" . '	dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '' . "\r\n" . '	var tplText = \'<table width="100%"><tr><td class="question">{$questionName}</td></tr><tr><td><table cellSpacing=0 cellPadding=0>{foreach $qtns as $i => $qtn}<tr><td class="option">&nbsp;<span class="option">{$qtn.optionName}：</span><font color=red>{$qtn.optionAnswer}</font></td></tr>{/foreach}<tr style="display:{$isHaveOther}"><td class="option">&nbsp;<span class="option">{$otherText}/{$textOtherValue}：</span><font color=red>{$optionAnswer_0}</font></td></tr><tr style="display:{$isHaveWhy}"><td class="option">&nbsp;<span class="option">为什么这么排序：</span><font color=red>{$textWhyValue}</font></td></tr></table></td></tr></table>\';' . "\r\n" . '' . "\r\n" . '    var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '    survey_content_data_html += t.fetch(jsondata);' . "\r\n" . '	jsondata = null;' . "\r\n" . '}';

?>
