<?php
//dezend by http://www.yunlu99.com/
echo 'function view_auto_data(questionID)' . "\r\n" . '{' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var minOption = \'\',maxOption = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionName = \'<span class=red>*</span>\';' . "\r\n" . '		if( QtnListArray[questionID].minOption != 0 )' . "\r\n" . '		{' . "\r\n" . '			 minOption += \'[最少\'+QtnListArray[questionID].minOption+\'项]\';' . "\r\n" . '		}' . "\r\n" . '		if( QtnListArray[questionID].maxOption != 0 )' . "\r\n" . '		{' . "\r\n" . '			 maxOption += \'[最多\'+QtnListArray[questionID].maxOption+\'项]\';' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	questionName += qQuotaChar(QtnListArray[questionID].questionName);' . "\r\n" . '	questionName += \'&nbsp;<span class=notes>[自动选项题]</span>\';' . "\r\n" . '	questionName += \'&nbsp;<span class=notes>\'+minOption+\'</span>\';' . "\r\n" . '	questionName += \'&nbsp;<span class=notes>\'+maxOption+\'</span>\';' . "\r\n" . '	dataqtn = "{";' . "\r\n" . '	dataqtn += " questionName:\'"+qJsonCharFilter(questionName)+"\',";' . "\r\n" . '' . "\r\n" . '	//来源问题及选项' . "\r\n" . '	var theBaseID = QtnListArray[questionID].baseID;' . "\r\n" . '	var theBaseQtnArray = QtnListArray[theBaseID];' . "\r\n" . '	var theCheckBoxListArray = CheckBoxListArray[theBaseQtnArray.questionID];' . "\r\n" . '' . "\r\n" . '	var optionID = \'option_\'+questionID;' . "\r\n" . '	var theOptionValue = dataRow.rows[0][dataIndex[optionID]];' . "\r\n" . '	if( QtnListArray[questionID].isSelect == 1 )  //单选' . "\r\n" . '	{' . "\r\n" . '		if( theOptionValue == \'\' )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " optionName:\'跳过\'";' . "\r\n" . '			dataqtn += "}";' . "\r\n" . '		}' . "\r\n" . '		else if( theOptionValue == \'0\' )  //其他' . "\r\n" . '		{' . "\r\n" . '			var otherID = \'TextOtherValue_\'+theBaseID;' . "\r\n" . '			var theOtherValue = dataRow.rows[0][dataIndex[otherID]];' . "\r\n" . '			if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " optionName:\'"+qJsonCharFilter(theBaseQtnArray.otherText)+"\'";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " optionName:\'"+qJsonCharFilter(theBaseQtnArray.otherText+"("+theOtherValue+")")+"\'";' . "\r\n" . '			}' . "\r\n" . '			dataqtn += "}";' . "\r\n" . '		}' . "\r\n" . '		else if( theOptionValue == \'99999\')' . "\r\n" . '		{' . "\r\n" . '			var negText = ( QtnListArray[questionID].allowType == \'\' ) ? \'以上都不是\' : qJsonCharFilter(QtnListArray[questionID].allowType);' . "\r\n" . '			dataqtn += " optionName:\'"+negText+"\'";' . "\r\n" . '			dataqtn += "}";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " optionName:\'"+qJsonCharFilter(theCheckBoxListArray[theOptionValue].optionName)+"\'";' . "\r\n" . '			dataqtn += "}";' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		var option_value_array = theOptionValue.split(\',\');' . "\r\n" . '		dataqtn += " qtns:[ ";' . "\r\n" . '		for( var question_checkboxID in theCheckBoxListArray )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += "{ ";' . "\r\n" . '			dataqtn += " optionName:\'"+qJsonCharFilter(theCheckBoxListArray[question_checkboxID].optionName)+"\',";' . "\r\n" . '			if( in_array(question_checkboxID,option_value_array))' . "\r\n" . '			{ ' . "\r\n" . '				dataqtn += "optionAnswer:\'1\'";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "optionAnswer:\'0\'";' . "\r\n" . '			}	' . "\r\n" . '			dataqtn += "},";' . "\r\n" . '		}' . "\r\n" . '		if( theBaseQtnArray.isHaveOther == 1 )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += "{ ";' . "\r\n" . '			var otherID = \'TextOtherValue_\'+theBaseID;' . "\r\n" . '			var theOtherValue = dataRow.rows[0][dataIndex[otherID]];' . "\r\n" . '			if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " optionName:\'"+qJsonCharFilter(theBaseQtnArray.otherText)+"\',";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( theOtherValue != \'\' )' . "\r\n" . '				{' . "\r\n" . '					dataqtn += " optionName:\'"+qJsonCharFilter(theBaseQtnArray.otherText+"("+theOtherValue+")")+"\',";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += " optionName:\'"+qJsonCharFilter(theBaseQtnArray.otherText)+"\',";' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			if( theOptionValue == \'\' )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "optionAnswer:\'0\'";' . "\r\n" . '			}' . "\r\n" . '			else if( in_array(0,option_value_array))' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "optionAnswer:\'1\'";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "optionAnswer:\'0\'";' . "\r\n" . '			}	' . "\r\n" . '			dataqtn += "},";' . "\r\n" . '		}' . "\r\n" . '		if( QtnListArray[questionID].isCheckType == 1 )' . "\r\n" . '		{' . "\r\n" . '			var negText = ( QtnListArray[questionID].allowType == \'\' ) ? \'以上都不是\' : qJsonCharFilter(QtnListArray[questionID].allowType);' . "\r\n" . '			dataqtn += "{ ";' . "\r\n" . '			dataqtn += " optionName:\'"+negText+"\',";' . "\r\n" . '			if( in_array(99999,option_value_array))' . "\r\n" . '			{ ' . "\r\n" . '				dataqtn += "optionAnswer:\'1\'";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "optionAnswer:\'0\'";' . "\r\n" . '			}	' . "\r\n" . '			dataqtn += "},";' . "\r\n" . '		}' . "\r\n" . '		dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '		option_value_array = null;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	if( QtnListArray[questionID].isSelect == 1 )  //单选' . "\r\n" . '	{' . "\r\n" . '		var tplText = \'<table width="100%"><tr><td class="question">{$questionName}</td></tr><tr><td><table cellSpacing=0 cellPadding=0><tr><td height=25 class="option">&nbsp;<font color=red>{$optionName}</font></td></tr></table></td></tr></table>\';' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		var tplText = \'<table width="100%"><tr><td class="question">{$questionName}</td></tr><tr><td><table cellSpacing=0 cellPadding=0>{foreach $qtns as $i => $qtn}<tr><td class="option">&nbsp;<span class="option">{$qtn.optionName}：</span><font color=red>{$qtn.optionAnswer}</font></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '    var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '    survey_content_data_html += t.fetch(jsondata);' . "\r\n" . '	jsondata = null;' . "\r\n" . '}';

?>
