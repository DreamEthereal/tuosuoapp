<?php
//dezend by http://www.yunlu99.com/
echo 'function create_fingerdrawing()' . "\r\n" . '{' . "\r\n" . '	var jsonqtn = "";' . "\r\n" . '	jsonqtn += "{";' . "\r\n" . '	if( count(dataRow.rows) != 0 )' . "\r\n" . '	{' . "\r\n" . '		jsonqtn += " value:\'"+dataRow.rows[0][dataIndex[\'fingerFile\']]+"\'";' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		jsonqtn += " value:\'\'";' . "\r\n" . '	}' . "\r\n" . '	jsonqtn += "}";' . "\r\n" . '' . "\r\n" . '	//处理页面字段' . "\r\n" . '	this_fields_list += \'fingerFile|\';' . "\r\n" . '	this_fields_type += \'3|\';' . "\r\n" . '	this_file_list += \'fingerFile|\';' . "\r\n" . '' . "\r\n" . '	if( count(dataRow.rows) != 0 )' . "\r\n" . '	{' . "\r\n" . '		if( dataRow.rows[0][dataIndex[\'fingerFile\']] != \'\' )' . "\r\n" . '		{' . "\r\n" . '			this_size_list += dataRow.rows[0][dataIndex[\'fingerFile\']]+\'###\'+theJoinTime+\'|\';' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			this_size_list += \'null###\'+theJoinTime+\'|\';' . "\r\n" . '		}			' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		this_size_list += \'null###\'+theJoinTime+\'|\';' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//处理提交检查' . "\r\n" . '	check_survey_form_list += "\\tif (!CheckNotNull(document.Survey_Form.fingerFile, \'手写签名\')){return false;} \\n";' . "\r\n" . '' . "\r\n" . '	var tplText = \'<table width="100%" class="pertable" id="question_fingerFile"><tr><td class="question" valign=center>&nbsp;<span class=red>*</span><span class="textEdit" id="questionName_fingerFile">我们需要您签名确认当前这条访问数据的真实性和有效性。</span>&nbsp;<span class=notes>[签名]</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_fingerFile">请点击下面的“签名”按钮，在出现的输入框中手写您的姓名，完成后点击“确定”即可。</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0 width="100%"><tr><td class="answer tdheight" valign=center nowrap><input type="text" readonly id="fingerFile" name="fingerFile" size="20" value="{$value}"/>&nbsp;<input type="button" name="btn_fingerFile" id="btn_fingerFile" value="&nbsp;&nbsp;签名&nbsp;&nbsp;" class=btn onClick="javascript:takefingerFile();"></td></tr><tr><td id="mess_fingerFile"></td></tr></table></td></tr></table>\';' . "\r\n" . '' . "\r\n" . '	var jsondata = eval(\'(\'+jsonqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '	//$(\'#survey_content_container\').append( t.fetch(jsondata));  ' . "\r\n" . '    survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '    jsondata = null;' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function takefingerFile(){' . "\r\n" . '	//文件存储路径' . "\r\n" . '	var theTmpFilePath = rexseeStorage.getRoot()+\'enableq_offline/files/\'+qid+\'/\';' . "\r\n" . '	if( ! rexseeFile.exists(theTmpFilePath) )' . "\r\n" . '	{' . "\r\n" . '		rexseeFile.newDir(theTmpFilePath);' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//当前输入域' . "\r\n" . '    document.getElementById("fingerFile").value = "";' . "\r\n" . '' . "\r\n" . '	var path = theTmpFilePath + qid +\'_f_\'+nickUserId+\'_\'+date(\'YmdHis\',time())+\'.jpg\';' . "\r\n" . '' . "\r\n" . '	var style="path:"+path+";label:手写签名;hint-color:#000000;height:320;line-height:80%;align:center;vertical-align:middle;";' . "\r\n" . '	rexseeFingerDrawing.open(style);' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//Image' . "\r\n" . 'function onFingerDrawingReady(path){' . "\r\n" . '	' . "\r\n" . '	//压缩图片' . "\r\n" . '	rexseeImage.scaleByRate(path,0.5);' . "\r\n" . '	rexseeFile.renameTo(path,path+\'.qf\');' . "\r\n" . '	' . "\r\n" . '	//处理' . "\r\n" . '	var theTmpFilePath = rexseeStorage.getRoot()+\'enableq_offline/files/\'+qid+\'/\';' . "\r\n" . '	var filename = str_replace(theTmpFilePath,\'\',path)+\'.qf\';' . "\r\n" . '    document.getElementById("fingerFile").value = filename;' . "\r\n" . '	document.getElementById("mess_fingerFile").innerHTML = "<font color=red><b>签名成功</b></font>";' . "\r\n" . '	document.getElementById("btn_fingerFile").disabled = true;' . "\r\n" . '}' . "\r\n" . '';

?>
