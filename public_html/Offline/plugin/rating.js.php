<?php
//dezend by http://www.yunlu99.com/
echo 'function create_rating_qtn(questionID)' . "\r\n" . '{' . "\r\n" . '	var theInfoQtnName = qNoScriptString(QtnListArray[questionID].questionName);' . "\r\n" . '' . "\r\n" . '	switch( QtnListArray[questionID].isSelect )' . "\r\n" . '	{' . "\r\n" . '		case 1: //开放回复' . "\r\n" . '			var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0 width=100% id="qtn_table_{$questionID}">{foreach $qtns as $i => $qtn}<tr class=tdheight id="range_rating_{$qtn.optionNameID}_container"><td class="answer tdheight" align="center" valign=center nowrap><input type="number" size=8 name="{$qtn.optionID}" id="{$qtn.optionID}" maxlength="8" onKeyUp="this.value=this.value.replace(/[^\\\\d\\\\.\\\\d]/g,\\\'\\\')" onafterpaste="this.value=this.value.replace(/[^\\\\d\\\\.\\\\d]/g,\\\'\\\')" onblur="jQuery.Check_Survey_Conditions();" value="{$qtn.optionValue}"></td><td class="answer" nowrap>&nbsp;<span class="textEdit" id="optionName_15_{$questionID}_{$qtn.optionNameID}">{$qtn.optionName}</span></td><td width=8></td><td style="display:none" id="TextInput_{$questionID}_{$qtn.optionNameID}" class="answer" nowrap>理由：<input name="TextOtherValue_{$questionID}_{$qtn.optionNameID}" id="TextOtherValue_{$questionID}_{$qtn.optionNameID}" value="{$qtn.otherValue}" type="text" size=20></td><td width=90%></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '		break;' . "\r\n" . '		case 0:' . "\r\n" . '			var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0 id="qtn_table_{$questionID}"><tr class=tdheight style="display:{$isHaveUnitText}"><td>&nbsp;</td><td width=8></td><td colspan="{$colWidth}" class="answer" nowrap><span style="float:left" class="answer">{$unitTextLeft}&nbsp;</span><span style="float:right" class="answer">&nbsp;{$unitTextRight}</span></td><td style="display:{$isHaveUnkown}"></td><td width=10></td><td>&nbsp;</td></tr><tr class=tdheight><td>&nbsp;</td><td width=8></td>{foreach $answers as $j => $answer}<td class="answer" align="center" valign="center" nowrap>{$answer.ratingName}</span></td><td width=10></td>{/foreach}<td class="answer" align="center" valign="center" nowrap style="display:{$isHaveUnkown}">不清楚</span></td><td width=10></td><td>&nbsp;</td></tr>{foreach $qtns as $i => $qtn}<tr class=tdheight id="range_rating_{$qtn.optionNameID}_container"><td class="answer" nowrap valign=center>&nbsp;&nbsp;<span class="textEdit" id="optionName_15_{$questionID}_{$qtn.optionNameID}">{$qtn.optionName}</span></td><td width=8></td>{$qtn.sub_option_list}<td style="display:none" id="TextInput_{$questionID}_{$qtn.optionNameID}" class="answer" nowrap>理由：<input name="TextOtherValue_{$questionID}_{$qtn.optionNameID}" id="TextOtherValue_{$questionID}_{$qtn.optionNameID}" value="{$qtn.otherValue}" type="text" size=20>&nbsp;</td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '		break;' . "\r\n" . '		case 2:  //滑动条' . "\r\n" . '			var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td style="padding-top:10px"><table cellSpacing=0 cellPadding=0 width=100% id="qtn_table_{$questionID}">{foreach $qtns as $i => $qtn}<tr class=tdheight id="range_rating_{$qtn.optionNameID}_container"><td class="answer tdheight" align=right nowrap valign="center">&nbsp;&nbsp;<span class="textEdit" id="optionName_15_{$questionID}_{$qtn.optionNameID}">{$qtn.optionName}</span></td><td width=8></td><td><input name="{$qtn.optionID}" id="{$qtn.optionID}" type="text" value="{$qtn.optionValue}" size=10 onclick="javascript:selslider(this,{$qtn.startScale},{$qtn.endScale});" onblur="jQuery.Check_Survey_Conditions();"></td><td width=90%></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '		break;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//显示题目' . "\r\n" . '	var check_survey_form_no_con_list = \'\';' . "\r\n" . '	var questionRequire = \'\';' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var questionNotes = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionRequire = \'<span class=red>*</span>\';' . "\r\n" . '	}' . "\r\n" . '	questionName = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionName));' . "\r\n" . '	questionNotes = \'[评分题]\';' . "\r\n" . '' . "\r\n" . '	var dataqtn = "{ ";' . "\r\n" . '    dataqtn += " questionID: "+questionID+",";' . "\r\n" . '    dataqtn += " questionRequire: \'"+questionRequire+"\',";' . "\r\n" . '    dataqtn += " questionName: \'"+qShowQtnName(questionName,questionID,1)+"\',";' . "\r\n" . '    dataqtn += " questionNotes: \'"+questionNotes+"\',";' . "\r\n" . '	questionTips = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionNotes));' . "\r\n" . '    dataqtn += " questionTips: \'"+qShowQtnName(questionTips,questionID,2)+"\',";' . "\r\n" . '' . "\r\n" . '	var remove_value_list = \'\';' . "\r\n" . '	switch(QtnListArray[questionID].isSelect)' . "\r\n" . '	{' . "\r\n" . '		case 1:  //开放回复' . "\r\n" . '			var optionTotalNum = count(RankListArray[questionID]);' . "\r\n" . '			var theRankListArray = [];' . "\r\n" . '			if( QtnListArray[questionID].isRandOptions == 1 ) //随机' . "\r\n" . '			{' . "\r\n" . '				 if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '				 {' . "\r\n" . '					 var tmpArray = [];' . "\r\n" . '					 for(var tmp in RankListArray[questionID] )' . "\r\n" . '					 {' . "\r\n" . '						 tmpArray.push(tmp);' . "\r\n" . '					 }' . "\r\n" . '					 var theRandListArray = array_rand(tmpArray,optionTotalNum);' . "\r\n" . '					 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '					 {' . "\r\n" . '						 theRankListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '					 }' . "\r\n" . '					 tmpArray = null;' . "\r\n" . '					 theRandListArray = null;' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					 var tmpArray = [],t=0,theExOptionID=0;' . "\r\n" . '					 for(var tmp in RankListArray[questionID] )' . "\r\n" . '					 {' . "\r\n" . '						 if( t != optionTotalNum-1 )' . "\r\n" . '						 {' . "\r\n" . '							tmpArray.push(tmp);' . "\r\n" . '						 }' . "\r\n" . '						 else' . "\r\n" . '						 {' . "\r\n" . '							theExOptionID = tmp;' . "\r\n" . '						 }' . "\r\n" . '						 t++;' . "\r\n" . '					 }' . "\r\n" . '					 var theRandListArray = array_rand(tmpArray,optionTotalNum-1);' . "\r\n" . '					 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '					 {' . "\r\n" . '						 theRankListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '					 }' . "\r\n" . '					 //互斥项' . "\r\n" . '					 theRankListArray.push(theExOptionID);' . "\r\n" . '					 tmpArray = null;' . "\r\n" . '					 theRandListArray = null;' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				 for( var tmp in RankListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					theRankListArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '			}' . "\r\n" . '			' . "\r\n" . '			dataqtn += " qtns:[ ";' . "\r\n" . '	        var tmp = 0;' . "\r\n" . '	        var lastOptionId = optionTotalNum -1;' . "\r\n" . '			for( var m in theRankListArray )' . "\r\n" . '			{' . "\r\n" . '				var question_rankID = theRankListArray[m];' . "\r\n" . '				var theQuestionArray = RankListArray[questionID][question_rankID];' . "\r\n" . '' . "\r\n" . '				dataqtn += "{";' . "\r\n" . '				if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( tmp != lastOptionId )' . "\r\n" . '					{' . "\r\n" . '						dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var optionName = qJsonCharFilter(theQuestionArray.optionName)+"</span>&nbsp;&nbsp;<span style=\\"vertical-align:middle\\"><input type=text name=\\"TextOtherValue_"+questionID+"\\" id=\\"TextOtherValue_"+questionID+"\\" size=15 value=\\"";' . "\r\n" . '						if( count(dataRow.rows) != 0 )' . "\r\n" . '						{' . "\r\n" . '							optionName += qhtmlspecialchars(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID]]);' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							optionName += "";' . "\r\n" . '						}' . "\r\n" . '						optionName += "\\"></span>";' . "\r\n" . '						dataqtn += "optionName:\'"+optionName+"\',";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				dataqtn += " optionID: \'option_"+questionID+\'_\'+question_rankID+"\',";' . "\r\n" . '				dataqtn += " optionNameID: \'"+question_rankID+"\',";' . "\r\n" . '				if( count(dataRow.rows) != 0 )' . "\r\n" . '				{' . "\r\n" . '					if( dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]] != \'\' && dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]] != \'0\' && dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]] != \'0.00\' )' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " optionValue:\'"+dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]]+"\',";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " optionValue:\'\',";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += " optionValue:\'\',";' . "\r\n" . '				}' . "\r\n" . '				if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " otherValue:\'"+qhtmlspecialchars(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID+\'_\'+question_rankID]])+"\'";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " otherValue:\'\'";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += " otherValue: \'\'";' . "\r\n" . '				}' . "\r\n" . '				dataqtn += "},";' . "\r\n" . '' . "\r\n" . '				//记录移除值' . "\r\n" . '				remove_value_list += "\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '				if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					 remove_value_list += "\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//处理页面字段' . "\r\n" . '				this_fields_list += \'option_\'+questionID+\'_\'+question_rankID+\'|\';' . "\r\n" . '				this_fields_type += \'3|\';' . "\r\n" . '				if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					this_fields_list += \'TextOtherValue_\'+questionID+\'_\'+question_rankID+\'|\';' . "\r\n" . '					this_fields_type += \'3|\';' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//矩阵行关联' . "\r\n" . '				var QtnAssCon = _GetQtnAssCond(questionID,question_rankID);' . "\r\n" . '' . "\r\n" . '				//页面检查' . "\r\n" . '				var theInfoOptName = qNoScriptString(theQuestionArray.optionName);' . "\r\n" . '				if( QtnAssCon != \'\' )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '					{' . "\r\n" . '						if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							if( tmp != lastOptionId )' . "\r\n" . '							{' . "\r\n" . '								check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '					{' . "\r\n" . '						if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;} \\n";' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							if( tmp != lastOptionId )' . "\r\n" . '							{' . "\r\n" . '								check_survey_form_no_con_list += "\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;} \\n";' . "\r\n" . '							}' . "\r\n" . '						}						' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (!CheckIsValue(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\',"+QtnListArray[questionID].startScale+","+QtnListArray[questionID].endScale+")){return false;} \\n";' . "\r\n" . '				' . "\r\n" . '				//其他项' . "\r\n" . '				if( QtnListArray[questionID].isCheckType == 1 && tmp == lastOptionId )' . "\r\n" . '				{' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (Trim(document.Survey_Form.TextOtherValue_"+questionID+".value) != \'\' )\\n\\t{\\n\\t\\tif (!CheckNotNull(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;} \\n\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (Trim(document.Survey_Form.option_"+questionID+"_"+question_rankID+".value) != \'\' )\\n\\t{\\n\\t\\tif (!CheckNotNull(document.Survey_Form.TextOtherValue_"+questionID+",\'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\telse\\n\\t{\\n\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n\\t}\\n";' . "\r\n" . '				}' . "\r\n" . '						' . "\r\n" . '				//有说明理由项' . "\r\n" . '				if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					var theMarginValue  = QtnListArray[questionID].maxOption;' . "\r\n" . '' . "\r\n" . '					//输入检查' . "\r\n" . '					check_survey_form_no_con_list += "\\tif ( Number(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+".value) <= "+theMarginValue+" && Trim(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+".value) != \'\' )\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t{\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t\\tif(!CheckNotNull(document.Survey_Form."+\'TextOtherValue_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+\' - \'+QtnListArray[questionID].maxOption+"分以下的理由\')){return false;}\\n\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\telse\\n\\t{\\n\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+\'_\'+question_rankID+");\\n\\t}\\n";' . "\r\n" . '' . "\r\n" . '					//控制理由项的显示' . "\r\n" . '					check_survey_conditions_list +=  "\\tif( Number(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+".value) <= "+theMarginValue+" && Trim(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+".value) != \'\' )\\n";' . "\r\n" . '					check_survey_conditions_list += "\\t{\\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\'#TextInput_"+questionID+\'_\'+question_rankID+"\').show();\\n\\t} \\n";' . "\r\n" . '					check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\'#TextInput_"+questionID+\'_\'+question_rankID+"\').hide();\\n\\t} \\n";' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//矩阵行关联' . "\r\n" . '				if( QtnAssCon != \'\' )' . "\r\n" . '				{' . "\r\n" . '					check_survey_conditions_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\\"#range_rating_"+question_rankID+"_container\\").hide();\\n";			' . "\r\n" . '					check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '					//评分有其他项' . "\r\n" . '					if( QtnListArray[questionID].isCheckType == 1 && tmp == lastOptionId )' . "\r\n" . '					{' . "\r\n" . '						check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '					}' . "\r\n" . '					//有说明理由项' . "\r\n" . '					if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '					{' . "\r\n" . '						check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '					}' . "\r\n" . '					check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '					check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\\"#range_rating_"+question_rankID+"_container\\").show();\\n\\t} \\n";' . "\r\n" . '				}' . "\r\n" . '				tmp++;' . "\r\n" . '			}' . "\r\n" . '			dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '			if( QtnListArray[questionID].isCheckType == 1 )' . "\r\n" . '			{' . "\r\n" . '				this_fields_list += \'TextOtherValue_\'+questionID+\'|\';' . "\r\n" . '				this_fields_type += \'3|\';' . "\r\n" . '				remove_value_list +="\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '			}' . "\r\n" . '			//改变背景颜色' . "\r\n" . '			check_survey_conditions_list += "\\tchangeMaskingSingleBgColor("+questionID+");\\n";' . "\r\n" . '		break;' . "\r\n" . '		case 0:   //刻度选择' . "\r\n" . '			var Answer = [];' . "\r\n" . '			var answers = " answers:[";' . "\r\n" . '			var tmp =0;' . "\r\n" . '		    if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '			{' . "\r\n" . '				for(var i= QtnListArray[questionID].startScale;i<=QtnListArray[questionID].endScale;i++)' . "\r\n" . '				{' . "\r\n" . '					answers += "{";' . "\r\n" . '					answers += " ratingName:\'"+QtnListArray[questionID].weight*i +"\'";' . "\r\n" . '					answers += "},";' . "\r\n" . '					Answer.push(i);' . "\r\n" . '					tmp++;' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				for(var i= QtnListArray[questionID].endScale;i>=QtnListArray[questionID].startScale;i--)' . "\r\n" . '				{' . "\r\n" . '					answers += "{";' . "\r\n" . '					answers += " ratingName:\'"+QtnListArray[questionID].weight*i +"\'";' . "\r\n" . '					answers += "},";' . "\r\n" . '					Answer.push(i);' . "\r\n" . '					tmp++;' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '	' . "\r\n" . '			//两端文本' . "\r\n" . '			if( Trim(QtnListArray[questionID].unitText) == \'\' )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isHaveUnitText: \'none\',";' . "\r\n" . '				dataqtn += " unitTextLeft: \'\',";' . "\r\n" . '				dataqtn += " unitTextRight: \'\',";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isHaveUnitText: \'\',";' . "\r\n" . '				var theUnitText = QtnListArray[questionID].unitText.split(\'###\');' . "\r\n" . '				dataqtn += " unitTextLeft: \'"+theUnitText[0]+"\',";' . "\r\n" . '				dataqtn += " unitTextRight: \'"+theUnitText[1]+"\',";' . "\r\n" . '			}' . "\r\n" . '			dataqtn += " colWidth: "+tmp*2+",";' . "\r\n" . '' . "\r\n" . '			//不清楚			' . "\r\n" . '			if( QtnListArray[questionID].isHaveUnkown == 1 ) ' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isHaveUnkown: \'\',";' . "\r\n" . '				Answer.push(99);' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isHaveUnkown: \'none\',";' . "\r\n" . '			}' . "\r\n" . '			dataqtn += answers.substr(0,answers.length-1)+"], ";' . "\r\n" . '' . "\r\n" . '			var optionTotalNum = count(RankListArray[questionID]);' . "\r\n" . '			var theRankListArray = [];' . "\r\n" . '			if( QtnListArray[questionID].isRandOptions == 1 ) //随机' . "\r\n" . '			{' . "\r\n" . '				 if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '				 {' . "\r\n" . '					 var tmpArray = [];' . "\r\n" . '					 for(var tmp in RankListArray[questionID] )' . "\r\n" . '					 {' . "\r\n" . '						 tmpArray.push(tmp);' . "\r\n" . '					 }' . "\r\n" . '					 var theRandListArray = array_rand(tmpArray,optionTotalNum);' . "\r\n" . '					 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '					 {' . "\r\n" . '						 theRankListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '					 }' . "\r\n" . '					 tmpArray = null;' . "\r\n" . '					 theRandListArray = null;' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					 var tmpArray = [],t=0,theExOptionID=0;' . "\r\n" . '					 for(var tmp in RankListArray[questionID] )' . "\r\n" . '					 {' . "\r\n" . '						 if( t != optionTotalNum-1 )' . "\r\n" . '						 {' . "\r\n" . '							tmpArray.push(tmp);' . "\r\n" . '						 }' . "\r\n" . '						 else' . "\r\n" . '						 {' . "\r\n" . '							theExOptionID = tmp;' . "\r\n" . '						 }' . "\r\n" . '						 t++;' . "\r\n" . '					 }' . "\r\n" . '					 var theRandListArray = array_rand(tmpArray,optionTotalNum-1);' . "\r\n" . '					 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '					 {' . "\r\n" . '						 theRankListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '					 }' . "\r\n" . '					 //互斥项' . "\r\n" . '					 theRankListArray.push(theExOptionID);' . "\r\n" . '					 tmpArray = null;' . "\r\n" . '					 theRandListArray = null;' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				 for( var tmp in RankListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					theRankListArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '			}' . "\r\n" . '			' . "\r\n" . '			var tmp = 0;' . "\r\n" . '			var lastOptionId = optionTotalNum -1;' . "\r\n" . '			var theOptionIdArray = [];' . "\r\n" . '			dataqtn += " qtns:[ ";' . "\r\n" . '			for( var m in theRankListArray )' . "\r\n" . '			{' . "\r\n" . '				var question_rankID = theRankListArray[m];' . "\r\n" . '				var theQuestionArray = RankListArray[questionID][question_rankID];' . "\r\n" . '				theOptionIdArray.push(question_rankID);' . "\r\n" . '				dataqtn += "{";' . "\r\n" . '				if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( tmp != lastOptionId )' . "\r\n" . '					{' . "\r\n" . '						dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var optionName = qJsonCharFilter(theQuestionArray.optionName)+"</span>&nbsp;&nbsp;<span style=\\"vertical-align:middle\\"><input type=text name=\\"TextOtherValue_"+questionID+"\\" id=\\"TextOtherValue_"+questionID+"\\" size=15 value=\\"";' . "\r\n" . '						if( count(dataRow.rows) != 0 )' . "\r\n" . '						{' . "\r\n" . '							optionName += qhtmlspecialchars(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID]]);' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							optionName += "";' . "\r\n" . '						}' . "\r\n" . '						optionName += "\\"></span>";' . "\r\n" . '						dataqtn += "optionName:\'"+optionName+"\',";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				dataqtn += " optionNameID:\'"+ question_rankID +"\',";' . "\r\n" . '				' . "\r\n" . '				var sub_option_list = \'\';' . "\r\n" . '				for( var optionValue in  Answer )' . "\r\n" . '				{' . "\r\n" . '					var optionID = \'option_\'+questionID+\'_\'+question_rankID;' . "\r\n" . '					sub_option_list += \'<td class="answer" align="center"><input type="radio" value="\'+Answer[optionValue]+\'" name="\'+optionID+\'" id="\'+optionID+\'" onclick="jQuery.Check_Survey_Conditions()"\';' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						if( dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]] != \'0\' && dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]] == Answer[optionValue].toString() )' . "\r\n" . '						{' . "\r\n" . '							sub_option_list += \'checked\';  //checked' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							sub_option_list += \'\';' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						sub_option_list += \'\';' . "\r\n" . '					}' . "\r\n" . '					sub_option_list += \'></td><td width=10></td>\';' . "\r\n" . '				}' . "\r\n" . '				dataqtn += " sub_option_list:\'"+ sub_option_list +"\',";' . "\r\n" . '				if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " otherValue:\'"+qhtmlspecialchars(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID+\'_\'+question_rankID]])+"\'";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " otherValue:\'\'";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += " otherValue:\'\'";' . "\r\n" . '				}' . "\r\n" . '				dataqtn += "},";' . "\r\n" . '' . "\r\n" . '				//处理页面字段' . "\r\n" . '				this_fields_list += \'option_\'+questionID+\'_\'+question_rankID+\'|\';' . "\r\n" . '				this_fields_type += \'1|\';' . "\r\n" . '				if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					this_fields_list += \'TextOtherValue_\'+questionID+\'_\'+question_rankID+\'|\';' . "\r\n" . '					this_fields_type += \'3|\';' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//记录移除值' . "\r\n" . '				remove_value_list +="\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '				if( QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					 remove_value_list +="\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//矩阵行关联' . "\r\n" . '				var QtnAssCon = _GetQtnAssCond(questionID,question_rankID);' . "\r\n" . '				' . "\r\n" . '				//页面检查' . "\r\n" . '				if( QtnAssCon != \'\' )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '					{' . "\r\n" . '						if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tif (!CheckRadioNoClick(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							if( tmp != lastOptionId )' . "\r\n" . '							{' . "\r\n" . '								check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t\\tif (!CheckRadioNoClick(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '					{' . "\r\n" . '						if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif (!CheckRadioNoClick(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n";' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							if( tmp != lastOptionId )' . "\r\n" . '							{' . "\r\n" . '								check_survey_form_no_con_list += "\\tif (!CheckRadioNoClick(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n";' . "\r\n" . '							}' . "\r\n" . '						}							' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				' . "\r\n" . '				//有说明理由项' . "\r\n" . '				if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '				{' . "\r\n" . '					var theMarginValue  = QtnListArray[questionID].maxOption / QtnListArray[questionID].weight;' . "\r\n" . '' . "\r\n" . '					//输入检查' . "\r\n" . '					check_survey_form_no_con_list += "\\tif ( getRatingValue(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+") <= "+theMarginValue+" && getRatingValue(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+") != 0 )\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t{\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t\\tif(!CheckNotNull(document.Survey_Form."+\'TextOtherValue_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+\' - \'+QtnListArray[questionID].maxOption+"分以下的理由\')){return false;}\\n\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\telse\\n\\t{\\n\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+\'_\'+question_rankID+");\\n\\t}\\n";' . "\r\n" . '' . "\r\n" . '					//控制理由项的显示' . "\r\n" . '					check_survey_conditions_list +=  "\\tif( getRatingValue(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+") <= "+theMarginValue+" && getRatingValue(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+") != 0 )\\n";' . "\r\n" . '					check_survey_conditions_list += "\\t{\\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\'#TextInput_"+questionID+\'_\'+question_rankID+"\').show();\\n\\t} \\n";' . "\r\n" . '					check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\'#TextInput_"+questionID+\'_\'+question_rankID+"\').hide();\\n\\t} \\n";' . "\r\n" . '				}' . "\r\n" . '				if( QtnListArray[questionID].isCheckType == 1 && tmp == lastOptionId )' . "\r\n" . '				{' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (Trim(document.Survey_Form.TextOtherValue_"+questionID+".value) != \'\' )\\n\\t{\\n\\t\\tif (!CheckRadioNoClick(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (getRadioCheckBoxValue(document.Survey_Form.option_"+questionID+"_"+question_rankID+") != \'\' )\\n\\t{\\n\\t\\tif (!CheckNotNull(document.Survey_Form.TextOtherValue_"+questionID+",\'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\telse\\n\\t{\\n\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n\\t}\\n";' . "\r\n" . '				}' . "\r\n" . '				//矩阵行关联' . "\r\n" . '				if( QtnAssCon != \'\' )' . "\r\n" . '				{' . "\r\n" . '					check_survey_conditions_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\\"#range_rating_"+question_rankID+"_container\\").hide();\\n";			' . "\r\n" . '					check_survey_conditions_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '					//评分有其他项' . "\r\n" . '					if( QtnListArray[questionID].isCheckType == 1 && tmp == lastOptionId )' . "\r\n" . '					{' . "\r\n" . '						check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '					}' . "\r\n" . '					//有说明理由项' . "\r\n" . '					if(QtnListArray[questionID].isHaveOther == 1)' . "\r\n" . '					{' . "\r\n" . '						check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '					}' . "\r\n" . '					check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '					check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\\"#range_rating_"+question_rankID+"_container\\").show();\\n\\t} \\n";' . "\r\n" . '				}' . "\r\n" . '				tmp++;' . "\r\n" . '			}' . "\r\n" . '			dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '			//连续回复' . "\r\n" . '			if( QtnListArray[questionID].isContInvalid == 1 && QtnListArray[questionID].contInvalidValue != 0 )' . "\r\n" . '			{' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (!CheckRangeIsContInvalid("+questionID+","+min(theOptionIdArray)+","+max(theOptionIdArray)+",\'"+theInfoQtnName+"\',"+QtnListArray[questionID].contInvalidValue+")){return false;} \\n";' . "\r\n" . '			}' . "\r\n" . '			if( QtnListArray[questionID].isCheckType == 1 )' . "\r\n" . '			{' . "\r\n" . '				this_fields_list += \'TextOtherValue_\'+questionID+\'|\';' . "\r\n" . '				this_fields_type += \'3|\';' . "\r\n" . '				remove_value_list +="\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '			}' . "\r\n" . '			Answer = null;' . "\r\n" . '			//改变背景颜色' . "\r\n" . '			check_survey_conditions_list += "\\tchangeMaskingRatingBgColor("+questionID+");\\n";' . "\r\n" . '		break;' . "\r\n" . '		case 2:  //滑动条' . "\r\n" . '			var optionTotalNum = count(RankListArray[questionID]);' . "\r\n" . '			var theRankListArray = [];' . "\r\n" . '			if( QtnListArray[questionID].isRandOptions == 1 ) //随机' . "\r\n" . '			{' . "\r\n" . '				 if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '				 {' . "\r\n" . '					 var tmpArray = [];' . "\r\n" . '					 for(var tmp in RankListArray[questionID] )' . "\r\n" . '					 {' . "\r\n" . '						 tmpArray.push(tmp);' . "\r\n" . '					 }' . "\r\n" . '					 var theRandListArray = array_rand(tmpArray,optionTotalNum);' . "\r\n" . '					 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '					 {' . "\r\n" . '						 theRankListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '					 }' . "\r\n" . '					 tmpArray = null;' . "\r\n" . '					 theRandListArray = null;' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					 var tmpArray = [],t=0,theExOptionID=0;' . "\r\n" . '					 for(var tmp in RankListArray[questionID] )' . "\r\n" . '					 {' . "\r\n" . '						 if( t != optionTotalNum-1 )' . "\r\n" . '						 {' . "\r\n" . '							tmpArray.push(tmp);' . "\r\n" . '						 }' . "\r\n" . '						 else' . "\r\n" . '						 {' . "\r\n" . '							theExOptionID = tmp;' . "\r\n" . '						 }' . "\r\n" . '						 t++;' . "\r\n" . '					 }' . "\r\n" . '					 var theRandListArray = array_rand(tmpArray,optionTotalNum-1);' . "\r\n" . '					 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '					 {' . "\r\n" . '						 theRankListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '					 }' . "\r\n" . '					 //互斥项' . "\r\n" . '					 theRankListArray.push(theExOptionID);' . "\r\n" . '					 tmpArray = null;' . "\r\n" . '					 theRandListArray = null;' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				 for( var tmp in RankListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					theRankListArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '			}' . "\r\n" . '			' . "\r\n" . '			dataqtn += " qtns:[ ";' . "\r\n" . '			var tmp = 0;' . "\r\n" . '			var lastOptionId = optionTotalNum -1;' . "\r\n" . '			for( var m in theRankListArray )' . "\r\n" . '			{' . "\r\n" . '				var question_rankID = theRankListArray[m];' . "\r\n" . '				var theQuestionArray = RankListArray[questionID][question_rankID];' . "\r\n" . '' . "\r\n" . '				dataqtn += "{";' . "\r\n" . '				if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( tmp != lastOptionId )' . "\r\n" . '					{' . "\r\n" . '						dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var optionName = qJsonCharFilter(theQuestionArray.optionName)+"</span>&nbsp;&nbsp;<span style=\\"vertical-align:middle\\"><input type=text name=\\"TextOtherValue_"+questionID+"\\" id=\\"TextOtherValue_"+questionID+"\\" size=15 value=\\"";' . "\r\n" . '						if( count(dataRow.rows) != 0 )' . "\r\n" . '						{' . "\r\n" . '							optionName += qhtmlspecialchars(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID]]);' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							optionName += "";' . "\r\n" . '						}' . "\r\n" . '						optionName += "\\"></span>";' . "\r\n" . '						dataqtn += "optionName:\'"+optionName+"\',";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				dataqtn += " optionID: \'option_"+questionID+\'_\'+question_rankID+"\',";' . "\r\n" . '				dataqtn += " optionNameID: \'"+question_rankID+"\',";' . "\r\n" . '				if( count(dataRow.rows) != 0 )' . "\r\n" . '				{' . "\r\n" . '					if( dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]] != \'0\' && dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]] != \'\' )' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " optionValue:\'"+dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_rankID]]+"\',";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						dataqtn += " optionValue:\'\',";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					dataqtn += " optionValue:\'\',";' . "\r\n" . '				}' . "\r\n" . '				dataqtn += " startScale: \'"+QtnListArray[questionID].startScale+"\',";' . "\r\n" . '				dataqtn += " endScale: \'"+QtnListArray[questionID].endScale+"\'";' . "\r\n" . '				dataqtn += "},";' . "\r\n" . '' . "\r\n" . '' . "\r\n" . '				//记录移除值' . "\r\n" . '				remove_value_list +="\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '				//处理页面字段' . "\r\n" . '				this_fields_list += \'option_\'+questionID+\'_\'+question_rankID+\'|\';' . "\r\n" . '				this_fields_type += \'3|\';' . "\r\n" . '' . "\r\n" . '				//矩阵行关联' . "\r\n" . '				var QtnAssCon = _GetQtnAssCond(questionID,question_rankID);' . "\r\n" . '' . "\r\n" . '				//页面检查' . "\r\n" . '				var theInfoOptName = qNoScriptString(theQuestionArray.optionName);' . "\r\n" . '				if( QtnAssCon != \'\' )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '					{' . "\r\n" . '						if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							if( tmp != lastOptionId )' . "\r\n" . '							{' . "\r\n" . '								check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '								check_survey_form_no_con_list += "\\t\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isRequired == 1)' . "\r\n" . '					{' . "\r\n" . '						if( QtnListArray[questionID].isCheckType != 1 )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;} \\n";' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							if( tmp != lastOptionId )' . "\r\n" . '							{' . "\r\n" . '								check_survey_form_no_con_list += "\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;} \\n";' . "\r\n" . '							}' . "\r\n" . '						}						' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (!CheckNumber(document.Survey_Form."+\'option_\'+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\',"+QtnListArray[questionID].startScale+","+QtnListArray[questionID].endScale+")){return false;} \\n";' . "\r\n" . '' . "\r\n" . '				if( QtnListArray[questionID].isCheckType == 1 && tmp == lastOptionId )' . "\r\n" . '				{' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (Trim(document.Survey_Form.TextOtherValue_"+questionID+".value) != \'\' )\\n\\t{\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t\\tif (!CheckNotNull(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\')){return false;} \\n";' . "\r\n" . '					var theMinScale = QtnListArray[questionID].startScale + 1;' . "\r\n" . '					check_survey_form_no_con_list += "\\t\\tif (!CheckNumber(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+", \'"+theInfoQtnName+\' - \'+theInfoOptName+"\',"+theMinScale+","+QtnListArray[questionID].endScale+")){return false;} \\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (Number(document.Survey_Form.option_"+questionID+"_"+question_rankID+".value) != \'\' )\\n\\t{\\n\\t\\tif (!CheckNotNull(document.Survey_Form.TextOtherValue_"+questionID+",\'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t}\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\telse\\n\\t{\\n\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n\\t}\\n";' . "\r\n" . '				}' . "\r\n" . '				//矩阵行关联' . "\r\n" . '				if( QtnAssCon != \'\' )' . "\r\n" . '				{' . "\r\n" . '					check_survey_conditions_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\\"#range_rating_"+question_rankID+"_container\\").hide();\\n";			' . "\r\n" . '					check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+question_rankID+");\\n";' . "\r\n" . '					//评分有其他项' . "\r\n" . '					if( QtnListArray[questionID].isCheckType == 1 && tmp == lastOptionId )' . "\r\n" . '					{' . "\r\n" . '						check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '					}' . "\r\n" . '					check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '					check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '					check_survey_conditions_list += "\\t\\t$(\\"#range_rating_"+question_rankID+"_container\\").show();\\n\\t} \\n";' . "\r\n" . '				}' . "\r\n" . '				tmp++' . "\r\n" . '			}' . "\r\n" . '			if( QtnListArray[questionID].isCheckType == 1 )' . "\r\n" . '			{' . "\r\n" . '				this_fields_list += \'TextOtherValue_\'+questionID+\'|\';' . "\r\n" . '				this_fields_type += \'3|\';' . "\r\n" . '				remove_value_list +="\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '			}' . "\r\n" . '			dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '			//改变背景颜色' . "\r\n" . '			check_survey_conditions_list += "\\tchangeMaskingSingleBgColor("+questionID+");\\n";' . "\r\n" . '		break;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//逻辑条件' . "\r\n" . '	var QuestionCon = _GetQuestionCond(questionID,qid);' . "\r\n" . '	if( QuestionCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '' . "\r\n" . '		var check_form_list = "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_form_list += check_survey_form_no_con_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		//移除已回复的值' . "\r\n" . '		check_form_list += "\\telse{\\n";' . "\r\n" . '		check_form_list += remove_value_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		' . "\r\n" . '		check_survey_form_list += check_form_list;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_list += check_survey_form_no_con_list;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//关联关系' . "\r\n" . '	var RelSurveyCon = _GetSurveyValueRelationCond(questionID,qid,\'cn\');' . "\r\n" . '	if( RelSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		//此题存在多个数值关联关系的检查点' . "\r\n" . '		var theRelSurveyCon = RelSurveyCon.split(\'$$$$$$\');' . "\r\n" . '		for( var t in theRelSurveyCon )' . "\r\n" . '		{' . "\r\n" . '			var tRelSurveyCon = theRelSurveyCon[t].split(\'######\');' . "\r\n" . '			if( parseInt(tRelSurveyCon[0]) == 2 ) //空题' . "\r\n" . '			{' . "\r\n" . '				survey_empty_list += tRelSurveyCon[1];' . "\r\n" . '				var theEmptyList = tRelSurveyCon[1].split(\'*\');' . "\r\n" . '				var theEmptyId = parseInt(substr(theEmptyList[7],0,-3));' . "\r\n" . '				if( !IsSamePage(theEmptyId,questionID)) //不在同页' . "\r\n" . '				{' . "\r\n" . '					//空题字段' . "\r\n" . '					this_fields_list += \'option_\'+theEmptyId+\'|\';' . "\r\n" . '					this_fields_type += \'3|\';' . "\r\n" . '					//跑一遍空题的配额表达式' . "\r\n" . '					var theEmptyEndSurveyCon = _GetSurveyQuotaCond(theEmptyId,qid,\'cn\');' . "\r\n" . '					if( theEmptyEndSurveyCon != \'\' )' . "\r\n" . '					{' . "\r\n" . '						survey_quota_list += theEmptyEndSurveyCon;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				theEmptyList = null;' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				survey_quota_list += tRelSurveyCon[1];' . "\r\n" . '			}' . "\r\n" . '			tRelSurveyCon = null;' . "\r\n" . '		}' . "\r\n" . '		theRelSurveyCon = null;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//问卷结束条件' . "\r\n" . '	var EndSurveyCon = _GetSurveyQuotaCond(questionID,qid,\'cn\');' . "\r\n" . '	if( EndSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		survey_quota_list += EndSurveyCon;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '    var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '	//$(\'#survey_content_container\').append( t.fetch(jsondata)); ' . "\r\n" . '	survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '	jsondata = null;' . "\r\n" . '	theQuestionArray = null;' . "\r\n" . '}';

?>
