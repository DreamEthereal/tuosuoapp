<?php
//dezend by http://www.yunlu99.com/
echo '//多行填空' . "\r\n" . 'function create_textarea_qtn(questionID)' . "\r\n" . '{' . "\r\n" . '	var theInfoQtnName = qNoScriptString(QtnListArray[questionID].questionName);' . "\r\n" . '	var questionRequire = \'\';' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var questionNotes = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionRequire = \'<span class=red>*</span>\';' . "\r\n" . '	}' . "\r\n" . '	questionName = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionName));' . "\r\n" . '	questionNotes = \'[多行填空题]\';' . "\r\n" . '' . "\r\n" . '	var jsonqtn = "";' . "\r\n" . '	jsonqtn += "{";' . "\r\n" . '    jsonqtn += " questionName: \'"+qShowQtnName(questionName,questionID,1)+"\',";' . "\r\n" . '	jsonqtn += " questionRequire:\'"+questionRequire+"\',";' . "\r\n" . '	jsonqtn += " questionID:"+questionID+",";' . "\r\n" . '	jsonqtn += " questionNotes:\'"+questionNotes+"\',";' . "\r\n" . '    questionTips = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionNotes));' . "\r\n" . '	jsonqtn += " questionTips:\'"+qShowQtnName(questionTips,questionID,2)+"\',";' . "\r\n" . '	jsonqtn += " optionID:\'option_"+questionID+"\',";' . "\r\n" . '	jsonqtn += " length:\'"+QtnListArray[questionID][\'length\']+"\',";' . "\r\n" . '	jsonqtn += " rows:\'"+QtnListArray[questionID][\'rows\']+"\',";' . "\r\n" . '	if( count(dataRow.rows) != 0 )' . "\r\n" . '	{' . "\r\n" . '		jsonqtn += " value:\'"+qhtmlspecialchars(dataRow.rows[0][dataIndex[\'option_\'+questionID]])+"\'";' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		jsonqtn += " value:\'\'";' . "\r\n" . '	}' . "\r\n" . '	jsonqtn += "}";' . "\r\n" . '	var jsondata = eval(\'(\'+jsonqtn+\')\');' . "\r\n" . '' . "\r\n" . '	//处理页面字段' . "\r\n" . '	this_fields_list += \'option_\'+questionID+\'|\';' . "\r\n" . '	this_fields_type += \'4|\';' . "\r\n" . '' . "\r\n" . '	//处理提交检查' . "\r\n" . '	var check_survey_form_no_con_list = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_no_con_list += "\\tif (!CheckNotNull(document.Survey_Form."+\'option_\'+questionID+", \'"+theInfoQtnName+"\')){return false;} \\n";' . "\r\n" . '	}' . "\r\n" . '	switch( QtnListArray[questionID].isCheckType )' . "\r\n" . '	{' . "\r\n" . '		case 2:  //长度' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (!CheckStringLength(document.Survey_Form."+\'option_\'+questionID+", \'"+theInfoQtnName+"\',"+QtnListArray[questionID].minOption+","+QtnListArray[questionID].maxOption+")){return false;} \\n";' . "\r\n" . '		break;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//逻辑条件' . "\r\n" . '	var QuestionCon = _GetQuestionCond(questionID,qid);' . "\r\n" . '	if( QuestionCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '' . "\r\n" . '		check_form_list = "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_form_list += check_survey_form_no_con_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		//移除已回复的值' . "\r\n" . '		check_form_list += "\\telse{\\n";' . "\r\n" . '		check_form_list +="\\tTextUnInput(document.Survey_Form.option_"+questionID+");\\n";' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '' . "\r\n" . '		check_survey_form_list += check_form_list;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_list += check_survey_form_no_con_list;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0><tr><td class="answer"><textarea name="{$optionID}" id="{$optionID}" cols="{$length}" rows="{$rows}" class="answer">{$value}</textarea></td></tr></table></td></tr></table>\';' . "\r\n" . '' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '	//$(\'#survey_content_container\').append( t.fetch(jsondata));  ' . "\r\n" . '    survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '    jsondata = null;' . "\r\n" . '}' . "\r\n" . '';

?>
