<?php
//dezend by http://www.yunlu99.com/
echo '//矩阵单选' . "\r\n" . 'function create_range_qtn(questionID)' . "\r\n" . '{' . "\r\n" . '	var theInfoQtnName = qNoScriptString(QtnListArray[questionID].questionName);' . "\r\n" . '	if( QtnListArray[questionID].isNeg == 1 ) //反向矩阵' . "\r\n" . '	{' . "\r\n" . '		var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0 id="qtn_table_{$questionID}"><tr class=tdheight><td>&nbsp;</td><td width=8></td>{foreach $answers as $j => $answer}<td class="answer" align="center" valign=center nowrap><span class="textEdit" id="optionName_6_{$questionID}_{$answer.optionNameID}">{$answer.optionName}</span></td><td width=10></td>{/foreach}</tr>{foreach $qtns as $i => $qtn}<tr class=tdheight id="range_range_{$qtn.optionAnswerID}_container"><td class="answer" nowrap valign=center>&nbsp;&nbsp;<span class="textEdit" id="optionAnswer_6_{$questionID}_{$qtn.optionAnswerID}">{$qtn.answerName}</span></td><td width=8></td>{$qtn.sub_option_list}</tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0 id="qtn_table_{$questionID}"><tr class=tdheight><td>&nbsp;</td><td width=8></td>{foreach $answers as $j => $answer}<td class="answer" align="center" valign=center nowrap><span class="textEdit" id="optionAnswer_6_{$questionID}_{$answer.optionAnswerID}">{$answer.answerName}</span></td><td width=10></td>{/foreach}<td>&nbsp;</td></tr>{foreach $qtns as $i => $qtn}<tr class=tdheight id="range_range_{$qtn.optionNameID}_container"><td class="answer" nowrap align="{$qtn.alignDiff}" valign=center>&nbsp;&nbsp;<span class="textEdit" id="optionNameText_6_{$questionID}_{$qtn.optionNameID}_left">{$qtn.optionNameLeft}</span></td><td width=8></td>{$qtn.sub_option_list}<td class="answer" nowrap valign=center>&nbsp;&nbsp;<span class="textEdit" id="optionNameText_6_{$questionID}_{$qtn.optionNameID}_right">{$qtn.optionNameRight}</span></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//显示题目' . "\r\n" . '	var check_survey_form_no_con_list = \'\';' . "\r\n" . '	var questionRequire = \'\';' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var questionNotes = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionRequire = \'<span class=red>*</span>\';' . "\r\n" . '	}' . "\r\n" . '	questionName = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionName));' . "\r\n" . '	questionNotes = \'[矩阵单选题]\';' . "\r\n" . '	var dataqtn = "{ ";' . "\r\n" . '	dataqtn += " questionID: "+questionID+",";' . "\r\n" . '	dataqtn += " questionRequire: \'"+questionRequire+"\',";' . "\r\n" . '    dataqtn += " questionName: \'"+qShowQtnName(questionName,questionID,1)+"\',";' . "\r\n" . '	dataqtn += " questionNotes: \'"+questionNotes+"\',";' . "\r\n" . '	questionTips = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionNotes));' . "\r\n" . '	dataqtn += " questionTips: \'"+qShowQtnName(questionTips,questionID,2)+"\',";' . "\r\n" . '	if( QtnListArray[questionID].isNeg == 1 ) //反向矩阵' . "\r\n" . '	{' . "\r\n" . '		var theRadioListArray = [];' . "\r\n" . '		var optionTotalNum = count(OptionListArray[questionID]);' . "\r\n" . '		if( QtnListArray[questionID].isRandOptions == 1 ) //随机' . "\r\n" . '		{' . "\r\n" . '			 if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '			 {' . "\r\n" . '				 var tmpArray = [];' . "\r\n" . '				 for(var tmp in OptionListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					 tmpArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '				 var theRandListArray = array_rand(tmpArray,optionTotalNum);' . "\r\n" . '				 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '				 {' . "\r\n" . '					 theRadioListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '				 }' . "\r\n" . '				 tmpArray = null;' . "\r\n" . '				 theRandListArray = null;' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				  var tmpArray = [],t=0,theExOptionID=0;' . "\r\n" . '				  for(var tmp in OptionListArray[questionID] )' . "\r\n" . '				  {' . "\r\n" . '					 if( t != optionTotalNum-1 )' . "\r\n" . '					 {' . "\r\n" . '						tmpArray.push(tmp);' . "\r\n" . '					 }' . "\r\n" . '					 else' . "\r\n" . '					 {' . "\r\n" . '						theExOptionID = tmp;' . "\r\n" . '					 }' . "\r\n" . '					 t++;' . "\r\n" . '				  }' . "\r\n" . '				  var theRandListArray = array_rand(tmpArray,optionTotalNum-1);' . "\r\n" . '				  for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '				  {' . "\r\n" . '					 theRadioListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '				  }' . "\r\n" . '				  //互斥项' . "\r\n" . '				  theRadioListArray.push(theExOptionID);' . "\r\n" . '				  tmpArray = null;' . "\r\n" . '				  theRandListArray = null;' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			 if( QtnListArray[questionID].isColArrange == 1 )' . "\r\n" . '			 {' . "\r\n" . '				 var tmpArray = [];' . "\r\n" . '				 for(var tmp in OptionListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					 tmpArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '				 var theRandListArray = array_rand(tmpArray,QtnListArray[questionID].perRowCol);' . "\r\n" . '				 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '				 {' . "\r\n" . '					 theRadioListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '				 }' . "\r\n" . '				 tmpArray = null;' . "\r\n" . '				 theRandListArray = null;' . "\r\n" . '			 }' . "\r\n" . '			 else' . "\r\n" . '			 {' . "\r\n" . '				 for( var tmp in OptionListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					theRadioListArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '			 }' . "\r\n" . '		}' . "\r\n" . '' . "\r\n" . '		var remove_value_list = \'\';' . "\r\n" . '		var Option = [];' . "\r\n" . '		var theOptionIdArray = [];' . "\r\n" . '		var tmp = 0;' . "\r\n" . '		var lastOptionId = optionTotalNum -1;' . "\r\n" . '		dataqtn += " answers:[";' . "\r\n" . '		for( var k in theRadioListArray )' . "\r\n" . '		{' . "\r\n" . '			var question_range_optionID = theRadioListArray[k];' . "\r\n" . '			var theQuestionArray = OptionListArray[questionID][question_range_optionID];' . "\r\n" . '			theOptionIdArray.push(question_range_optionID);' . "\r\n" . '' . "\r\n" . '			dataqtn += "{";' . "\r\n" . '			if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( tmp != lastOptionId )' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					var optionName = qJsonCharFilter(theQuestionArray.optionName)+"</span>&nbsp;&nbsp;<span style=\\"vertical-align:middle\\"><input type=text name=\\"TextOtherValue_"+questionID+"\\" id=\\"TextOtherValue_"+questionID+"\\" size=15 value=\\"";' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						optionName += qhtmlspecialchars(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID]]);' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						optionName += "";' . "\r\n" . '					}' . "\r\n" . '					optionName += "\\"></span>";' . "\r\n" . '					dataqtn += "optionName:\'"+optionName+"\',";' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			dataqtn += "optionNameID:"+question_range_optionID+",";' . "\r\n" . '			dataqtn += "},";' . "\r\n" . '			Option.push(question_range_optionID);' . "\r\n" . '' . "\r\n" . '			//记录移除值' . "\r\n" . '			remove_value_list +="\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '' . "\r\n" . '			//处理页面字段' . "\r\n" . '			this_fields_list += \'option_\'+questionID+\'_\'+question_range_optionID+\'|\';' . "\r\n" . '			this_fields_type += \'1|\';' . "\r\n" . '' . "\r\n" . '			//矩阵行关联' . "\r\n" . '			var QtnAssCon = _GetQtnAssCond(questionID,question_range_optionID);' . "\r\n" . '			' . "\r\n" . '			//页面检查' . "\r\n" . '			if( QtnAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '					{' . "\r\n" . '						check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\t\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						if(tmp != lastOptionId )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}			' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '					{' . "\r\n" . '						check_survey_form_no_con_list += "\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form."+\'option_\'+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						if(tmp != lastOptionId )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form."+\'option_\'+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n";' . "\r\n" . '						}' . "\r\n" . '					}					' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			if( QtnListArray[questionID].isHaveOther == 1 && tmp == lastOptionId )' . "\r\n" . '			{' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (Trim(document.Survey_Form.TextOtherValue_"+questionID+".value) != \'\' )\\n\\t{\\n\\t\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n\\t}\\n";' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (getRadioCheckBoxValue(document.Survey_Form.option_"+questionID+"_"+question_range_optionID+") != \'\' )\\n\\t{\\n\\t\\tif (!CheckNotNull(document.Survey_Form.TextOtherValue_"+questionID+",\'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n";' . "\r\n" . '				check_survey_form_no_con_list += "\\t}\\n";' . "\r\n" . '				check_survey_form_no_con_list += "\\telse\\n\\t{\\n\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n\\t}\\n";' . "\r\n" . '		    }' . "\r\n" . '			//矩阵行关联' . "\r\n" . '			if( QtnAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				var colNum = (tmp+1)*2+1;' . "\r\n" . '				var colNumNext = colNum+1;' . "\r\n" . '				check_survey_conditions_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\'#qtn_table_"+questionID+"\').hideColumns(["+colNum+","+colNumNext+"]);\\n";			' . "\r\n" . '				check_survey_conditions_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '				//有文本项' . "\r\n" . '				if( QtnListArray[questionID].isHaveOther == 1 && tmp == lastOptionId )' . "\r\n" . '				{' . "\r\n" . '					check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '				}' . "\r\n" . '				check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '				check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\'#qtn_table_"+questionID+"\').showColumns(["+colNum+","+colNumNext+"]);\\n\\t} \\n";' . "\r\n" . '			}' . "\r\n" . '			tmp++' . "\r\n" . '		}' . "\r\n" . '		dataqtn = dataqtn.substr(0,dataqtn.length-1)+"],";' . "\r\n" . '		dataqtn += " qtns:[ ";' . "\r\n" . '' . "\r\n" . '		for( var question_range_answerID in AnswerListArray[questionID] )' . "\r\n" . '		{' . "\r\n" . '			var theAnswerArray = AnswerListArray[questionID][question_range_answerID];' . "\r\n" . '			dataqtn += "{";' . "\r\n" . '			dataqtn += "answerName:\'"+qJsonCharFilter(theAnswerArray.optionAnswer)+"\',";' . "\r\n" . '			dataqtn += "optionAnswerID:"+question_range_answerID+",";' . "\r\n" . '			var sub_option_list = \'\';' . "\r\n" . '			for( var tmp in Option )' . "\r\n" . '		    {' . "\r\n" . '				var question_range_optionID = Option[tmp];' . "\r\n" . '				sub_option_list += \'<td class="answer" align="center"><input type="radio" onclick="jQuery.Check_Survey_Conditions()" value="\'+question_range_answerID+\'" name="option_\'+questionID+\'_\'+question_range_optionID+\'" id="option_\'+questionID+\'_\'+question_range_optionID+\'" \';' . "\r\n" . '				if( count(dataRow.rows) != 0 )' . "\r\n" . '				{' . "\r\n" . '					if( dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_range_optionID]] != \'0\' && dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_range_optionID]] == question_range_answerID.toString() )' . "\r\n" . '					{' . "\r\n" . '						sub_option_list += \'checked\';  //checked' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						sub_option_list += \'\';' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					sub_option_list += \'\';' . "\r\n" . '				}' . "\r\n" . '				sub_option_list += \'></td><td width=10></td>\';' . "\r\n" . '			 }' . "\r\n" . '		    dataqtn += "sub_option_list:\'"+sub_option_list+"\' ";' . "\r\n" . '			dataqtn += "},";' . "\r\n" . '' . "\r\n" . '			//选项关联' . "\r\n" . '			var OptAssCon = _GetOptAssCond(questionID,question_range_answerID);' . "\r\n" . '			if( OptAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				check_survey_conditions_list += "\\tif("+OptAssCon+")\\n\\t{\\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\\"#range_range_"+question_range_answerID+"_container\\").hide();\\n";' . "\r\n" . '				for( var tmp in Option )' . "\r\n" . '				{' . "\r\n" . '					var question_range_optionID = Option[tmp];' . "\r\n" . '					check_survey_conditions_list += "\\t\\tRadioItemUnClick(document.Survey_Form.option_"+questionID+"_"+question_range_optionID+","+question_range_answerID+");\\n";' . "\r\n" . '				}' . "\r\n" . '				check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '				check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\\"#range_range_"+question_range_answerID+"_container\\").show();\\n\\t} \\n";' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '		if( QtnListArray[questionID].requiredMode == 2 )  //互斥检查' . "\r\n" . '		{' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (!CheckRangeExclusive("+questionID+","+min(theOptionIdArray)+","+max(theOptionIdArray)+",\'"+theInfoQtnName+"\')){return false;} \\n";' . "\r\n" . '		}' . "\r\n" . '		//连续回复' . "\r\n" . '		if( QtnListArray[questionID].isContInvalid == 1 && QtnListArray[questionID].contInvalidValue != 0 )' . "\r\n" . '		{' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (!CheckRangeIsContInvalid("+questionID+","+min(theOptionIdArray)+","+max(theOptionIdArray)+",\'"+theInfoQtnName+"\',"+QtnListArray[questionID].contInvalidValue+")){return false;} \\n";' . "\r\n" . '		}' . "\r\n" . '		if( QtnListArray[questionID].isHaveOther == 1 )' . "\r\n" . '		{' . "\r\n" . '			this_fields_list += \'TextOtherValue_\'+questionID+\'|\';' . "\r\n" . '			this_fields_type += \'3|\';' . "\r\n" . '			remove_value_list +="\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '		}' . "\r\n" . '		' . "\r\n" . '		Option = null;' . "\r\n" . '		theRadioListArray = null;' . "\r\n" . '		theOptionIdArray = null;' . "\r\n" . '		theQuestionArray = null;' . "\r\n" . '		theAnswerArray = null;' . "\r\n" . '' . "\r\n" . '		//改变背景颜色' . "\r\n" . '		check_survey_conditions_list += "\\tchangeMaskingOptBgColor("+questionID+");\\n";' . "\r\n" . '	}' . "\r\n" . '	else //正常矩阵' . "\r\n" . '	{' . "\r\n" . '		var AnswerNum = count(AnswerListArray[questionID]);' . "\r\n" . '		var Answer = [];' . "\r\n" . '		dataqtn += " answers:[";' . "\r\n" . '		for( var question_range_answerID in AnswerListArray[questionID] )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += "{";' . "\r\n" . '			dataqtn += "answerName:\'"+qJsonCharFilter(AnswerListArray[questionID][question_range_answerID].optionAnswer)+"\',";' . "\r\n" . '			dataqtn += "optionAnswerID:"+question_range_answerID+" ";' . "\r\n" . '			dataqtn += "},";' . "\r\n" . '			Answer.push( question_range_answerID );' . "\r\n" . '		}' . "\r\n" . '		dataqtn = dataqtn.substr(0,dataqtn.length-1)+"],";' . "\r\n" . '' . "\r\n" . '		var theRadioListArray = [];' . "\r\n" . '		var optionTotalNum = count(OptionListArray[questionID]);' . "\r\n" . '		if( QtnListArray[questionID].isRandOptions == 1 ) //随机' . "\r\n" . '		{' . "\r\n" . '			 if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '			 {' . "\r\n" . '				 var tmpArray = [];' . "\r\n" . '				 for(var tmp in OptionListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					 tmpArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '				 var theRandListArray = array_rand(tmpArray,optionTotalNum);' . "\r\n" . '				 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '				 {' . "\r\n" . '					 theRadioListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '				 }' . "\r\n" . '				 tmpArray = null;' . "\r\n" . '				 theRandListArray = null;' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				  var tmpArray = [],t=0,theExOptionID=0;' . "\r\n" . '				  for(var tmp in OptionListArray[questionID] )' . "\r\n" . '				  {' . "\r\n" . '					 if( t != optionTotalNum-1 )' . "\r\n" . '					 {' . "\r\n" . '						tmpArray.push(tmp);' . "\r\n" . '					 }' . "\r\n" . '					 else' . "\r\n" . '					 {' . "\r\n" . '						theExOptionID = tmp;' . "\r\n" . '					 }' . "\r\n" . '					 t++;' . "\r\n" . '				  }' . "\r\n" . '				  var theRandListArray = array_rand(tmpArray,optionTotalNum-1);' . "\r\n" . '				  for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '				  {' . "\r\n" . '					 theRadioListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '				  }' . "\r\n" . '				  //互斥项' . "\r\n" . '				  theRadioListArray.push(theExOptionID);' . "\r\n" . '				  tmpArray = null;' . "\r\n" . '				  theRandListArray = null;' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			 if( QtnListArray[questionID].isColArrange == 1 )' . "\r\n" . '			 {' . "\r\n" . '				 var tmpArray = [];' . "\r\n" . '				 for(var tmp in OptionListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					 tmpArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '				 var theRandListArray = array_rand(tmpArray,QtnListArray[questionID].perRowCol);' . "\r\n" . '				 for( var i=0;i<theRandListArray.length;i++)' . "\r\n" . '				 {' . "\r\n" . '					 theRadioListArray.push(tmpArray[theRandListArray[i]]);' . "\r\n" . '				 }' . "\r\n" . '				 tmpArray = null;' . "\r\n" . '				 theRandListArray = null;' . "\r\n" . '			 }' . "\r\n" . '			 else' . "\r\n" . '			 {' . "\r\n" . '				 for( var tmp in OptionListArray[questionID] )' . "\r\n" . '				 {' . "\r\n" . '					theRadioListArray.push(tmp);' . "\r\n" . '				 }' . "\r\n" . '			 }' . "\r\n" . '		}' . "\r\n" . '' . "\r\n" . '		var remove_value_list = \'\';' . "\r\n" . '		var theOptionIdArray = [];' . "\r\n" . '		var tmp=0;' . "\r\n" . '		var lastOptionId = optionTotalNum -1;' . "\r\n" . '		dataqtn += " qtns:[ ";' . "\r\n" . '		for( var k in theRadioListArray )' . "\r\n" . '		{' . "\r\n" . '			var question_range_optionID = theRadioListArray[k];' . "\r\n" . '			var theQuestionArray = OptionListArray[questionID][question_range_optionID];' . "\r\n" . '			theOptionIdArray.push(question_range_optionID);' . "\r\n" . '' . "\r\n" . '			var theNewOptionName = qJsonCharFilter(theQuestionArray.optionName).split(\'|\');' . "\r\n" . '			dataqtn += "{";' . "\r\n" . '			if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "optionNameLeft:\'"+theNewOptionName[0]+"\',";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( tmp != lastOptionId )' . "\r\n" . '				{' . "\r\n" . '					dataqtn += "optionNameLeft:\'"+theNewOptionName[0]+"\',";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					var optionName = theNewOptionName[0]+"</span>&nbsp;&nbsp;<span style=\\"vertical-align:middle\\"><input name=\\"TextOtherValue_"+questionID+"\\" type=text id=\\"TextOtherValue_"+questionID+"\\" size=15 value=\\"";' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						optionName += qhtmlspecialchars(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+questionID]]);' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						optionName += "";' . "\r\n" . '					}' . "\r\n" . '					optionName += "\\"></span>";' . "\r\n" . '					dataqtn += "optionNameLeft:\'"+optionName+"\',";' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			if( typeof theNewOptionName[1] === \'undefined\' )' . "\r\n" . '			{' . "\r\n" . '				var theRightText = \'\';' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				var theRightText = theNewOptionName[1];' . "\r\n" . '			}' . "\r\n" . '			dataqtn += "optionNameRight:\'"+ theRightText +"\',";' . "\r\n" . '			if(count(theNewOptionName) > 1)' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "alignDiff:\'right\',";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += "alignDiff:\'left\',";' . "\r\n" . '			}' . "\r\n" . '			dataqtn += "optionNameID:\'"+question_range_optionID+"\',";' . "\r\n" . '' . "\r\n" . '			//记录移除值' . "\r\n" . '			remove_value_list +="\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '			var sub_option_list = \'\';' . "\r\n" . '			for( i=0;i<AnswerNum;i++)' . "\r\n" . '			{' . "\r\n" . '				sub_option_list += \'<td class="answer" align="center"><input type="radio" onclick="jQuery.Check_Survey_Conditions();" value="\'+Answer[i]+\'" name="option_\'+questionID+\'_\'+question_range_optionID+\'" id="option_\'+questionID+\'_\'+question_range_optionID+\'"\';' . "\r\n" . '				if( count(dataRow.rows) != 0 )' . "\r\n" . '				{' . "\r\n" . '					if( dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_range_optionID]] != \'0\' && dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+question_range_optionID]] == Answer[i].toString() )' . "\r\n" . '					{' . "\r\n" . '						sub_option_list += \'checked\';  //checked' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						sub_option_list += \'\';' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					sub_option_list += \'\';' . "\r\n" . '				}' . "\r\n" . '				sub_option_list += \'></td><td width=10></td>\';' . "\r\n" . '			}' . "\r\n" . '		    dataqtn += "sub_option_list:\'"+sub_option_list+"\' ";' . "\r\n" . '			dataqtn += "},";' . "\r\n" . '		' . "\r\n" . '			//处理页面字段' . "\r\n" . '			this_fields_list += \'option_\'+questionID+\'_\'+question_range_optionID+\'|\';' . "\r\n" . '			this_fields_type += \'1|\';' . "\r\n" . '' . "\r\n" . '			//矩阵行关联' . "\r\n" . '			var QtnAssCon = _GetQtnAssCond(questionID,question_range_optionID);' . "\r\n" . '' . "\r\n" . '			//页面检查' . "\r\n" . '			if( QtnAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '					{' . "\r\n" . '						check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '						check_survey_form_no_con_list += "\\t\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form.option_"+questionID+"_"+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						if(tmp != lastOptionId )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\telse { \\n";' . "\r\n" . '							check_survey_form_no_con_list += "\\t\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form.option_"+questionID+"_"+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '				{' . "\r\n" . '					if( QtnListArray[questionID].isHaveOther != 1 )' . "\r\n" . '					{' . "\r\n" . '						check_survey_form_no_con_list += "\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form."+\'option_\'+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n";' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						if(tmp != lastOptionId )' . "\r\n" . '						{' . "\r\n" . '							check_survey_form_no_con_list += "\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form."+\'option_\'+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n";' . "\r\n" . '						}' . "\r\n" . '					}					' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			if( QtnListArray[questionID].isHaveOther == 1 && tmp == lastOptionId )' . "\r\n" . '			{' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (Trim(document.Survey_Form.TextOtherValue_"+questionID+".value) != \'\' )\\n\\t{\\n\\t\\tif (!CheckRadioNoClickInAssMode("+questionID+",document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+", \'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;} \\n\\t}\\n";' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (getRadioCheckBoxValue(document.Survey_Form.option_"+questionID+"_"+question_range_optionID+") != \'\' )\\n\\t{\\n\\t\\tif (!CheckNotNull(document.Survey_Form.TextOtherValue_"+questionID+",\'"+theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+"\')){return false;}\\n";' . "\r\n" . '				check_survey_form_no_con_list += "\\t}\\n";' . "\r\n" . '				check_survey_form_no_con_list += "\\telse\\n\\t{\\n\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n\\t}\\n";' . "\r\n" . '		    }' . "\r\n" . '			//矩阵行关联' . "\r\n" . '			if( QtnAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				check_survey_conditions_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\\"#range_range_"+question_range_optionID+"_container\\").hide();\\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\tRadioUnClick(document.Survey_Form.option_"+questionID+\'_\'+question_range_optionID+");\\n";' . "\r\n" . '				//有文本项' . "\r\n" . '				if( QtnListArray[questionID].isHaveOther == 1 && tmp == lastOptionId )' . "\r\n" . '				{' . "\r\n" . '					check_survey_conditions_list += "\\t\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '				}' . "\r\n" . '				check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '				check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\\"#range_range_"+question_range_optionID+"_container\\").show();\\n\\t} \\n";' . "\r\n" . '			}' . "\r\n" . '			tmp++' . "\r\n" . '		}' . "\r\n" . '		dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '		if( QtnListArray[questionID].requiredMode == 2 )  //互斥检查' . "\r\n" . '		{' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (!CheckRangeExclusive("+questionID+","+min(theOptionIdArray)+","+max(theOptionIdArray)+",\'"+theInfoQtnName+"\')){return false;} \\n";' . "\r\n" . '		}' . "\r\n" . '		//连续回复' . "\r\n" . '		if( QtnListArray[questionID].isContInvalid == 1 && QtnListArray[questionID].contInvalidValue != 0 )' . "\r\n" . '		{' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (!CheckRangeIsContInvalid("+questionID+","+min(theOptionIdArray)+","+max(theOptionIdArray)+",\'"+theInfoQtnName+"\',"+QtnListArray[questionID].contInvalidValue+")){return false;} \\n";' . "\r\n" . '		}' . "\r\n" . '		if( QtnListArray[questionID].isHaveOther == 1 )' . "\r\n" . '		{' . "\r\n" . '			this_fields_list += \'TextOtherValue_\'+questionID+\'|\';' . "\r\n" . '			this_fields_type += \'3|\';' . "\r\n" . '			remove_value_list +="\\tTextUnInput(document.Survey_Form.TextOtherValue_"+questionID+");\\n";' . "\r\n" . '		}' . "\r\n" . '' . "\r\n" . '		//选项关联' . "\r\n" . '		var j =0;' . "\r\n" . '		for(var question_range_answerID in AnswerListArray[questionID])' . "\r\n" . '		{' . "\r\n" . '			j++;' . "\r\n" . '			var OptAssCon = _GetOptAssCond(questionID,question_range_answerID);' . "\r\n" . '			if( OptAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				var colNum = (j*2)+1;' . "\r\n" . '				var colNumNext = colNum+1;' . "\r\n" . '				check_survey_conditions_list += "\\tif("+OptAssCon+")\\n\\t{\\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\'#qtn_table_"+questionID+"\').hideColumns(["+colNum+","+colNumNext+"]);\\n";' . "\r\n" . '				for( var k in theRadioListArray )' . "\r\n" . '				{' . "\r\n" . '					var question_range_optionID = theRadioListArray[k];' . "\r\n" . '					check_survey_conditions_list += "\\t\\tRadioItemUnClick(document.Survey_Form.option_"+questionID+"_"+question_range_optionID+","+question_range_answerID+");\\n";' . "\r\n" . '				}' . "\r\n" . '				check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '				check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '				check_survey_conditions_list += "\\t\\t$(\'#qtn_table_"+questionID+"\').showColumns(["+colNum+","+colNumNext+"]);\\n\\t} \\n";' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '' . "\r\n" . '		Answer = null;' . "\r\n" . '		theRadioListArray = null;' . "\r\n" . '		theOptionIdArray = null;' . "\r\n" . '		theQuestionArray = null;' . "\r\n" . '' . "\r\n" . '		//改变背景颜色' . "\r\n" . '		check_survey_conditions_list += "\\tchangeMaskingQtnBgColor("+questionID+");\\n";' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//逻辑条件' . "\r\n" . '	var QuestionCon = _GetQuestionCond(questionID,qid);' . "\r\n" . '	if( QuestionCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '' . "\r\n" . '		var check_form_list = "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_form_list += check_survey_form_no_con_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		//移除已回复的值' . "\r\n" . '		check_form_list += "\\telse{\\n";' . "\r\n" . '		check_form_list += remove_value_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		' . "\r\n" . '		check_survey_form_list += check_form_list;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_list += check_survey_form_no_con_list;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//关联关系' . "\r\n" . '	var RelSurveyCon = _GetSurveyValueRelationCond(questionID,qid,\'cn\');' . "\r\n" . '	if( RelSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		//此题存在多个数值关联关系的检查点' . "\r\n" . '		var theRelSurveyCon = RelSurveyCon.split(\'$$$$$$\');' . "\r\n" . '		for( var t in theRelSurveyCon )' . "\r\n" . '		{' . "\r\n" . '			var tRelSurveyCon = theRelSurveyCon[t].split(\'######\');' . "\r\n" . '			if( parseInt(tRelSurveyCon[0]) == 2 ) //空题' . "\r\n" . '			{' . "\r\n" . '				survey_empty_list += tRelSurveyCon[1];' . "\r\n" . '				var theEmptyList = tRelSurveyCon[1].split(\'*\');' . "\r\n" . '				var theEmptyId = parseInt(substr(theEmptyList[7],0,-3));' . "\r\n" . '				if( !IsSamePage(theEmptyId,questionID)) //不在同页' . "\r\n" . '				{' . "\r\n" . '					//空题字段' . "\r\n" . '					this_fields_list += \'option_\'+theEmptyId+\'|\';' . "\r\n" . '					this_fields_type += \'3|\';' . "\r\n" . '					//跑一遍空题的配额表达式' . "\r\n" . '					var theEmptyEndSurveyCon = _GetSurveyQuotaCond(theEmptyId,qid,\'cn\');' . "\r\n" . '					if( theEmptyEndSurveyCon != \'\' )' . "\r\n" . '					{' . "\r\n" . '						survey_quota_list += theEmptyEndSurveyCon;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				theEmptyList = null;' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				survey_quota_list += tRelSurveyCon[1];' . "\r\n" . '			}' . "\r\n" . '			tRelSurveyCon = null;' . "\r\n" . '		}' . "\r\n" . '		theRelSurveyCon = null;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//问卷结束条件' . "\r\n" . '	var EndSurveyCon = _GetSurveyQuotaCond(questionID,qid,\'cn\');' . "\r\n" . '	if( EndSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		survey_quota_list += EndSurveyCon;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '    var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '	//$(\'#survey_content_container\').append( t.fetch(jsondata)); ' . "\r\n" . '    survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '    jsondata = null;' . "\r\n" . '}';

?>
