<?php
//dezend by http://www.yunlu99.com/
echo 'function create_list_qtn(questionID)' . "\r\n" . '{' . "\r\n" . '	var theInfoQtnName = qNoScriptString(QtnListArray[questionID].questionName);' . "\r\n" . '' . "\r\n" . '	//显示题目文字' . "\r\n" . '	var questionRequire = \'\';' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var questionNotes = \'\';' . "\r\n" . '	var minOption = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionRequire = \'<span class=red>*</span>\';' . "\r\n" . '		if( QtnListArray[questionID].maxSize != 0 )' . "\r\n" . '		{' . "\r\n" . '		   minOption = \'[最少\'+QtnListArray[questionID].maxSize+\'项]\';' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	questionName = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionName));' . "\r\n" . '	questionNotes = \'[枚举题]\';' . "\r\n" . '	questionNotes += minOption;' . "\r\n" . '' . "\r\n" . '    var dataqtn = "{ ";' . "\r\n" . '    dataqtn += " questionID: "+questionID+",";' . "\r\n" . '    dataqtn += " questionRequire: \'"+questionRequire+"\',";' . "\r\n" . '    dataqtn += " questionName: \'"+qShowQtnName(questionName,questionID,1)+"\',";' . "\r\n" . '    dataqtn += " questionNotes: \'"+questionNotes+"\',";' . "\r\n" . '	questionTips = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionNotes));' . "\r\n" . '    dataqtn += " questionTips: \'"+qShowQtnName(questionTips,questionID,2)+"\',";' . "\r\n" . '' . "\r\n" . '	//显示选项' . "\r\n" . '	var check_survey_form_no_con_list = \'\';' . "\r\n" . '	var remove_value_list = \'\';' . "\r\n" . '    dataqtn += " qtns:[ ";' . "\r\n" . '	var theRowsNum=1;' . "\r\n" . '	for(i=1;i<=QtnListArray[questionID].rows;i++)' . "\r\n" . '	{' . "\r\n" . '		dataqtn += "{";' . "\r\n" . '		dataqtn += " listOrder:\'"+i+"\', ";' . "\r\n" . '		dataqtn += " length:\'"+QtnListArray[questionID].length+"\', ";' . "\r\n" . '		dataqtn += " optionID:\'option_"+questionID+\'_\'+i+"\', ";' . "\r\n" . '		if( theRowsNum % 2 == 0 )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " bgcolor: \'#ffffff\',";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " bgcolor: \'#f5f5f5\',";' . "\r\n" . '		}' . "\r\n" . '		theRowsNum++;' . "\r\n" . '		switch( QtnListArray[questionID].isCheckType )' . "\r\n" . '		{' . "\r\n" . '			case 4:  //数值' . "\r\n" . '				dataqtn += " inputPrompt:\'number\',";' . "\r\n" . '			break;' . "\r\n" . '			default:' . "\r\n" . '				dataqtn += " inputPrompt:\'text\',";' . "\r\n" . '			break;' . "\r\n" . '		}' . "\r\n" . '		if( count(dataRow.rows) != 0 )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " value:\'"+qhtmlspecialchars(dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+i]])+"\'";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " value:\'\'";' . "\r\n" . '		}' . "\r\n" . '		dataqtn += "},";' . "\r\n" . '' . "\r\n" . '		//记录移除值' . "\r\n" . '		remove_value_list +="\\tTextUnInput(document.Survey_Form.option_"+questionID+\'_\'+i+");\\n";' . "\r\n" . '		//处理页面字段' . "\r\n" . '		this_fields_list += \'option_\'+questionID+\'_\'+i+\'|\';' . "\r\n" . '		this_fields_type += \'3|\';' . "\r\n" . '' . "\r\n" . '		//处理提交检查' . "\r\n" . '		switch( QtnListArray[questionID].isCheckType )' . "\r\n" . '		{' . "\r\n" . '			case 1:  //URL' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (!CheckURL(document.Survey_Form."+\'option_\'+questionID+\'_\'+i+", \'"+theInfoQtnName+" - "+i+"\')){return false;} \\n";' . "\r\n" . '			break;' . "\r\n" . '			case 2:  //长度' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (!CheckStringLength(document.Survey_Form."+\'option_\'+questionID+\'_\'+i+", \'"+theInfoQtnName+" - "+i+"\',"+QtnListArray[questionID].minOption+","+QtnListArray[questionID].maxOption+")){return false;} \\n";' . "\r\n" . '			break;' . "\r\n" . '			case 4:  //数值' . "\r\n" . '				check_survey_form_no_con_list += "\\tif (!CheckIsValue(document.Survey_Form."+\'option_\'+questionID+\'_\'+i+", \'"+theInfoQtnName+" - "+i+"\',"+QtnListArray[questionID].minOption+","+QtnListArray[questionID].maxOption+")){return false;} \\n";' . "\r\n" . '			break;' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '    var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '' . "\r\n" . '	//最少枚举项' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_no_con_list += "\\tvar listNum =0;\\n ";' . "\r\n" . '		check_survey_form_no_con_list += "\\tfor( i= 1;i<="+QtnListArray[questionID].rows+";i++){ \\n ";' . "\r\n" . '		check_survey_form_no_con_list += "\\t\\tvar obj = eval(\\"document.Survey_Form."+\'option_\'+questionID+\'_\'+"\\" + i );\\n";' . "\r\n" . '		check_survey_form_no_con_list += "\\t\\tif(obj.value  != \'\' ){listNum++;} \\n ";' . "\r\n" . '		check_survey_form_no_con_list += "\\t}\\n ";' . "\r\n" . '' . "\r\n" . '		if( QtnListArray[questionID].maxSize == 0 )' . "\r\n" . '		{' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (listNum < 1){\\n ";' . "\r\n" . '			check_survey_form_no_con_list += "\\t\\tshowMessage(\'"+theInfoQtnName+"：列举不完全，至少进行1项\');\\n ";' . "\r\n" . '			check_survey_form_no_con_list += "\\t\\tdocument.Survey_Form."+\'option_\'+questionID+\'_1\'+".focus();\\n \\t\\treturn false;\\n\\t}\\n";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (listNum < "+QtnListArray[questionID].maxSize+"){\\n ";' . "\r\n" . '			check_survey_form_no_con_list += "\\t\\tshowMessage(\'"+theInfoQtnName+"：列举不完全，至少进行"+QtnListArray[questionID].maxSize+"项\');\\n ";' . "\r\n" . '			check_survey_form_no_con_list += "\\t\\tdocument.Survey_Form."+\'option_\'+questionID+\'_1\'+".focus();\\n \\t\\treturn false;\\n\\t}\\n";' . "\r\n" . '		}' . "\r\n" . '' . "\r\n" . '	}' . "\r\n" . '	//逻辑条件' . "\r\n" . '	var QuestionCon = _GetQuestionCond(questionID,qid);' . "\r\n" . '	if( QuestionCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '' . "\r\n" . '		var check_form_list = "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_form_list += check_survey_form_no_con_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		//移除已回复的值' . "\r\n" . '		check_form_list += "\\telse{\\n";' . "\r\n" . '		check_form_list += remove_value_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '' . "\r\n" . '		check_survey_form_list += check_form_list;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_list += check_survey_form_no_con_list;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr>{foreach $qtns as $i => $qtn}<tr class=tdheight bgcolor="{$qtn.bgcolor}"><td class="answer tdheight" align="left" valign=center nowrap>{$qtn.listOrder}、<input type="{$qtn.inputPrompt}" name="{$qtn.optionID}" id="{$qtn.optionID}" size="{$qtn.length}" value="{$qtn.value}"></td></tr>	{/foreach}</table>\';' . "\r\n" . '' . "\r\n" . '    var t = new jSmart(tplText);' . "\r\n" . '    //$(\'#survey_content_container\').append( t.fetch(jsondata)); ' . "\r\n" . '	survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '	jsondata = null;' . "\r\n" . '}';

?>
