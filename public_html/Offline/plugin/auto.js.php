<?php
//dezend by http://www.yunlu99.com/
echo 'function create_auto_qtn(questionID)' . "\r\n" . '{' . "\r\n" . '	var theInfoQtnName = qNoScriptString(QtnListArray[questionID].questionName);' . "\r\n" . '' . "\r\n" . '	//处理页面字段' . "\r\n" . '	this_fields_list += \'option_\'+questionID+\'|\';' . "\r\n" . '	if( QtnListArray[questionID].isSelect == 1)  //单选' . "\r\n" . '	{' . "\r\n" . '		this_fields_type += \'9|\'; //特殊单选' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		this_fields_type += \'2|\';' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//提交检查' . "\r\n" . '	var questionRequire = \'\';' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var questionNotes = \'\';' . "\r\n" . '	var minOption = maxOption = \'\';' . "\r\n" . '	var check_survey_form_no_con_list = \'\';' . "\r\n" . '' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionRequire = \'<span class=red>*</span>\';' . "\r\n" . '		check_survey_form_no_con_list += "\\tif (!CheckAutoNoClick(document.Survey_Form."+\'option_\'+questionID+","+questionID+", \'"+theInfoQtnName+"\')){return false;} \\n";' . "\r\n" . '		if( QtnListArray[questionID].isSelect == 0) //多选' . "\r\n" . '		{' . "\r\n" . '			if( QtnListArray[questionID].minOption != 0 )' . "\r\n" . '			{' . "\r\n" . '			   minOption = \'[最少\'+QtnListArray[questionID].minOption+\'项]\';' . "\r\n" . '			   check_survey_form_no_con_list += "\\tif (!CheckAutoMinClick(document.Survey_Form."+\'option_\'+questionID+","+questionID+", \'"+theInfoQtnName+"\',"+QtnListArray[questionID].minOption+")){return false;} \\n";' . "\r\n" . '			}' . "\r\n" . '			if( QtnListArray[questionID].maxOption != 0 )' . "\r\n" . '			{' . "\r\n" . '			   maxOption = \'[最多\'+QtnListArray[questionID].maxOption+\'项]\';' . "\r\n" . '			   check_survey_form_no_con_list += "\\tif (!CheckAutoMaxClick(document.Survey_Form."+\'option_\'+questionID+","+questionID+", \'"+theInfoQtnName+"\',"+QtnListArray[questionID].maxOption+")){return false;} \\n";' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	//展现问题文字' . "\r\n" . '	questionName = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionName));' . "\r\n" . '	questionNotes = \'[自动选项题]\';' . "\r\n" . '	questionNotes += minOption;' . "\r\n" . '	questionNotes += maxOption;' . "\r\n" . '' . "\r\n" . '    var dataqtn = "{ ";' . "\r\n" . '    dataqtn += " questionID: "+questionID+",";' . "\r\n" . '    dataqtn += " questionRequire: \'"+questionRequire+"\',";' . "\r\n" . '    dataqtn += " questionName: \'"+qShowQtnName(questionName,questionID,1)+"\',";' . "\r\n" . '    dataqtn += " questionNotes: \'"+questionNotes+"\',";' . "\r\n" . '    questionTips = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionNotes));' . "\r\n" . '    dataqtn += " questionTips: \'"+qShowQtnName(questionTips,questionID,2)+"\',";' . "\r\n" . '' . "\r\n" . '	//来源问题及选项' . "\r\n" . '	var theBaseID = QtnListArray[questionID].baseID;' . "\r\n" . '	var theBaseQtnArray = QtnListArray[theBaseID];' . "\r\n" . '	var theCheckBoxListArray = CheckBoxListArray[theBaseQtnArray.questionID];' . "\r\n" . '' . "\r\n" . '	//来源问题不存在' . "\r\n" . '	if( count(theBaseQtnArray)==0 && QtnListArray[questionID].isRequired == 1)' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_no_con_list += "\\tshowMessage(\'"+theInfoQtnName+"，来源问题不存在或已被删除\');return false;\\n";' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//逻辑条件' . "\r\n" . '	var QuestionCon = _GetQuestionCond(questionID,qid);' . "\r\n" . '	var theBaseIsSelect = (count(theBaseQtnArray) ==0 ) ? 0 : theBaseQtnArray.isSelect;' . "\r\n" . '    var theIsSamePage = IsSamePage(questionID,theBaseID)? 1:0 ;' . "\r\n" . '	var theOriValue = \'\';' . "\r\n" . '	if( count(dataRow.rows) != 0 )' . "\r\n" . '	{' . "\r\n" . '		if( dataRow.rows[0][dataIndex[\'option_\'+theBaseID]] != \'0\' && dataRow.rows[0][dataIndex[\'option_\'+theBaseID]] != \'\' )' . "\r\n" . '		{' . "\r\n" . '			theOriValue = dataRow.rows[0][dataIndex[\'option_\'+theBaseID]];' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var getCheckBoxNoneofAbove = "_getCheckBoxNoneofAbove("+theBaseQtnArray.questionType+","+theBaseID+","+theBaseIsSelect+","+theIsSamePage+","+QtnListArray[questionID].isNeg+",\'"+theOriValue+"\')";' . "\r\n" . '	if( QuestionCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+QuestionCon+" && "+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '' . "\r\n" . '		check_form_list = "\\tif("+QuestionCon+" && "+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '		check_form_list += check_survey_form_no_con_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		//移除已回复的值' . "\r\n" . '		check_form_list += "\\telse{\\n";' . "\r\n" . '		check_form_list +="\\tRadioUnClick(document.Survey_Form.option_"+questionID+");\\n";' . "\r\n" . '		check_form_list += "\\t}\\n";    ' . "\r\n" . '		check_survey_form_list += check_form_list;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '		if( check_survey_form_no_con_list != \'\' )' . "\r\n" . '		{' . "\r\n" . '			check_form_list = "\\tif("+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '			check_form_list += check_survey_form_no_con_list;' . "\r\n" . '			check_form_list += "\\t}\\n";' . "\r\n" . '			check_survey_form_list += check_form_list;' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var optionAutoArray = [];' . "\r\n" . '	var optionMinMaxArray = [];' . "\r\n" . '	var i=0;' . "\r\n" . '	for( var question_checkboxID in theCheckBoxListArray )' . "\r\n" . '	{' . "\r\n" . '		var theQuestionArray = theCheckBoxListArray[question_checkboxID];' . "\r\n" . '		if( theBaseQtnArray.questionType == 3 )' . "\r\n" . '		{' . "\r\n" . '			optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '		}' . "\r\n" . '' . "\r\n" . '		if( theBaseQtnArray.questionType == 25 )  //组合多选' . "\r\n" . '		{' . "\r\n" . '			if( ! IsSamePage(questionID,theBaseID) ) //不同同页' . "\r\n" . '			{' . "\r\n" . '				if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '				{' . "\r\n" . '					optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						if( typeof dataIndex[\'TextOtherValue_\'+theBaseID+\'_\'+question_checkboxID] != \'undefined\' && dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID+\'_\'+question_checkboxID]] != \'\' )' . "\r\n" . '						{' . "\r\n" . '							optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName)+\'(\'+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID+\'_\'+question_checkboxID]])+\')\';' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		optionMinMaxArray[i] = question_checkboxID;' . "\r\n" . '		i++;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//有其他项' . "\r\n" . '	if( theBaseQtnArray.isHaveOther == 1 )' . "\r\n" . '	{' . "\r\n" . '		optionMinMaxArray[i] = 0;' . "\r\n" . '		if( ! IsSamePage(questionID,theBaseID) ) //不同同页' . "\r\n" . '		{' . "\r\n" . '			if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '			{' . "\r\n" . '				optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( count(dataRow.rows) != 0 )' . "\r\n" . '				{' . "\r\n" . '					if( dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID]] != \'\' )' . "\r\n" . '					{' . "\r\n" . '						optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText)+\'(\'+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID]])+\')\';' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//排除性选项' . "\r\n" . '	if( QtnListArray[questionID].isCheckType == 1 )' . "\r\n" . '	{' . "\r\n" . '		i++;' . "\r\n" . '		optionMinMaxArray[i] = 99999;' . "\r\n" . '		optionAutoArray[99999] = qJsonCharFilter(QtnListArray[questionID].allowType);' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '    dataqtn += " baseID: \'"+theBaseID+"\',";' . "\r\n" . '' . "\r\n" . '	var theOptionAutoIDList = \'\';' . "\r\n" . '    dataqtn += " qtns:[ ";' . "\r\n" . '	var theOptionOdNum = 0;' . "\r\n" . '	for( var tmp in optionMinMaxArray )' . "\r\n" . '	{' . "\r\n" . '		var optionAutoID = optionMinMaxArray[tmp];' . "\r\n" . '		var optionAutoName = optionAutoArray[optionAutoID];' . "\r\n" . '		theOptionAutoIDList += optionAutoID+\',\';' . "\r\n" . '' . "\r\n" . '		dataqtn += "{";' . "\r\n" . '		dataqtn += " optionValue: \'"+optionAutoID+"\',";' . "\r\n" . '        dataqtn += " theOptionOdNum:"+theOptionOdNum+",";' . "\r\n" . '		theOptionOdNum ++;' . "\r\n" . '' . "\r\n" . '		if( QtnListArray[questionID].isSelect == 1)  //单选' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " isRadio: \'radio\',";' . "\r\n" . '			dataqtn += " optionName: \'option_"+questionID+"\',";' . "\r\n" . '			if( isRadioSelect(optionAutoID,questionID) )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isCheck: \'checked\',";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isCheck: \'\',";' . "\r\n" . '			}' . "\r\n" . '			dataqtn += " onChangeEvent: \'onclick=\\"jQuery.Check_Survey_Conditions();\\"\',";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " isRadio: \'checkbox\',";' . "\r\n" . '			dataqtn += " optionName: \'option_"+questionID+"\',";' . "\r\n" . '			if( IsCheckBoxSelect(optionAutoID,questionID) )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isCheck: \'checked\',";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " isCheck: \'\',";' . "\r\n" . '			}' . "\r\n" . '			dataqtn += " onChangeEvent: \'onclick=\\"jQuery.Check_Survey_Conditions();\\"\',";' . "\r\n" . '		}' . "\r\n" . '		dataqtn += " optionText: \'"+optionAutoName+"\'";' . "\r\n" . '		dataqtn += "},";' . "\r\n" . '	}' . "\r\n" . '	dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '' . "\r\n" . '	//选项生成' . "\r\n" . '	if( count(theBaseQtnArray) != 0 && ! IsSamePage(questionID,theBaseID) )  //不在同页' . "\r\n" . '	{' . "\r\n" . '		theOptionAutoIDList = substr(theOptionAutoIDList,0,-1);' . "\r\n" . '		theOriValue = \',\'+theOriValue+\',\';' . "\r\n" . '		if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoOptionNoSamePageIsNeg("+theBaseID+",\'"+theOptionAutoIDList+"\',\'"+theOriValue+"\',"+questionID+","+QtnListArray[questionID].isCheckType+");\\n";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoOptionNoSamePage("+theBaseID+",\'"+theOptionAutoIDList+"\',\'"+theOriValue+"\',"+questionID+","+QtnListArray[questionID].isCheckType+");\\n";' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	else   //同页' . "\r\n" . '	{' . "\r\n" . '		var theBaseIsSelect = (count(theBaseQtnArray)==0) ? 0 : theBaseQtnArray.isSelect;' . "\r\n" . '		if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoOptionSamePageIsNeg("+theBaseID+","+theBaseIsSelect+","+questionID+","+QtnListArray[questionID].isCheckType+","+theBaseQtnArray.isHaveOther+");\\n";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoOptionSamePage("+theBaseID+","+theBaseIsSelect+","+questionID+","+QtnListArray[questionID].isCheckType+");\\n";' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//排除性选项' . "\r\n" . '	if( QtnListArray[questionID].isCheckType == 1 && QtnListArray[questionID].isSelect != 1 )  //多选' . "\r\n" . '	{' . "\r\n" . '		var theOptionOrderID = count(optionAutoArray)-1;' . "\r\n" . '		check_survey_conditions_list +="\\ttheExcludeItem(document.Survey_Form.option_"+questionID+","+theOptionOrderID+",0);\\n";' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	if( QtnListArray[questionID].isSelect == 1)  //单选' . "\r\n" . '	{' . "\r\n" . '		var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr rel="eqprint"><td><table cellSpacing=0 cellPadding=0 id="auto_focus_{$questionID}" width=100%>{foreach $qtns as $i => $qtn}<tr style="display:none" id="auto_{$baseID}_{$questionID}_{$qtn.optionValue}"><td class="answer tdheight" align="left" nowrap id="eqcheck_{$baseID}_{$questionID}_{$qtn.optionValue}"><input type="{$qtn.isRadio}" value="{$qtn.optionValue}" name="{$qtn.optionName}" id="option_{$questionID}" {$qtn.isCheck} {$qtn.onChangeEvent}></td><td class="answer" nowrap align="left" width=99%><a href="javascript:void(0)" onclick=javascript:selRadioCheckRows("option_{$questionID}",{$qtn.theOptionOdNum});><div style="white-space:nowrap;" class=tdlineheight><span id="textNode_{$questionID}_{$qtn.optionValue}">{$qtn.optionText}</span></div></a></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr rel="eqprint"><td><table cellSpacing=0 cellPadding=0 style="padding:0px;margin:0px" id="auto_focus_{$questionID}" width=100%>{foreach $qtns as $i => $qtn}<tr style="display:none" id="auto_{$baseID}_{$questionID}_{$qtn.optionValue}"><td class="answer tdheight" nowrap align="left" id="eqcheck_{$baseID}_{$questionID}_{$qtn.optionValue}"><input type="{$qtn.isRadio}" value="{$qtn.optionValue}" name="{$qtn.optionName}" id="option_{$questionID}" {$qtn.isCheck} {$qtn.onChangeEvent}></td><td style="padding:0px;margin:0px" class="answer" nowrap align="left" width=99%><a href="javascript:void(0)" onclick=javascript:selCheckBoxCheckRows("option_{$questionID}",{$qtn.theOptionOdNum});><div style="white-space:nowrap;" class=tdlineheight><span id="textNode_{$questionID}_{$qtn.optionValue}">{$qtn.optionText}</span></div></a></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	check_survey_conditions_list += "\\tchangeMaskingAutoBgColor("+questionID+");\\n";' . "\r\n" . '' . "\r\n" . '	//关联关系' . "\r\n" . '	var RelSurveyCon = _GetSurveyValueRelationCond(questionID,qid,\'cn\');' . "\r\n" . '	if( RelSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		//此题存在多个数值关联关系的检查点' . "\r\n" . '		var theRelSurveyCon = RelSurveyCon.split(\'$$$$$$\');' . "\r\n" . '		for( var t in theRelSurveyCon )' . "\r\n" . '		{' . "\r\n" . '			var tRelSurveyCon = theRelSurveyCon[t].split(\'######\');' . "\r\n" . '			if( parseInt(tRelSurveyCon[0]) == 2 ) //空题' . "\r\n" . '			{' . "\r\n" . '				survey_empty_list += tRelSurveyCon[1];' . "\r\n" . '				var theEmptyList = tRelSurveyCon[1].split(\'*\');' . "\r\n" . '				var theEmptyId = parseInt(substr(theEmptyList[7],0,-3));' . "\r\n" . '				if( !IsSamePage(theEmptyId,questionID)) //不在同页' . "\r\n" . '				{' . "\r\n" . '					//空题字段' . "\r\n" . '					this_fields_list += \'option_\'+theEmptyId+\'|\';' . "\r\n" . '					this_fields_type += \'3|\';' . "\r\n" . '					//跑一遍空题的配额表达式' . "\r\n" . '					var theEmptyEndSurveyCon = _GetSurveyQuotaCond(theEmptyId,qid,\'cn\');' . "\r\n" . '					if( theEmptyEndSurveyCon != \'\' )' . "\r\n" . '					{' . "\r\n" . '						survey_quota_list += theEmptyEndSurveyCon;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				theEmptyList = null;' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				survey_quota_list += tRelSurveyCon[1];' . "\r\n" . '			}' . "\r\n" . '			tRelSurveyCon = null;' . "\r\n" . '		}' . "\r\n" . '		theRelSurveyCon = null;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//问卷结束条件' . "\r\n" . '	var EndSurveyCon = _GetSurveyQuotaCond(questionID,qid,\'cn\');' . "\r\n" . '	if( EndSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		survey_quota_list += EndSurveyCon;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '	//$(\'#survey_content_container\').append( t.fetch(jsondata)); ' . "\r\n" . '    survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '    jsondata = null;' . "\r\n" . '	optionAutoArray = null;' . "\r\n" . '	theBaseQtnArray = null;' . "\r\n" . '	theCheckBoxListArray = null;' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//检查自动选项' . "\r\n" . 'function CheckAutoNoClick(objField,questionID,strText)' . "\r\n" . '{' . "\r\n" . '	var strErr = "“" + strText + "”必须选择一个选项！";' . "\r\n" . '	var theShowObj;' . "\r\n" . '	if(objField == null ){' . "\r\n" . '	    var  strErr = "“" + strText + "”来源问题已删除或未有选择项!";' . "\r\n" . '		showMessage(strErr);' . "\r\n" . '		return false;	' . "\r\n" . '	}' . "\r\n" . '	for (i=0;i<objField.length;i++){' . "\r\n" . '		if (objField[i].checked) return true;' . "\r\n" . '	}' . "\r\n" . '	var theObjIn = eval("document.getElementById(\'auto_focus_"+questionID+"\')");' . "\r\n" . '	theObjIn.scrollIntoView(true);' . "\r\n" . '	theObjIn.focus();' . "\r\n" . '	showMessage(strErr);' . "\r\n" . '	return false;' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//检测自动选项最多几项' . "\r\n" . 'function CheckAutoMaxClick(objField,questionID, strText,maxNum )' . "\r\n" . '{' . "\r\n" . '	var j=0,theShowObj; ' . "\r\n" . '	for( i=0;i<objField.length;i++ ) {   ' . "\r\n" . '		if(objField[i].checked) {   ' . "\r\n" . '		   j=j+1;   ' . "\r\n" . '		}   ' . "\r\n" . '	} ' . "\r\n" . '	if( j > maxNum ){' . "\r\n" . '		var theObjIn = eval("document.getElementById(\'auto_focus_"+questionID+"\')");' . "\r\n" . '		theObjIn.scrollIntoView(true);' . "\r\n" . '		theObjIn.focus();' . "\r\n" . '		showMessage("最多只能选择" + maxNum +"项“"+ strText + "”");' . "\r\n" . '		return false;' . "\r\n" . '	}' . "\r\n" . '	else {' . "\r\n" . '		if( j==0 )	{' . "\r\n" . '			var theObjIn = eval("document.getElementById(\'auto_focus_"+questionID+"\')");' . "\r\n" . '			theObjIn.scrollIntoView(true);' . "\r\n" . '			theObjIn.focus();' . "\r\n" . '			showMessage("请选择“" + strText + "”" );   ' . "\r\n" . '			return false;' . "\r\n" . '		}' . "\r\n" . '		else return true;' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//检测自动选项最少几项' . "\r\n" . 'function CheckAutoMinClick(objField,questionID, strText,minNum )' . "\r\n" . '{' . "\r\n" . '	var j=0,theShowObj;   ' . "\r\n" . '	for( i=0;i<objField.length;i++ ) {   ' . "\r\n" . '		if(objField[i].checked) {   ' . "\r\n" . '		   j=j+1;   ' . "\r\n" . '		}   ' . "\r\n" . '	} ' . "\r\n" . '	if( j < minNum ){' . "\r\n" . '		var theObjIn = eval("document.getElementById(\'auto_focus_"+questionID+"\')");' . "\r\n" . '		theObjIn.scrollIntoView(true);' . "\r\n" . '		theObjIn.focus();' . "\r\n" . '		showMessage("最少必须选择" + minNum +"项“"+ strText + "”");' . "\r\n" . '		return false;' . "\r\n" . '	}' . "\r\n" . '	else {' . "\r\n" . '		if( j==0 )	{' . "\r\n" . '			var theObjIn = eval("document.getElementById(\'auto_focus_"+questionID+"\')");' . "\r\n" . '			theObjIn.scrollIntoView(true);' . "\r\n" . '			theObjIn.focus();' . "\r\n" . '			showMessage("请选择“" + strText + "”" );   ' . "\r\n" . '			return false;' . "\r\n" . '		}' . "\r\n" . '		else return true;' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//自动选项同页展现' . "\r\n" . 'function getAutoOptionSamePage(baseID,isList,questionID,isNeg)' . "\r\n" . '{' . "\r\n" . '     var objField = eval( "document.Survey_Form.option_" + baseID );' . "\r\n" . '	 if (objField != null ){' . "\r\n" . '		 if( isList == 1 )  //列表框' . "\r\n" . '		 {' . "\r\n" . '			   for( i=0;i<objField.options.length;i++ )' . "\r\n" . '			   {' . "\r\n" . '				  theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_"+objField.options[i].value+"\')");' . "\r\n" . '				  theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_"+objField.options[i].value+"\')");' . "\r\n" . '				  if( theOptionObj != null ){' . "\r\n" . '					  if( objField.options[i].selected && objField.options[i].value != \'\')' . "\r\n" . '					  {' . "\r\n" . '						  theOptionObj.style.display = \'\';' . "\r\n" . '					  }' . "\r\n" . '					  else' . "\r\n" . '					  {' . "\r\n" . '						  if( isNeg == 1 )' . "\r\n" . '						  {' . "\r\n" . '							  if( objField.options[i].value != \'99999\') //前述问题中的排除项' . "\r\n" . '							  {' . "\r\n" . '								  theOptionObj.style.display = \'none\';' . "\r\n" . '								  if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '							  }' . "\r\n" . '						  }' . "\r\n" . '						  else' . "\r\n" . '						  {' . "\r\n" . '							  theOptionObj.style.display = \'none\';' . "\r\n" . '							  if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '						  }' . "\r\n" . '					  }' . "\r\n" . '				  }' . "\r\n" . '			   }					   ' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			  for( i=0;i<objField.length;i++ ) {' . "\r\n" . '					theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_"+objField[i].value+"\')");' . "\r\n" . '				    theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_"+objField[i].value+"\')");' . "\r\n" . '					if( theOptionObj != null ){' . "\r\n" . '						if(objField[i].checked )' . "\r\n" . '						{' . "\r\n" . '							theOptionObj.style.display = \'\';' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '						    if( isNeg == 1 )' . "\r\n" . '							{' . "\r\n" . '								if( objField[i].value != \'99999\') //前述问题中的排除项' . "\r\n" . '								{' . "\r\n" . '									theOptionObj.style.display = \'none\';' . "\r\n" . '									if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '								}' . "\r\n" . '							}' . "\r\n" . '							else' . "\r\n" . '							{' . "\r\n" . '								theOptionObj.style.display = \'none\';' . "\r\n" . '								if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '							}								' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '			  }' . "\r\n" . '		}' . "\r\n" . '	    if( isNeg == 1 ) //有排除项' . "\r\n" . '	 	{' . "\r\n" . '		      theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '			  theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '			  if( getRadioCheckBoxValue(objField) != \'\' ) ' . "\r\n" . '			  {' . "\r\n" . '				  theOptionObj.style.display = \'\';' . "\r\n" . '			  }' . "\r\n" . '			  else' . "\r\n" . '			  {' . "\r\n" . '				  theOptionObj.style.display = \'none\';' . "\r\n" . '				  if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '			  }' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function getAutoOptionNoSamePage(baseID,theAllValue,theSelectValue,questionID,isNeg)' . "\r\n" . '{' . "\r\n" . '    var theAllValueArray = theAllValue.split(\',\');' . "\r\n" . '	var theSelectNum = 0;' . "\r\n" . '	for(i=0;i<=theAllValueArray.length-1;i++){' . "\r\n" . '		theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_"+theAllValueArray[i]+"\')");' . "\r\n" . '		theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_"+theAllValueArray[i]+"\')");' . "\r\n" . '		if( theOptionObj != null )' . "\r\n" . '		{' . "\r\n" . '			if( theSelectValue.indexOf(","+theAllValueArray[i] + ",") == -1 )' . "\r\n" . '			{' . "\r\n" . '				if( isNeg == 1 ) //有排除项' . "\r\n" . '				{' . "\r\n" . '					if( theAllValueArray[i] != \'99999\')  //本题中的99999选项' . "\r\n" . '					{' . "\r\n" . '						theOptionObj.style.display = \'none\';' . "\r\n" . '						if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					theOptionObj.style.display = \'none\';' . "\r\n" . '					if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				theSelectNum++;' . "\r\n" . '				theOptionObj.style.display = \'\';' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	if( isNeg == 1 ) //有排除项' . "\r\n" . '	{' . "\r\n" . '	    theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '		theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '		if( theSelectNum != 0 ) ' . "\r\n" . '		{' . "\r\n" . '		    theOptionObj.style.display = \'\';' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			theOptionObj.style.display = \'none\';' . "\r\n" . '			if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//自动选项同页展现' . "\r\n" . 'function getAutoOptionSamePageIsNeg(baseID,isList,questionID,isNeg,baseIsHaveOther)' . "\r\n" . '{' . "\r\n" . '     var objField = eval( "document.Survey_Form.option_" + baseID );' . "\r\n" . '	 if (objField != null ){' . "\r\n" . '		 if( isList == 1 )  //列表框' . "\r\n" . '		 {' . "\r\n" . '			   for( i=0;i<objField.options.length;i++ )' . "\r\n" . '			   {' . "\r\n" . '				  theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_"+objField.options[i].value+"\')");' . "\r\n" . '				  theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_"+objField.options[i].value+"\')");' . "\r\n" . '				  if( theOptionObj != null ){' . "\r\n" . '					  if( objField.options[i].selected != true && objField.options[i].value != \'\')' . "\r\n" . '					  {' . "\r\n" . '						  if( isNeg == 1 )' . "\r\n" . '						  {' . "\r\n" . '							  if( objField.options[i].value != \'99999\') //前述问题中的排除项' . "\r\n" . '							  {' . "\r\n" . '								  theOptionObj.style.display = \'\';' . "\r\n" . '							  }' . "\r\n" . '						  }' . "\r\n" . '						  else' . "\r\n" . '						  {' . "\r\n" . '							  theOptionObj.style.display = \'\';' . "\r\n" . '						  }' . "\r\n" . '					  }' . "\r\n" . '					  else' . "\r\n" . '					  {' . "\r\n" . '						  theOptionObj.style.display = \'none\';' . "\r\n" . '						  if( isNeg == 1 )' . "\r\n" . '						  {' . "\r\n" . '							  if( objField.options[i].value != \'99999\') //前述问题中的排除项' . "\r\n" . '							  {' . "\r\n" . '								  if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '							  }' . "\r\n" . '						  }' . "\r\n" . '						  else' . "\r\n" . '						  {' . "\r\n" . '							  if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '						  }' . "\r\n" . '					  }' . "\r\n" . '				  }' . "\r\n" . '			   }' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			  for( i=0;i<objField.length;i++ ) {' . "\r\n" . '					theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_"+objField[i].value+"\')");' . "\r\n" . '				    theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_"+objField[i].value+"\')");' . "\r\n" . '					if( theOptionObj != null ){' . "\r\n" . '						if(objField[i].checked != true )' . "\r\n" . '						{' . "\r\n" . '						    if( isNeg == 1 )' . "\r\n" . '							{' . "\r\n" . '								if( objField[i].value != \'99999\')  //前述问题中的排除项' . "\r\n" . '								{' . "\r\n" . '									theOptionObj.style.display = \'\';' . "\r\n" . '								}' . "\r\n" . '							}' . "\r\n" . '							else' . "\r\n" . '							{' . "\r\n" . '								theOptionObj.style.display = \'\';' . "\r\n" . '							}								' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							theOptionObj.style.display = \'none\';' . "\r\n" . '						    if( isNeg == 1 )' . "\r\n" . '							{' . "\r\n" . '								if( objField[i].value != \'99999\')  //前述问题中的排除项' . "\r\n" . '								{' . "\r\n" . '									if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '								}' . "\r\n" . '							}' . "\r\n" . '							else' . "\r\n" . '							{' . "\r\n" . '								if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '			  }' . "\r\n" . '		}' . "\r\n" . '	    if( isNeg == 1 ) //有排除项' . "\r\n" . '	 	{' . "\r\n" . '		      theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '			  theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '			  if( getCheckBoxHaveNoCheck(objField,baseIsHaveOther) == true ) ' . "\r\n" . '			  {' . "\r\n" . '				  theOptionObj.style.display = \'\';' . "\r\n" . '			  }' . "\r\n" . '			  else' . "\r\n" . '			  {' . "\r\n" . '				  theOptionObj.style.display = \'none\';' . "\r\n" . '				  if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '			  }' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function getAutoOptionNoSamePageIsNeg(baseID,theAllValue,theSelectValue,questionID,isNeg)' . "\r\n" . '{' . "\r\n" . '    var theSelectNum = 0;' . "\r\n" . '	var theAllValueArray = theAllValue.split(\',\');' . "\r\n" . '	for(i=0;i<=theAllValueArray.length-1;i++){' . "\r\n" . '		theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_"+theAllValueArray[i]+"\')");' . "\r\n" . '		theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_"+theAllValueArray[i]+"\')");' . "\r\n" . '		if( theOptionObj != null )' . "\r\n" . '		{' . "\r\n" . '			if( theSelectValue.indexOf(","+theAllValueArray[i] + ",") != -1 )' . "\r\n" . '			{' . "\r\n" . '				theOptionObj.style.display = \'none\';' . "\r\n" . '				if( isNeg == 1 )' . "\r\n" . '				{' . "\r\n" . '					if( theAllValueArray[i] != \'99999\' )   //前述问题中的排除项' . "\r\n" . '					{' . "\r\n" . '						if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( isNeg == 1 )' . "\r\n" . '				{' . "\r\n" . '					if( theAllValueArray[i] != \'99999\' )   //前述问题中的排除项' . "\r\n" . '					{' . "\r\n" . '						theOptionObj.style.display = \'\';' . "\r\n" . '						theSelectNum++;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					theOptionObj.style.display = \'\';' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	if( isNeg == 1 ) //有排除项' . "\r\n" . '	{' . "\r\n" . '	    theOptionObj = eval("document.getElementById(\'auto_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '		theInputObj = eval("document.getElementById(\'eqcheck_"+baseID+"_"+questionID+"_99999\')");' . "\r\n" . '		if( theSelectNum != 0 ) ' . "\r\n" . '		{' . "\r\n" . '		    theOptionObj.style.display = \'\';' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			theOptionObj.style.display = \'none\';' . "\r\n" . '			if(theInputObj != null) theInputObj.getElementsByTagName("input")[0].checked = false;' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function getCheckBoxHaveNoCheck(objField,baseIsHaveOther)' . "\r\n" . '{' . "\r\n" . '	var isHaveNoCheck = false;' . "\r\n" . '	if( objField.length == null )' . "\r\n" . '	{' . "\r\n" . '		if( objField.tagName.toLowerCase() == \'input\')' . "\r\n" . '		{' . "\r\n" . '			if ( !objField.checked)  isHaveNoCheck = true;' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			for( i=0;i<objField.options.length;i++ ){' . "\r\n" . '			    if( !objField.item(i).selected && objField.item(i).value != \'\' ) ' . "\r\n" . '			    {' . "\r\n" . '			       isHaveNoCheck = true;' . "\r\n" . '				   break;' . "\r\n" . '			    }' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		if( objField[0].tagName.toLowerCase() == \'input\')' . "\r\n" . '		{' . "\r\n" . '			for( i=0;i<objField.length;i++){		' . "\r\n" . '				if ( !objField[i].checked && objField[i].value != \'\' )' . "\r\n" . '			    {' . "\r\n" . '				   	if( objField[i].value == \'99999\' ) //互斥项' . "\r\n" . '					{' . "\r\n" . '						continue;' . "\r\n" . '					}' . "\r\n" . '				   	if( baseIsHaveOther != 1 && objField[i].value == \'0\' )' . "\r\n" . '					{' . "\r\n" . '						continue;' . "\r\n" . '					}' . "\r\n" . '			        isHaveNoCheck = true;' . "\r\n" . '				    break;' . "\r\n" . '			    }' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			for( i=0;i<objField.options.length;i++ ){' . "\r\n" . '			    if( !objField.item(i).selected && objField.item(i).value != \'\' )' . "\r\n" . '			    {' . "\r\n" . '			       isHaveNoCheck = true;' . "\r\n" . '				   break;' . "\r\n" . '			    }' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	return isHaveNoCheck;' . "\r\n" . '}' . "\r\n" . '';

?>
