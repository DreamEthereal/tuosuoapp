<?php
//dezend by http://www.yunlu99.com/
echo 'function create_autorank_qtn(questionID)' . "\r\n" . '{' . "\r\n" . '	var theInfoQtnName = qNoScriptString(QtnListArray[questionID].questionName);' . "\r\n" . '	//显示题目名称' . "\r\n" . '	var questionRequire = \'\';' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var questionNotes = \'\';' . "\r\n" . '	var minOption = maxOption = \'\';' . "\r\n" . '	if( QtnListArray[questionID].isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		questionRequire = \'<span class=red>*</span>\';' . "\r\n" . '		if( QtnListArray[questionID].minOption != 0 )' . "\r\n" . '		{' . "\r\n" . '		   minOption = \'[最少\'+QtnListArray[questionID].minOption+\'项]\';' . "\r\n" . '		}' . "\r\n" . '		if( QtnListArray[questionID].maxOption != 0 )' . "\r\n" . '		{' . "\r\n" . '		   maxOption = \'[最多\'+QtnListArray[questionID].maxOption+\'项]\';' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	questionName = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionName));' . "\r\n" . '	questionNotes = \'[自动排序题]\';' . "\r\n" . '	questionNotes += minOption;' . "\r\n" . '	questionNotes += maxOption;' . "\r\n" . '' . "\r\n" . '	var dataqtn = "{ ";' . "\r\n" . '    dataqtn += " questionID: "+questionID+",";' . "\r\n" . '    dataqtn += " questionRequire: \'"+questionRequire+"\',";' . "\r\n" . '    dataqtn += " questionName: \'"+qShowQtnName(questionName,questionID,1)+"\',";' . "\r\n" . '    dataqtn += " questionNotes: \'"+questionNotes+"\',";' . "\r\n" . '    questionTips = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionNotes));' . "\r\n" . '    dataqtn += " questionTips: \'"+qShowQtnName(questionTips,questionID,2)+"\',";' . "\r\n" . '' . "\r\n" . '	//来源问题及选项' . "\r\n" . '	var theBaseID = QtnListArray[questionID].baseID;' . "\r\n" . '	var theBaseQtnArray = QtnListArray[theBaseID];' . "\r\n" . '	var theCheckBoxListArray = CheckBoxListArray[theBaseQtnArray.questionID];' . "\r\n" . '' . "\r\n" . '	//来源问题不存在' . "\r\n" . '	if( count(theBaseQtnArray)==0 && QtnListArray[questionID].isRequired == 1)' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_no_con_list += "\\tshowMessage(\'"+theInfoQtnName+"，来源问题不存在或已被删除\');return false;\\n";' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//处理检查项' . "\r\n" . '	var check_survey_form_no_con_list = \'\';' . "\r\n" . '' . "\r\n" . '	var optionAutoArray = [];' . "\r\n" . '	var optionMinMaxArray = [];' . "\r\n" . '	var i=0;' . "\r\n" . '	for( var question_checkboxID in theCheckBoxListArray )' . "\r\n" . '	{' . "\r\n" . '		var theQuestionArray = theCheckBoxListArray[question_checkboxID];' . "\r\n" . '		if( theBaseQtnArray.questionType == 3 )' . "\r\n" . '		{' . "\r\n" . '			optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '		}' . "\r\n" . '' . "\r\n" . '		if( theBaseQtnArray.questionType == 25 )  //组合多选' . "\r\n" . '		{' . "\r\n" . '			if( ! IsSamePage(questionID,theBaseID) ) //不同同页' . "\r\n" . '			{' . "\r\n" . '				if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '				{' . "\r\n" . '					optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						if( typeof dataIndex[\'TextOtherValue_\'+theBaseID+\'_\'+question_checkboxID] != \'undefined\' && dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID+\'_\'+question_checkboxID]] != \'\' )' . "\r\n" . '						{' . "\r\n" . '							optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName)+\'(\'+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID+\'_\'+question_checkboxID]])+\')\';' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				optionAutoArray[question_checkboxID] = qJsonCharFilter(theQuestionArray.optionName);' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		optionMinMaxArray[i] = question_checkboxID;' . "\r\n" . '		i++;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//来源问题的最大与最少ID值' . "\r\n" . '	var theFirstID = (optionMinMaxArray[0] != \'\') ? optionMinMaxArray[0] : 0;' . "\r\n" . '	var theLastID = (optionMinMaxArray[count(optionMinMaxArray)-1] != \'\' ) ? optionMinMaxArray[count(optionMinMaxArray)-1] :0;' . "\r\n" . '' . "\r\n" . '	//有其他项' . "\r\n" . '	if( theBaseQtnArray.isHaveOther == 1 )' . "\r\n" . '	{' . "\r\n" . '		optionMinMaxArray[i] = 0;' . "\r\n" . '		if( ! IsSamePage(questionID,theBaseID) ) //不同同页' . "\r\n" . '		{' . "\r\n" . '			if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '			{' . "\r\n" . '				optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( count(dataRow.rows) != 0 )' . "\r\n" . '				{' . "\r\n" . '					if( dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID]] != \'\' )' . "\r\n" . '					{' . "\r\n" . '						optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText)+\'(\'+qJsonCharFilter(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theBaseID]])+\')\';' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			optionAutoArray[0] = qJsonCharFilter(theBaseQtnArray.otherText);' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	var isHaveOther = (theBaseQtnArray.isHaveOther != \'\' ) ? theBaseQtnArray.isHaveOther : 0;' . "\r\n" . '' . "\r\n" . '    dataqtn += " baseID: \'"+theBaseID+"\',";' . "\r\n" . '	var theOptionAutoIDList = \'\';' . "\r\n" . '    dataqtn += " qtns:[ ";' . "\r\n" . '	for( var tmp in optionMinMaxArray )' . "\r\n" . '	{' . "\r\n" . '		var optionAutoID = optionMinMaxArray[tmp];' . "\r\n" . '		var optionAutoName = optionAutoArray[optionAutoID];' . "\r\n" . '		theOptionAutoIDList += optionAutoID+\',\';' . "\r\n" . '' . "\r\n" . '		dataqtn += "{";' . "\r\n" . '		dataqtn += " optionName: \'"+optionAutoName+"\',";' . "\r\n" . '		dataqtn += " optionNameID: \'"+optionAutoID+"\',";' . "\r\n" . '		dataqtn += " optionID: \'option_"+questionID+\'_\'+optionAutoID+"\',";' . "\r\n" . '		dataqtn += " endScale: \'"+count(optionAutoArray)+"\',";' . "\r\n" . '		if( count(dataRow.rows) != 0 )' . "\r\n" . '		{' . "\r\n" . '			if( dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+optionAutoID]] != \'0\' )' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " value:\'"+dataRow.rows[0][dataIndex[\'option_\'+questionID+\'_\'+optionAutoID]]+"\'";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				dataqtn += " value:\'\'";' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += " value:\'\'";' . "\r\n" . '		}' . "\r\n" . '		dataqtn += "},";' . "\r\n" . '' . "\r\n" . '		//处理页面字段' . "\r\n" . '		this_fields_list += \'option_\'+questionID+\'_\'+optionAutoID+\'|\';' . "\r\n" . '		this_fields_type += \'3|\';' . "\r\n" . '	}' . "\r\n" . '	dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '' . "\r\n" . '	//选项生成' . "\r\n" . '	var theBaseValueList = \'\';' . "\r\n" . '	if( count(theBaseQtnArray) != 0 && ! IsSamePage(questionID,theBaseID) )  //不在同页' . "\r\n" . '	{' . "\r\n" . '		var theOriValue = \'\';' . "\r\n" . '		var theSelectNum = 0;' . "\r\n" . '		if( count(dataRow.rows) != 0 )' . "\r\n" . '		{' . "\r\n" . '			if( dataRow.rows[0][dataIndex[\'option_\'+theBaseID]] != \'0\' && dataRow.rows[0][dataIndex[\'option_\'+theBaseID]] != \'\' )' . "\r\n" . '			{' . "\r\n" . '				theOriValue = dataRow.rows[0][dataIndex[\'option_\'+theBaseID]];' . "\r\n" . '				theSelectNum = count(dataRow.rows[0][dataIndex[\'option_\'+theBaseID]].split(\',\'));' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		theOptionAutoIDList = substr(theOptionAutoIDList,0,-1);' . "\r\n" . '		theBaseValueList = theOriValue;' . "\r\n" . '		theOriValue = \',\'+theOriValue+\',\';' . "\r\n" . '		if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoRankNoSamePageIsNeg("+theBaseID+",\'"+theOptionAutoIDList+"\',\'"+theOriValue+"\',"+questionID+","+theFirstID+","+theLastID+");\\n";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoRankNoSamePage("+theBaseID+",\'"+theOptionAutoIDList+"\',\'"+theOriValue+"\',"+questionID+","+theFirstID+","+theLastID+");\\n";' . "\r\n" . '		}' . "\r\n" . '		var isSamePage = 0;' . "\r\n" . '		var theBaseIsSelect = 0;' . "\r\n" . '	}' . "\r\n" . '	else   //同页' . "\r\n" . '	{' . "\r\n" . '		var isSamePage = 1;' . "\r\n" . '		var theSelectNum = 0;' . "\r\n" . '		var theBaseIsSelect = (count(theBaseQtnArray)==0) ? 0 : theBaseQtnArray.isSelect;' . "\r\n" . '		if( QtnListArray[questionID].isNeg == 1 )' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoRankSamePageIsNeg("+theBaseID+","+theBaseIsSelect+","+questionID+","+theFirstID+","+theLastID+");\\n";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tgetAutoRankSamePage("+theBaseID+","+theBaseIsSelect+","+questionID+","+theFirstID+","+theLastID+");\\n";' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//判断排序号合法值' . "\r\n" . '	check_survey_form_no_con_list += "\\tif (!CheckAutoRank("+questionID+",\'"+theInfoQtnName+"\',"+QtnListArray[questionID].isRequired+","+QtnListArray[questionID].minOption+","+QtnListArray[questionID].maxOption+")){return false;}\\n ";' . "\r\n" . '' . "\r\n" . '	//逻辑条件' . "\r\n" . '	var QuestionCon = _GetQuestionCond(questionID,qid);' . "\r\n" . '	var theBaseIsSelect = (count(theBaseQtnArray) ==0 ) ? 0 : theBaseQtnArray.isSelect;' . "\r\n" . '    var theIsSamePage = IsSamePage(questionID,theBaseID)? 1:0 ;' . "\r\n" . '	var getCheckBoxNoneofAbove = "_getCheckBoxNoneofAbove("+theBaseQtnArray.questionType+","+theBaseID+","+theBaseIsSelect+","+theIsSamePage+","+QtnListArray[questionID].isNeg+",\'"+theBaseValueList+"\')";' . "\r\n" . '	if( QuestionCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+QuestionCon+" && "+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '' . "\r\n" . '		check_form_list = "\\tif("+QuestionCon+" && "+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '		check_form_list += check_survey_form_no_con_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		//移除已回复的值' . "\r\n" . '		check_form_list += "\\telse{\\n";' . "\r\n" . '		check_form_list += "\\t\\tAutoRankUnInput("+questionID+");";' . "\r\n" . '		check_form_list += "\\t}\\n";    ' . "\r\n" . '		check_survey_form_list += check_form_list;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '		if( check_survey_form_no_con_list != \'\' )' . "\r\n" . '		{' . "\r\n" . '			check_form_list = "\\tif("+getCheckBoxNoneofAbove+")\\n\\t{\\n";' . "\r\n" . '			check_form_list += check_survey_form_no_con_list;' . "\r\n" . '			check_form_list += "\\t}\\n";' . "\r\n" . '			check_survey_form_list += check_form_list;' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;{$questionRequire}<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0 width=100% id="qtn_table_{$questionID}">{foreach $qtns as $i => $qtn}<tr style="display:none" id="rank_{$baseID}_{$questionID}_{$qtn.optionNameID}"><td class="answer tdheight optcont" align="left" id="rankcheck_{$baseID}_{$questionID}_{$qtn.optionNameID}" nowrap><input type="hidden" name="{$qtn.optionID}" id="{$qtn.optionID}" value="{$qtn.value}" class="sortinput"><span class="sortnum"></span>&nbsp;<span id="optionName_20_{$questionID}_{$qtn.optionNameID}">{$qtn.optionName}</span></td></tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '' . "\r\n" . '	check_survey_conditions_list += "\\tchangeMaskingSingleQtnBgColor("+questionID+");\\n";' . "\r\n" . '' . "\r\n" . '	//问卷结束条件' . "\r\n" . '	var EndSurveyCon = _GetSurveyQuotaCond(questionID,qid,\'cn\');' . "\r\n" . '	if( EndSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		survey_quota_list += EndSurveyCon;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '	//$(\'#survey_content_container\').append( t.fetch(jsondata)); ' . "\r\n" . '    survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '    jsondata = null;' . "\r\n" . '	optionAutoArray = null;' . "\r\n" . '	optionMinMaxArray = null;' . "\r\n" . '	theBaseQtnArray = null;' . "\r\n" . '	theCheckBoxListArray = null;' . "\r\n" . '	theQuestionArray = null;' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//自动选项同页展现' . "\r\n" . 'function getAutoRankSamePage(baseID,isList,questionID,theFirstID,theLastID)' . "\r\n" . '{' . "\r\n" . '	 var objField = eval( "document.Survey_Form.option_" + baseID );' . "\r\n" . '	 if (objField != null ){' . "\r\n" . '		 if( isList == 1 )  //列表框' . "\r\n" . '		 {' . "\r\n" . '			 for( i=0;i<objField.options.length;i++ ) {' . "\r\n" . '			   theOptionObj = eval("document.getElementById(\'rank_"+baseID+"_"+questionID+"_"+objField.options[i].value+"\')");' . "\r\n" . '			   if( theOptionObj != null ){' . "\r\n" . '				   if( objField.options[i].selected && objField.options[i].value != \'\')' . "\r\n" . '				   {' . "\r\n" . '						theOptionObj.style.display = \'\';' . "\r\n" . '				   }' . "\r\n" . '				   else' . "\r\n" . '				   {' . "\r\n" . '						theOptionObj.style.display = \'none\';' . "\r\n" . '						var theObj = $(\'#rankcheck_\'+baseID+\'_\'+questionID+\'_\'+objField.options[i].value);' . "\r\n" . '						if(theObj != null ){' . "\r\n" . '							//原值' . "\r\n" . '							var u = theObj.find("span.sortnum").html();' . "\r\n" . '							if( u != \'\' ){' . "\r\n" . '								//回显' . "\r\n" . '								theObj.find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '								//赋值' . "\r\n" . '								theObj.find("input.sortinput").val(\'\');' . "\r\n" . '								theObj.attr("check","");' . "\r\n" . '' . "\r\n" . '								//重新计算' . "\r\n" . '								$("#qtn_table_"+questionID).find("td[check=\'1\']").each(function(){' . "\r\n" . '									var w = $(this).find("span.sortnum").html();' . "\r\n" . '									if( w-u > 0){' . "\r\n" . '										//回显' . "\r\n" . '										$(this).find("span.sortnum").html(w-1);' . "\r\n" . '										//赋值' . "\r\n" . '										$(this).find("input.sortinput").val(w-1);' . "\r\n" . '									}' . "\r\n" . '								});' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '				    }' . "\r\n" . '			    }' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			 for( i=0;i<objField.length;i++ ) {' . "\r\n" . '			   var theOptionObj = eval("document.getElementById(\'rank_"+baseID+"_"+questionID+"_"+objField[i].value+"\')");' . "\r\n" . '			   if( theOptionObj != null ){' . "\r\n" . '				   if(objField[i].checked ){theOptionObj.style.display = \'\';}' . "\r\n" . '				   else{' . "\r\n" . '						theOptionObj.style.display = \'none\';' . "\r\n" . '						var theObj = $(\'#rankcheck_\'+baseID+\'_\'+questionID+\'_\'+objField[i].value);' . "\r\n" . '						if(theObj != null ){' . "\r\n" . '							//原值' . "\r\n" . '							var u = theObj.find("span.sortnum").html();' . "\r\n" . '							if( u != \'\' ){' . "\r\n" . '								//回显' . "\r\n" . '								theObj.find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '								//赋值' . "\r\n" . '								theObj.find("input.sortinput").val(\'\');' . "\r\n" . '								theObj.attr("check","");' . "\r\n" . '' . "\r\n" . '								//重新计算' . "\r\n" . '								$("#qtn_table_"+questionID).find("td[check=\'1\']").each(function(){' . "\r\n" . '									var w = $(this).find("span.sortnum").html();' . "\r\n" . '									if( w-u > 0){' . "\r\n" . '										//回显' . "\r\n" . '										$(this).find("span.sortnum").html(w-1);' . "\r\n" . '										//赋值' . "\r\n" . '										$(this).find("input.sortinput").val(w-1);' . "\r\n" . '									}' . "\r\n" . '								});' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '				    }' . "\r\n" . '			    }' . "\r\n" . '			}' . "\r\n" . '		} //End for if' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function getAutoRankNoSamePage(baseID,theAllValue,theSelectValue,questionID,theFirstID,theLastID)' . "\r\n" . '{' . "\r\n" . '    var theAllValueArray = theAllValue.split(\',\');' . "\r\n" . '	for(i=0;i<=theAllValueArray.length-1;i++){' . "\r\n" . '	    var theOptionObj = eval("document.getElementById(\'rank_"+baseID+"_"+questionID+"_"+theAllValueArray[i]+"\')");' . "\r\n" . '		if( theOptionObj != null ){' . "\r\n" . '			if( theSelectValue.indexOf(","+theAllValueArray[i]+",") == -1 ){' . "\r\n" . '				theOptionObj.style.display = \'none\';' . "\r\n" . '				var theObj = $(\'#rankcheck_\'+baseID+\'_\'+questionID+\'_\'+theAllValueArray[i]);' . "\r\n" . '				if(theObj != null ){' . "\r\n" . '					//原值' . "\r\n" . '					var u = theObj.find("span.sortnum").html();' . "\r\n" . '					if( u != \'\' ){' . "\r\n" . '						//回显' . "\r\n" . '						theObj.find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '						//赋值' . "\r\n" . '						theObj.find("input.sortinput").val(\'\');' . "\r\n" . '						theObj.attr("check","");' . "\r\n" . '' . "\r\n" . '						//重新计算' . "\r\n" . '						$("#qtn_table_"+questionID).find("td[check=\'1\']").each(function(){' . "\r\n" . '							var w = $(this).find("span.sortnum").html();' . "\r\n" . '							if( w-u > 0){' . "\r\n" . '								//回显' . "\r\n" . '								$(this).find("span.sortnum").html(w-1);' . "\r\n" . '								//赋值' . "\r\n" . '								$(this).find("input.sortinput").val(w-1);' . "\r\n" . '							}' . "\r\n" . '						});' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				theOptionObj.style.display = \'\';' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//自动选项同页展现' . "\r\n" . 'function getAutoRankSamePageIsNeg(baseID,isList,questionID,theFirstID,theLastID)' . "\r\n" . '{' . "\r\n" . '	 var objField = eval( "document.Survey_Form.option_" + baseID );' . "\r\n" . '	 if (objField != null ){' . "\r\n" . '		 if( isList == 1 )  //列表框' . "\r\n" . '		 {' . "\r\n" . '			 for( i=0;i<objField.options.length;i++ ) {' . "\r\n" . '			   theOptionObj = eval("document.getElementById(\'rank_"+baseID+"_"+questionID+"_"+objField.options[i].value+"\')");' . "\r\n" . '			   if( theOptionObj != null ){' . "\r\n" . '				   if( objField.options[i].selected != true && objField.options[i].value != \'\')' . "\r\n" . '				   {' . "\r\n" . '						theOptionObj.style.display = \'\';' . "\r\n" . '				   }' . "\r\n" . '				   else' . "\r\n" . '				   {' . "\r\n" . '						theOptionObj.style.display = \'none\';' . "\r\n" . '						var theObj = $(\'#rankcheck_\'+baseID+\'_\'+questionID+\'_\'+objField.options[i].value);' . "\r\n" . '						if(theObj != null ){' . "\r\n" . '							//原值' . "\r\n" . '							var u = theObj.find("span.sortnum").html();' . "\r\n" . '							if( u != \'\' ){' . "\r\n" . '								//回显' . "\r\n" . '								theObj.find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '								//赋值' . "\r\n" . '								theObj.find("input.sortinput").val(\'\');' . "\r\n" . '								theObj.attr("check","");' . "\r\n" . '' . "\r\n" . '								//重新计算' . "\r\n" . '								$("#qtn_table_"+questionID).find("td[check=\'1\']").each(function(){' . "\r\n" . '									var w = $(this).find("span.sortnum").html();' . "\r\n" . '									if( w-u > 0){' . "\r\n" . '										//回显' . "\r\n" . '										$(this).find("span.sortnum").html(w-1);' . "\r\n" . '										//赋值' . "\r\n" . '										$(this).find("input.sortinput").val(w-1);' . "\r\n" . '									}' . "\r\n" . '								});' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '				    }' . "\r\n" . '			    }' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			 for( i=0;i<objField.length;i++ ) {' . "\r\n" . '			   theOptionObj = eval("document.getElementById(\'rank_"+baseID+"_"+questionID+"_"+objField[i].value+"\')");' . "\r\n" . '			   if( theOptionObj != null ){' . "\r\n" . '				   if(objField[i].checked != true )' . "\r\n" . '				   {' . "\r\n" . '						theOptionObj.style.display = \'\';' . "\r\n" . '				   }' . "\r\n" . '				   else' . "\r\n" . '				   {' . "\r\n" . '						theOptionObj.style.display = \'none\';' . "\r\n" . '						var theObj = $(\'#rankcheck_\'+baseID+\'_\'+questionID+\'_\'+objField[i].value);' . "\r\n" . '						if(theObj != null ){' . "\r\n" . '							//原值' . "\r\n" . '							var u = theObj.find("span.sortnum").html();' . "\r\n" . '							if( u != \'\' ){' . "\r\n" . '								//回显' . "\r\n" . '								theObj.find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '								//赋值' . "\r\n" . '								theObj.find("input.sortinput").val(\'\');' . "\r\n" . '								theObj.attr("check","");' . "\r\n" . '' . "\r\n" . '								//重新计算' . "\r\n" . '								$("#qtn_table_"+questionID).find("td[check=\'1\']").each(function(){' . "\r\n" . '									var w = $(this).find("span.sortnum").html();' . "\r\n" . '									if( w-u > 0){' . "\r\n" . '										//回显' . "\r\n" . '										$(this).find("span.sortnum").html(w-1);' . "\r\n" . '										//赋值' . "\r\n" . '										$(this).find("input.sortinput").val(w-1);' . "\r\n" . '									}' . "\r\n" . '								});' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '				    }' . "\r\n" . '			    }' . "\r\n" . '			}' . "\r\n" . '		} //End for if' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function getAutoRankNoSamePageIsNeg(baseID,theAllValue,theSelectValue,questionID,theFirstID,theLastID)' . "\r\n" . '{' . "\r\n" . '    var theAllValueArray = theAllValue.split(\',\');' . "\r\n" . '	for(i=0;i<=theAllValueArray.length-1;i++){' . "\r\n" . '	    theOptionObj = eval("document.getElementById(\'rank_"+baseID+"_"+questionID+"_"+theAllValueArray[i]+"\')");' . "\r\n" . '		if( theOptionObj != null ){' . "\r\n" . '			if( theSelectValue.indexOf(","+theAllValueArray[i] + ",") != -1 ){' . "\r\n" . '				theOptionObj.style.display = \'none\';' . "\r\n" . '				var theObj = $(\'#rankcheck_\'+baseID+\'_\'+questionID+\'_\'+theAllValueArray[i]);' . "\r\n" . '				if(theObj != null ){' . "\r\n" . '					//原值' . "\r\n" . '					var u = theObj.find("span.sortnum").html();' . "\r\n" . '					if( u != \'\' ){' . "\r\n" . '						//回显' . "\r\n" . '						theObj.find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '						//赋值' . "\r\n" . '						theObj.find("input.sortinput").val(\'\');' . "\r\n" . '						theObj.attr("check","");' . "\r\n" . '' . "\r\n" . '						//重新计算' . "\r\n" . '						$("#qtn_table_"+questionID).find("td[check=\'1\']").each(function(){' . "\r\n" . '							var w = $(this).find("span.sortnum").html();' . "\r\n" . '							if( w-u > 0){' . "\r\n" . '								//回显' . "\r\n" . '								$(this).find("span.sortnum").html(w-1);' . "\r\n" . '								//赋值' . "\r\n" . '								$(this).find("input.sortinput").val(w-1);' . "\r\n" . '							}' . "\r\n" . '						});' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				theOptionObj.style.display = \'\';' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//移除排序题的值' . "\r\n" . 'function AutoRankUnInput(questionID)' . "\r\n" . '{' . "\r\n" . '	$("#qtn_table_"+questionID).find("td.optcont").each(function(){' . "\r\n" . '		var v = $(this).find("input.sortinput").val(\'\');' . "\r\n" . '	});' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//判断排序' . "\r\n" . 'function CheckAutoRank(questionID,strText,isRequired,minOption,maxOption)' . "\r\n" . '{' . "\r\n" . '	if( isRequired == 1 )' . "\r\n" . '	{' . "\r\n" . '		var isOrder = 0;' . "\r\n" . '		$("#qtn_table_"+questionID).find("td.optcont").each(function(){' . "\r\n" . '			var v = $(this).find("input.sortinput").val();' . "\r\n" . '			if(	v != \'\' ){' . "\r\n" . '				isOrder++;' . "\r\n" . '			}' . "\r\n" . '		});' . "\r\n" . '        if( minOption != 0 )' . "\r\n" . '		{		' . "\r\n" . '			if( isOrder < minOption)' . "\r\n" . '			{' . "\r\n" . '				showMessage( strText + "最少必须进行" + minOption + "项排序");' . "\r\n" . '				return false;' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '		    if( isOrder < 1 )' . "\r\n" . '		    {' . "\r\n" . '				showMessage( strText + "最少必须进行1项排序");' . "\r\n" . '				return false;' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '        if( maxOption != 0 )' . "\r\n" . '		{		' . "\r\n" . '			if( isOrder > maxOption)' . "\r\n" . '			{' . "\r\n" . '				showMessage( strText + "最多只能进行" + maxOption + "项排序");' . "\r\n" . '				return false;' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	return true;' . "\r\n" . '}';

?>
