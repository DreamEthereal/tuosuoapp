<?php
//dezend by http://www.yunlu99.com/
echo '//矩阵填空题' . "\r\n" . 'function create_multipletext_qtn(questionID)' . "\r\n" . '{' . "\r\n" . '	var theInfoQtnName = qNoScriptString(QtnListArray[questionID].questionName);' . "\r\n" . '	var tplText = \'<table width="100%" class="pertable" id="question_{$questionID}"><tr><td class="question" valign=center>&nbsp;<span class="textEdit" id="questionName_{$questionID}">{$questionName}</span>&nbsp;<span class=notes>{$questionNotes}</span></td></tr><tr><td class="tips"><span class="textEdit" id="questionNotes_{$questionID}">{$questionTips}</span></td></tr><tr><td><table cellSpacing=0 cellPadding=0 id="qtn_table_{$questionID}"><tr class=tdheight><td>&nbsp;</td><td width=8></td>{foreach $answers as $j => $answer}<td class="answer" align="center" nowrap valign=center><span class="textEdit" id="optionLabel_27_{$questionID}_{$answer.optionLabelID}">{$answer.optionLabelName}</span></td><td width=10></td>{/foreach}</tr>{foreach $qtns as $i => $qtn}<tr class=tdheight id="range_multitext_{$qtn.optionNameID}_container"><td class="answer" nowrap>&nbsp;&nbsp;<span class="textEdit" id="optionName_27_{$questionID}_{$qtn.optionNameID}">{$qtn.optionName}</span></td><td width=8></td>{$qtn.sub_option_list}</tr>{/foreach}</table></td></tr></table>\';' . "\r\n" . '' . "\r\n" . '	//显示题目' . "\r\n" . '	var check_survey_form_no_con_list = \'\';' . "\r\n" . '	var questionName = \'\';' . "\r\n" . '	var questionNotes = \'\';' . "\r\n" . '	questionName = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionName));' . "\r\n" . '	questionNotes = \'[矩阵填空题]\';' . "\r\n" . '' . "\r\n" . '	var dataqtn = "{ ";' . "\r\n" . '	dataqtn += " questionID: "+questionID+",";' . "\r\n" . '    dataqtn += " questionName: \'"+qShowQtnName(questionName,questionID,1)+"\',";' . "\r\n" . '	dataqtn += " questionNotes: \'"+questionNotes+"\',";' . "\r\n" . '	questionTips = qQuotaChar(qJsonCharFilter(QtnListArray[questionID].questionNotes));' . "\r\n" . '	dataqtn += " questionTips: \'"+qShowQtnName(questionTips,questionID,2)+"\',";' . "\r\n" . '' . "\r\n" . '    var optionTotalNum = count(OptionListArray[questionID]),t=0;' . "\r\n" . '    for(var tmp in OptionListArray[questionID] )' . "\r\n" . '	{' . "\r\n" . '		if( t == 0 )' . "\r\n" . '		{' . "\r\n" . '			var theMinOptionID = tmp;' . "\r\n" . '		}' . "\r\n" . '		if( t == optionTotalNum-1 )' . "\r\n" . '		{' . "\r\n" . '			var theMaxOptionID = tmp;' . "\r\n" . '		}' . "\r\n" . '	    t++;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	dataqtn += " answers:[";' . "\r\n" . '	for( var question_range_labelID in LabelListArray[questionID] )' . "\r\n" . '	{' . "\r\n" . '		dataqtn += "{";' . "\r\n" . '		var theLabelArray = LabelListArray[questionID][question_range_labelID];' . "\r\n" . '		if( theLabelArray.isRequired == 1 )' . "\r\n" . '		{' . "\r\n" . '			dataqtn += "optionLabelName:\'"+qJsonCharFilter(theLabelArray.optionLabel)+"&nbsp;<span class=red>*</span>\',";' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			dataqtn += "optionLabelName:\'"+qJsonCharFilter(theLabelArray.optionLabel)+"\',";' . "\r\n" . '		}' . "\r\n" . '		dataqtn += "optionLabelID:\'"+question_range_labelID+"\'";' . "\r\n" . '		dataqtn += "},";' . "\r\n" . '		if( theLabelArray.isRequired == 1 && QtnListArray[questionID].requiredMode == 1 )' . "\r\n" . '		{' . "\r\n" . '			var theOptionJsName = theInfoQtnName+\' - \'+qNoScriptString(theLabelArray.optionLabel);' . "\r\n" . '			check_survey_form_no_con_list += "\\tif (!CheckMultipleText("+questionID+","+question_range_labelID+","+theMinOptionID+","+theMaxOptionID+",\'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	' . "\r\n" . '	dataqtn = dataqtn.substr(0,dataqtn.length-1)+"],";' . "\r\n" . '	dataqtn += " qtns:[ ";' . "\r\n" . '' . "\r\n" . '	var remove_value_list = \'\';' . "\r\n" . '	for( var question_range_optionID in OptionListArray[questionID] )' . "\r\n" . '	{' . "\r\n" . '		var theQuestionArray = OptionListArray[questionID][question_range_optionID];' . "\r\n" . '		dataqtn += "{";' . "\r\n" . '		dataqtn += " optionName:\'"+qJsonCharFilter(theQuestionArray.optionName)+"\',";' . "\r\n" . '		dataqtn += " optionNameID:\'"+question_range_optionID+"\',";' . "\r\n" . '		var sub_option_list = \'\';' . "\r\n" . '' . "\r\n" . '		//矩阵行关联' . "\r\n" . '		var QtnAssCon = _GetQtnAssCond(questionID,question_range_optionID);' . "\r\n" . '		var remove_value_list_qtn = \'\';' . "\r\n" . '' . "\r\n" . '		for( var question_range_labelID in LabelListArray[questionID] )' . "\r\n" . '		{' . "\r\n" . '			var theLabelArray = LabelListArray[questionID][question_range_labelID];' . "\r\n" . '			var theOptionID = \'option_\'+questionID+\'_\'+question_range_optionID+\'_\'+question_range_labelID;' . "\r\n" . '' . "\r\n" . '			sub_option_list += \'<td class="answer" align="center"><input onblur="jQuery.Check_Survey_Conditions();" name="\'+theOptionID+\'" id="\'+theOptionID+\'" size="\'+theLabelArray.optionSize+\'"\';' . "\r\n" . '			if( count(dataRow.rows) != 0 )' . "\r\n" . '			{' . "\r\n" . '				sub_option_list += " value=\\""+qhtmlspecialchars(dataRow.rows[0][dataIndex[theOptionID]])+"\\"";' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				sub_option_list += " value=\\"\\"";' . "\r\n" . '			}' . "\r\n" . '			switch( theLabelArray.isCheckType )' . "\r\n" . '			{' . "\r\n" . '				case 4:  //数值' . "\r\n" . '				case 8:  //企业法人代码' . "\r\n" . '				case 9:  //邮政编码' . "\r\n" . '					sub_option_list += " type=\\"number\\" ";' . "\r\n" . '				break;' . "\r\n" . '				case 5:  //电话' . "\r\n" . '				case 11:  //手机' . "\r\n" . '					sub_option_list += " type=\\"tel\\" ";' . "\r\n" . '				break;' . "\r\n" . '				case 6:  //日期' . "\r\n" . '					sub_option_list += " type=\\"text\\" onclick=\\"javascript:seldate(this)\\" ";' . "\r\n" . '				break;' . "\r\n" . '				default:' . "\r\n" . '					sub_option_list += " type=\\"text\\" ";' . "\r\n" . '				break;' . "\r\n" . '			}' . "\r\n" . '			sub_option_list += \'"></td><td width=10></td>\';' . "\r\n" . '' . "\r\n" . '			//处理页面字段' . "\r\n" . '			this_fields_list += theOptionID+\'|\';' . "\r\n" . '			this_fields_type += \'3|\';' . "\r\n" . '			' . "\r\n" . '			//页面检查' . "\r\n" . '			var theOptionJsName = theInfoQtnName+\' - \'+qNoScriptString(theQuestionArray.optionName)+\' - \'+qNoScriptString(theLabelArray.optionLabel);' . "\r\n" . '			if( QtnAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				if( theLabelArray.isRequired == 1 && QtnListArray[questionID].requiredMode == 2 )' . "\r\n" . '				{' . "\r\n" . '					check_survey_form_no_con_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t\\tTextUnInput(document.Survey_Form."+theOptionID+");\\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t} \\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\telse{ \\n";' . "\r\n" . '					check_survey_form_no_con_list += "\\t\\tif(!CheckNotNull(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n\\t} \\n";' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				if( theLabelArray.isRequired == 1 && QtnListArray[questionID].requiredMode == 2 )' . "\r\n" . '				{' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckNotNull(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			switch( theLabelArray.isCheckType )' . "\r\n" . '			{' . "\r\n" . '				case 1:  //Email' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckEmail(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 2:  //长度' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckStringLength(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\',"+theLabelArray.minOption+","+theLabelArray.maxOption+")){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 3:  //中文' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckNoChinese(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 4:  //数值' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckIsValue(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\',"+theLabelArray.minOption+","+theLabelArray.maxOption+")){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 5:  //电话' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckPhone(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 6:  //日期' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckDate(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 7:  //身份证' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckIDCardNo(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 8:  //企业法人代码' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckCorpCode(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 9:  //邮政编码' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckPostalCode(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 10:  //URL' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckURL(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 11:  //手机' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckMobile(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '				case 12:  //中文' . "\r\n" . '					check_survey_form_no_con_list += "\\tif (!CheckChinese(document.Survey_Form."+theOptionID+", \'"+theOptionJsName+"\')){return false;}\\n";' . "\r\n" . '				break;' . "\r\n" . '			}' . "\r\n" . '			//记录移除值' . "\r\n" . '			remove_value_list +="\\tTextUnInput(document.Survey_Form."+theOptionID+");\\n";' . "\r\n" . '			if( QtnAssCon != \'\' )' . "\r\n" . '			{' . "\r\n" . '				remove_value_list_qtn +="\\t\\tTextUnInput(document.Survey_Form."+theOptionID+");\\n";' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		dataqtn += "sub_option_list:\'"+sub_option_list+"\' ";' . "\r\n" . '		dataqtn += "},";' . "\r\n" . '' . "\r\n" . '		//矩阵行关联' . "\r\n" . '		if( QtnAssCon != \'\' )' . "\r\n" . '		{' . "\r\n" . '			check_survey_conditions_list += "\\tif("+QtnAssCon+")\\n\\t{\\n";' . "\r\n" . '			check_survey_conditions_list += "\\t\\t$(\\"#range_multitext_"+question_range_optionID+"_container\\").hide();\\n";			' . "\r\n" . '			check_survey_conditions_list += remove_value_list_qtn;' . "\r\n" . '			check_survey_conditions_list += "\\t} \\n";' . "\r\n" . '			check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '			check_survey_conditions_list += "\\t\\t$(\\"#range_multitext_"+question_range_optionID+"_container\\").show();\\n\\t} \\n";' . "\r\n" . '		}	' . "\r\n" . '	}' . "\r\n" . '	dataqtn = dataqtn.substr(0,dataqtn.length-1)+"] }";' . "\r\n" . '' . "\r\n" . '	//逻辑条件' . "\r\n" . '	var QuestionCon = _GetQuestionCond(questionID,qid);' . "\r\n" . '	if( QuestionCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		check_survey_conditions_list += "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').show();\\n\\t} \\n";' . "\r\n" . '		check_survey_conditions_list += "\\telse { \\n";' . "\r\n" . '		check_survey_conditions_list += "\\t\\t$(\'#question_"+questionID+"\').hide();\\n\\t} \\n";' . "\r\n" . '' . "\r\n" . '		var check_form_list = "\\tif("+QuestionCon+")\\n\\t{\\n";' . "\r\n" . '		check_form_list += check_survey_form_no_con_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		//移除已回复的值' . "\r\n" . '		check_form_list += "\\telse{\\n";' . "\r\n" . '		check_form_list += remove_value_list;' . "\r\n" . '		check_form_list += "\\t}\\n";' . "\r\n" . '		' . "\r\n" . '		check_survey_form_list += check_form_list;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		check_survey_form_list += check_survey_form_no_con_list;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//关联关系' . "\r\n" . '	var RelSurveyCon = _GetSurveyValueRelationCond(questionID,qid,\'cn\');' . "\r\n" . '	if( RelSurveyCon != \'\' )' . "\r\n" . '	{' . "\r\n" . '		//此题存在多个数值关联关系的检查点' . "\r\n" . '		var theRelSurveyCon = RelSurveyCon.split(\'$$$$$$\');' . "\r\n" . '		for( var t in theRelSurveyCon )' . "\r\n" . '		{' . "\r\n" . '			var tRelSurveyCon = theRelSurveyCon[t].split(\'######\');' . "\r\n" . '			if( parseInt(tRelSurveyCon[0]) == 2 ) //空题' . "\r\n" . '			{' . "\r\n" . '				survey_empty_list += tRelSurveyCon[1];' . "\r\n" . '				var theEmptyList = tRelSurveyCon[1].split(\'*\');' . "\r\n" . '				var theEmptyId = parseInt(substr(theEmptyList[7],0,-3));' . "\r\n" . '				if( !IsSamePage(theEmptyId,questionID)) //不在同页' . "\r\n" . '				{' . "\r\n" . '					//空题字段' . "\r\n" . '					this_fields_list += \'option_\'+theEmptyId+\'|\';' . "\r\n" . '					this_fields_type += \'3|\';' . "\r\n" . '					//跑一遍空题的配额表达式' . "\r\n" . '					var theEmptyEndSurveyCon = _GetSurveyQuotaCond(theEmptyId,qid,\'cn\');' . "\r\n" . '					if( theEmptyEndSurveyCon != \'\' )' . "\r\n" . '					{' . "\r\n" . '						survey_quota_list += theEmptyEndSurveyCon;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				theEmptyList = null;' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				survey_quota_list += tRelSurveyCon[1];' . "\r\n" . '			}' . "\r\n" . '			tRelSurveyCon = null;' . "\r\n" . '		}' . "\r\n" . '		theRelSurveyCon = null;' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//改变背景颜色' . "\r\n" . '	check_survey_conditions_list += "\\tchangeMaskingQtnBgColor("+questionID+");\\n";' . "\r\n" . '' . "\r\n" . '    var jsondata = eval(\'(\'+dataqtn+\')\');' . "\r\n" . '	var t = new jSmart(tplText);' . "\r\n" . '	//$(\'#survey_content_container\').append( t.fetch(jsondata)); ' . "\r\n" . '	survey_content_container_html += t.fetch(jsondata);' . "\r\n" . '	jsondata = null;' . "\r\n" . '	theQuestionArray = null;' . "\r\n" . '	theLabelArray = null;' . "\r\n" . '}';

?>
