<?php
//dezend by http://www.yunlu99.com/
echo 'var check_survey_form_list = \'\';' . "\r\n" . 'var check_survey_conditions_list = \'\';' . "\r\n" . 'var this_fields_list = \'\';' . "\r\n" . 'var this_fields_type = \'\';' . "\r\n" . 'var this_file_list = \'\';' . "\r\n" . 'var this_size_list = \'\';' . "\r\n" . 'var this_hidden_list = \'\';' . "\r\n" . 'var this_check_list = \'\';' . "\r\n" . 'var survey_quota_list = \'\';' . "\r\n" . 'var survey_empty_list = \'\';' . "\r\n" . 'var thisCheckStr = \'\';' . "\r\n" . 'var emptyCheckStr = \'\';' . "\r\n" . '' . "\r\n" . 'var theMgtFunc =0;' . "\r\n" . 'var theResponseID = rid;' . "\r\n" . 'var theJoinTime = 0;' . "\r\n" . 'var theOriRecFile = \'\';' . "\r\n" . 'var theNowRecFile = \'\';' . "\r\n" . 'var theOriOverFlag = 0;' . "\r\n" . 'var actionFlag = 0;' . "\r\n" . '' . "\r\n" . 'var thisPageStep =0;' . "\r\n" . 'var theActionPage = 1;' . "\r\n" . 'var theHaveRatingSlider = false;' . "\r\n" . 'var theHaveDatePicker = false;' . "\r\n" . 'var dataRow;' . "\r\n" . 'var dataIndex = [];' . "\r\n" . 'var survey_content_container_html = \'\';' . "\r\n" . '' . "\r\n" . 'var quota_info_id =0;' . "\r\n" . 'var is_record_file = 0;' . "\r\n" . 'var rec_file_time = 0;' . "\r\n" . '' . "\r\n" . 'var isCell = rexseeHashMap.get(\'enableq\',\'isCell\');' . "\r\n" . 'var isLocalGps = 1;' . "\r\n" . '' . "\r\n" . 'var cascadeArray = [];' . "\r\n" . 'var cascadeOpts = [];' . "\r\n" . '' . "\r\n" . 'function show_survey_page_0()' . "\r\n" . '{' . "\r\n" . '	$("#survey_content_container").empty();' . "\r\n" . '	$(\'#actionButtonContainer\').empty();' . "\r\n" . '' . "\r\n" . '	check_survey_conditions_list = \'\';' . "\r\n" . '	this_fields_list = \'\';' . "\r\n" . '	this_fields_type = \'\';' . "\r\n" . '	this_file_list = \'\';' . "\r\n" . '	this_size_list = \'\';' . "\r\n" . '	this_hidden_list = \'\';' . "\r\n" . '	this_check_list = \'\';' . "\r\n" . '	survey_quota_list = \'\';' . "\r\n" . '	survey_empty_list = \'\';' . "\r\n" . '	thisCheckStr = \'\';' . "\r\n" . '	emptyCheckStr = \'\';' . "\r\n" . '	theHaveRatingSlider = false;' . "\r\n" . '	theHaveDatePicker = false;' . "\r\n" . '' . "\r\n" . '	//进度条' . "\r\n" . '	if( PagesBreakArray.length > 1  && parseInt(surveyRow.rows[0][9] ) == 1 )' . "\r\n" . '	{' . "\r\n" . '		var thePageStepPointer = thisPageStep+1;' . "\r\n" . '		$(\'#processValueId\').html("&nbsp;<font color=white>"+thePageStepPointer+"/"+ PagesBreakArray.length+"</font>&nbsp;");' . "\r\n" . '		document.getElementById(\'processBarContainer\').style.display = \'none\';' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		document.getElementById(\'processBarContainer\').style.display = \'none\';' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	var questionID=0;' . "\r\n" . '	' . "\r\n" . '	if( dataRow.rows[0][dataIndex[\'taskID\']] != 0 ) //有任务' . "\r\n" . '	{' . "\r\n" . '		survey_content_container_html = \'\';' . "\r\n" . '		check_survey_form_list = \'\';' . "\r\n" . '		survey_content_container_html = \'<table width="100%" class="pertable"><tr><td height=5></td></tr><tr><td class="surveybegin">&nbsp;<span class=red>*</span><span class="taskName">任务名称：</span><input name="panel_name" id="panel_name" type="text" value="\'+qhtmlspecialchars(dataRow.rows[0][dataIndex[\'administratorsName\']])+\'" readonly size=30></td></tr><tr><td class="surveybegin">&nbsp;<span class=red>*</span><span class="taskName">任务描述：</span><input name="address_name" id="address_name" type="text" value="\'+qhtmlspecialchars(dataRow.rows[0][dataIndex[\'ipAddress\']])+\'" readonly size=40>&nbsp;&nbsp;</td></tr></table>\\n\';' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		survey_content_container_html = \'\';' . "\r\n" . '		check_survey_form_list = \'\';' . "\r\n" . '		if( parseInt(surveyRow.rows[0][5]) == 1 )' . "\r\n" . '		{' . "\r\n" . '			if( count(dataRow.rows) != 0 )' . "\r\n" . '			{' . "\r\n" . '				var panel_name = qhtmlspecialchars(dataRow.rows[0][dataIndex[\'administratorsName\']]);' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				var panel_name = \'\';' . "\r\n" . '			}' . "\r\n" . '			survey_content_container_html = \'<table width="100%" class="pertable"><tr><td height=5></td></tr><tr><td class="surveybegin">&nbsp;<span class=red>*</span><span class="taskName">样本标识标记：</span><input name="panel_name" id="panel_name" maxlength=30 type="text" value="\'+panel_name+\'" size=30>&nbsp;&nbsp;</td></tr></table>\\n\';' . "\r\n" . '			check_survey_form_list = "if (!CheckNotNull(document.Survey_Form.panel_name, \'样本标识标记\')){return false;}\\n";' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	cascadeArray = []; //初始化' . "\r\n" . '	cascadeOpts = [];' . "\r\n" . '	var temp = 0;' . "\r\n" . '	var rankIdArray = [],ranktid=0;' . "\r\n" . '	if( typeof PagesListArray[0] != \'undefined\') {' . "\r\n" . '	for(var i=0;i<PagesListArray[0].length;i++)' . "\r\n" . '	{' . "\r\n" . '		questionID = PagesListArray[0][i];' . "\r\n" . '		switch( QtnListArray[questionID].questionType )' . "\r\n" . '		{' . "\r\n" . '			case 1:' . "\r\n" . '				create_yesno_qtn(questionID);' . "\r\n" . '			break;			' . "\r\n" . '			case 2:' . "\r\n" . '				create_radio_qtn(questionID);' . "\r\n" . '			break;			' . "\r\n" . '			case 3:' . "\r\n" . '				create_checkbox_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 4:' . "\r\n" . '				create_text_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 5:' . "\r\n" . '				create_textarea_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 6:' . "\r\n" . '				create_range_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 7:' . "\r\n" . '				create_multiple_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 9:' . "\r\n" . '				create_info_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 10:' . "\r\n" . '				rankIdArray[ranktid] = questionID;' . "\r\n" . '				ranktid++;' . "\r\n" . '				create_rank_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 11:' . "\r\n" . '				create_upload_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 12:' . "\r\n" . '			case 13:' . "\r\n" . '				continue;' . "\r\n" . '			break;' . "\r\n" . '			case 14:' . "\r\n" . '				create_list_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 15:' . "\r\n" . '				create_rating_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 16:' . "\r\n" . '				create_weight_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 17:' . "\r\n" . '				create_auto_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 18:' . "\r\n" . '				create_cond_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 19:' . "\r\n" . '				create_autorange_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 20:' . "\r\n" . '				rankIdArray[ranktid] = questionID;' . "\r\n" . '				ranktid++;' . "\r\n" . '				create_autorank_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 21:' . "\r\n" . '				create_autorating_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 22:' . "\r\n" . '				create_autoweight_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 23:' . "\r\n" . '				create_combtext_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 24:' . "\r\n" . '				create_combradio_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 25:' . "\r\n" . '				create_combcheckbox_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 26:' . "\r\n" . '				create_combrange_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 27:' . "\r\n" . '				create_multipletext_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 28:' . "\r\n" . '				create_automultiple_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 29:' . "\r\n" . '				create_automultipletext_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 30:' . "\r\n" . '				create_empty_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 31:' . "\r\n" . '				cascadeArray[temp] = questionID;' . "\r\n" . '				temp++;' . "\r\n" . '				create_cascade_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '		}' . "\r\n" . '	}}' . "\r\n" . '' . "\r\n" . '	//isFingerDrawing' . "\r\n" . '	if( PagesBreakArray.length == 1 && parseInt(surveyRow.rows[0][8] ) == 1 )' . "\r\n" . '	{' . "\r\n" . '		create_fingerdrawing();' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	$(\'#thisFields\').val(base64_encode(this_fields_list));' . "\r\n" . '	$(\'#thisType\').val(this_fields_type);' . "\r\n" . '	$(\'#thisFiles\').val(this_file_list);' . "\r\n" . '	$(\'#thisSizes\').val(this_size_list);' . "\r\n" . '	$(\'#thisHidden\').val(this_hidden_list);' . "\r\n" . '	$(\'#allHidden\').val(this_hidden_list);' . "\r\n" . '	$(\'#allFields\').val(base64_encode(this_fields_list));' . "\r\n" . '	$(\'#hiddenFields\').html(\'\');' . "\r\n" . '	$(\'#thisCheck\').val(this_check_list);' . "\r\n" . '	$(\'#thisStep\').val(0);' . "\r\n" . '' . "\r\n" . '	$("#survey_content_container").html(survey_content_container_html);' . "\r\n" . '	//document.getElementById(\'survey_content_container\').innerHTML = survey_content_container_html;' . "\r\n" . '	' . "\r\n" . '	//处理排序' . "\r\n" . '	for(var t = 0 ; t < rankIdArray.length; t++)' . "\r\n" . '	{' . "\r\n" . '		var ranktid = rankIdArray[t];' . "\r\n" . '		//回显原值' . "\r\n" . '		$("#qtn_table_"+ranktid).find("td.optcont").each(function(){' . "\r\n" . '			var v = $(this).find("input.sortinput").val();' . "\r\n" . '			if(	v != \'\' ){' . "\r\n" . '				$(this).find("span.sortnum").html(v).addClass("sortnum-chk");' . "\r\n" . '				$(this).attr("check","1");		' . "\r\n" . '			}' . "\r\n" . '		});' . "\r\n" . '		$("#qtn_table_"+ranktid+" td.optcont").bind("click",function(v){' . "\r\n" . '				if(!$(this).attr("check")){' . "\r\n" . '					var u = $("#qtn_table_"+ranktid).find("td[check=\'1\']").length+1;' . "\r\n" . '					//回显' . "\r\n" . '					$(this).find("span.sortnum").html(u).addClass("sortnum-chk");' . "\r\n" . '					//赋值' . "\r\n" . '					$(this).find("input.sortinput").val(u);' . "\r\n" . '					$(this).attr("check","1");' . "\r\n" . '				}' . "\r\n" . '				else{' . "\r\n" . '					var u = $(this).find("span.sortnum").html();' . "\r\n" . '					$("#qtn_table_"+ranktid).find("td[check=\'1\']").each(function(){' . "\r\n" . '						var w = $(this).find("span.sortnum").html();' . "\r\n" . '						if( w-u > 0){' . "\r\n" . '							//回显' . "\r\n" . '							$(this).find("span.sortnum").html(w-1);' . "\r\n" . '							//赋值' . "\r\n" . '							$(this).find("input.sortinput").val(w-1);' . "\r\n" . '						}' . "\r\n" . '					});' . "\r\n" . '					//回显' . "\r\n" . '					$(this).find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '					//赋值' . "\r\n" . '					$(this).find("input.sortinput").val(\'\');' . "\r\n" . '					$(this).attr("check","");' . "\r\n" . '				}' . "\r\n" . '				jQuery.Check_Survey_Conditions();' . "\r\n" . '		});' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//按钮' . "\r\n" . '	var action_button_html = \'\';' . "\r\n" . '	if( PagesBreakArray.length > 1 )' . "\r\n" . '	{' . "\r\n" . '		if( parseInt(surveyRow.rows[0][4] ) == 1 && actionFlag == 0)' . "\r\n" . '		{' . "\r\n" . '			action_button_html += "<input class=btn type=button value=\\"放弃，返回\\" name=\\"SurveyCancelSubmit\\" id=\\"SurveyCancelSubmit\\" onclick=\\"javascript:pageCancelSubmit();\\">&nbsp;";' . "\r\n" . '		}' . "\r\n" . '		action_button_html += "<input class=btn type=button value=\\"中断，结束\\" name=\\"SurveyCacheSubmit\\" id=\\"SurveyCacheSubmit\\"  onclick=\\"javascript:pageCacheSubmit();\\">&nbsp;";' . "\r\n" . '		action_button_html += "<input class=btn type=button value=\\"  下一页  \\" name=\\"SurveyNextSubmit\\" id=\\"SurveyNextSubmit\\" onclick=\\"javascript:document.Survey_Form.Action.value = \'SurveyNextSubmit\'; Survey_Form_Submit();\\">";' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{ 		' . "\r\n" . '		if( parseInt(surveyRow.rows[0][4] ) == 1 && actionFlag == 0 )' . "\r\n" . '		{' . "\r\n" . '			action_button_html += "<input class=btn type=button value=\\"放弃，返回\\" name=\\"SurveyCancelSubmit\\" id=\\"SurveyCancelSubmit\\" onclick=\\"javascript:pageCancelSubmit();\\">&nbsp;";' . "\r\n" . '		}' . "\r\n" . '		action_button_html += "&nbsp;<input class=btn type=button value=\\"完成，结束\\" name=\\"SurveyOverSubmit\\" id=\\"SurveyOverSubmit\\" onclick=\\"javascript:pageOverSubmit();\\">";' . "\r\n" . '    }' . "\r\n" . '	$(\'#actionButtonContainer\').html(action_button_html);' . "\r\n" . '	scroll(0, 0);' . "\r\n" . '}' . "\r\n" . 'function pageCancelSubmit()' . "\r\n" . '{' . "\r\n" . '	if( parseInt(surveyRow.rows[0][4] ) == 1)' . "\r\n" . '	{' . "\r\n" . '		rexseeAudioCapture.stop();' . "\r\n" . '		rexseePush.remove(876543212);' . "\r\n" . '		rexseePush.add(\'id=876543212;message=关闭全程录音机;title=关闭全程录音机;\');' . "\r\n" . '		rexseeDialog.toast(\'全程录音机已帮您关闭！不会再录音啦！\');' . "\r\n" . '		setTimeout(function(){},1000);' . "\r\n" . '	}' . "\r\n" . '	$(\'#actionButtonContainer\').empty();' . "\r\n" . '	rexseeChronometer.show(\'label:正在放弃当前的问卷回复数据，并准备返回...;align:left;background-color:transparent;color:#000000;border-width:0;window-style:light;\',3,\'javascript:LocatCancelIndex();\');' . "\r\n" . '}' . "\r\n" . 'function LocatCancelIndex()' . "\r\n" . '{' . "\r\n" . '	var theTmpFileFile = rexseeStorage.getRoot()+\'enableq_offline/files/\'+qid+\'/r_\'+nickUserId+\'_\'+date(\'YmdHis\',rec_file_time)+\'_\'+qid+\'.amr.qf\';' . "\r\n" . '	if( rexseeFile.exists(theTmpFileFile) )' . "\r\n" . '	{' . "\r\n" . '		rexseeFile.remove(theTmpFileFile);' . "\r\n" . '	}' . "\r\n" . '	returnPage();' . "\r\n" . '}  ' . "\r\n" . 'function pageCacheSubmit()' . "\r\n" . '{' . "\r\n" . '	if ( window.confirm(\'该操作将中断并结束当前问卷的回复进程，您确定继续该动作？!\'))' . "\r\n" . '	{' . "\r\n" . '		document.Survey_Form.Action.value = \'SurveyCacheSubmit\';' . "\r\n" . '		Survey_Form.nextStep.value = \'2\';' . "\r\n" . '		Survey_Form_Submit();' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '/*function pageNextSubmit()' . "\r\n" . '{' . "\r\n" . '	document.Survey_Form.Action.value = \'SurveyOverSubmit\';' . "\r\n" . '	Survey_Form.nextStep.value = \'1\';' . "\r\n" . '	Survey_Form_Submit();' . "\r\n" . '}*/' . "\r\n" . '' . "\r\n" . 'function pageOverSubmit()' . "\r\n" . '{' . "\r\n" . '	document.Survey_Form.Action.value = \'SurveyOverSubmit\';' . "\r\n" . '	Survey_Form.nextStep.value = \'2\';' . "\r\n" . '	Survey_Form_Submit();' . "\r\n" . '}' . "\r\n" . 'function show_survey_page()' . "\r\n" . '{' . "\r\n" . '	$("#survey_content_container").empty();' . "\r\n" . '	$(\'#actionButtonContainer\').empty();' . "\r\n" . '' . "\r\n" . '	check_survey_form_list = \'\';' . "\r\n" . '	check_survey_conditions_list = \'\';' . "\r\n" . '	this_fields_list = \'\';' . "\r\n" . '	this_fields_type = \'\';' . "\r\n" . '	this_file_list = \'\';' . "\r\n" . '	this_size_list = \'\';' . "\r\n" . '	this_hidden_list = \'\';' . "\r\n" . '	this_check_list = \'\';' . "\r\n" . '	survey_quota_list = \'\';' . "\r\n" . '	survey_empty_list = \'\';' . "\r\n" . '	thisCheckStr = \'\';' . "\r\n" . '	emptyCheckStr = \'\';' . "\r\n" . '	theHaveRatingSlider = false;' . "\r\n" . '	theHaveDatePicker = false;' . "\r\n" . '	' . "\r\n" . '	//进度条' . "\r\n" . '	if( PagesBreakArray.length > 1 && parseInt(surveyRow.rows[0][9] ) == 1 )' . "\r\n" . '	{' . "\r\n" . '		var thePageStepPointer = thisPageStep+1;' . "\r\n" . '		$(\'#processValueId\').html("&nbsp;<font color=white>"+thePageStepPointer+"/"+ PagesBreakArray.length+"</font>&nbsp;");' . "\r\n" . '		document.getElementById(\'processBarContainer\').style.display = \'none\';' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		document.getElementById(\'processBarContainer\').style.display = \'none\';' . "\r\n" . '	}' . "\r\n" . '	' . "\r\n" . '	var questionID=0;' . "\r\n" . '	survey_content_container_html = \'\';' . "\r\n" . '	cascadeArray = []; //初始化' . "\r\n" . '	cascadeOpts = [];' . "\r\n" . '	var temp = 0;' . "\r\n" . '	var rankIdArray = [],ranktid=0;' . "\r\n" . '	if( typeof PagesListArray[thisPageStep] != \'undefined\') {' . "\r\n" . '	for(var i=0;i<PagesListArray[thisPageStep].length;i++)' . "\r\n" . '	{' . "\r\n" . '		questionID = PagesListArray[thisPageStep][i];' . "\r\n" . '		switch( QtnListArray[questionID].questionType )' . "\r\n" . '		{' . "\r\n" . '			case 1:' . "\r\n" . '				create_yesno_qtn(questionID);' . "\r\n" . '			break;			' . "\r\n" . '			case 2:' . "\r\n" . '				create_radio_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 3:' . "\r\n" . '				create_checkbox_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 4:' . "\r\n" . '				create_text_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 5:' . "\r\n" . '				create_textarea_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 6:' . "\r\n" . '				create_range_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 7:' . "\r\n" . '				create_multiple_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 9:' . "\r\n" . '				create_info_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 10:' . "\r\n" . '				rankIdArray[ranktid] = questionID;' . "\r\n" . '				ranktid++;' . "\r\n" . '				create_rank_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 11:' . "\r\n" . '				create_upload_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 12:' . "\r\n" . '			case 13:' . "\r\n" . '				continue;' . "\r\n" . '			break;' . "\r\n" . '			case 14:' . "\r\n" . '				create_list_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 15:' . "\r\n" . '				create_rating_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 16:' . "\r\n" . '				create_weight_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 17:' . "\r\n" . '				create_auto_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 18:' . "\r\n" . '				create_cond_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 19:' . "\r\n" . '				create_autorange_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 20:' . "\r\n" . '				rankIdArray[ranktid] = questionID;' . "\r\n" . '				ranktid++;' . "\r\n" . '				create_autorank_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 21:' . "\r\n" . '				create_autorating_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 22:' . "\r\n" . '				create_autoweight_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 23:' . "\r\n" . '				create_combtext_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 24:' . "\r\n" . '				create_combradio_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 25:' . "\r\n" . '				create_combcheckbox_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 26:' . "\r\n" . '				create_combrange_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 27:' . "\r\n" . '				create_multipletext_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 28:' . "\r\n" . '				create_automultiple_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 29:' . "\r\n" . '				create_automultipletext_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 30:' . "\r\n" . '				create_empty_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '			case 31:' . "\r\n" . '				cascadeArray[temp] = questionID;' . "\r\n" . '				temp++;' . "\r\n" . '				create_cascade_qtn(questionID);' . "\r\n" . '			break;' . "\r\n" . '		}' . "\r\n" . '	}}' . "\r\n" . '' . "\r\n" . '	//isFingerDrawing' . "\r\n" . '	if( thisPageStep == count(PagesBreakArray)-1 && parseInt(surveyRow.rows[0][8] ) == 1 )' . "\r\n" . '	{' . "\r\n" . '		create_fingerdrawing();' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	$(\'#thisFields\').val(base64_encode(this_fields_list));' . "\r\n" . '	$(\'#thisType\').val(this_fields_type);' . "\r\n" . '	$(\'#thisHidden\').val(this_hidden_list);' . "\r\n" . '	$(\'#thisFiles\').val(this_file_list);' . "\r\n" . '	$(\'#thisSizes\').val(this_size_list);' . "\r\n" . '	$(\'#thisCheck\').val(this_check_list);' . "\r\n" . '	$(\'#thisStep\').val(thisPageStep);' . "\r\n" . '	$("#survey_content_container").html(survey_content_container_html);' . "\r\n" . '	//document.getElementById(\'survey_content_container\').innerHTML = survey_content_container_html;' . "\r\n" . '' . "\r\n" . '	//处理排序' . "\r\n" . '	for(var t = 0 ; t < rankIdArray.length; t++)' . "\r\n" . '	{' . "\r\n" . '		var ranktid = rankIdArray[t];' . "\r\n" . '		//回显原值' . "\r\n" . '		$("#qtn_table_"+ranktid).find("td.optcont").each(function(){' . "\r\n" . '			var v = $(this).find("input.sortinput").val();' . "\r\n" . '			if(	v != \'\' ){' . "\r\n" . '				$(this).find("span.sortnum").html(v).addClass("sortnum-chk");' . "\r\n" . '				$(this).attr("check","1");		' . "\r\n" . '			}' . "\r\n" . '		});' . "\r\n" . '		$("#qtn_table_"+ranktid+" td.optcont").bind("click",function(v){' . "\r\n" . '				if(!$(this).attr("check")){' . "\r\n" . '					var u = $("#qtn_table_"+ranktid).find("td[check=\'1\']").length+1;' . "\r\n" . '					//回显' . "\r\n" . '					$(this).find("span.sortnum").html(u).addClass("sortnum-chk");' . "\r\n" . '					//赋值' . "\r\n" . '					$(this).find("input.sortinput").val(u);' . "\r\n" . '					$(this).attr("check","1");' . "\r\n" . '				}' . "\r\n" . '				else{' . "\r\n" . '					var u = $(this).find("span.sortnum").html();' . "\r\n" . '					$("#qtn_table_"+ranktid).find("td[check=\'1\']").each(function(){' . "\r\n" . '						var w = $(this).find("span.sortnum").html();' . "\r\n" . '						if( w-u > 0){' . "\r\n" . '							//回显' . "\r\n" . '							$(this).find("span.sortnum").html(w-1);' . "\r\n" . '							//赋值' . "\r\n" . '							$(this).find("input.sortinput").val(w-1);' . "\r\n" . '						}' . "\r\n" . '					});' . "\r\n" . '					//回显' . "\r\n" . '					$(this).find("span.sortnum").html("").removeClass("sortnum-chk");' . "\r\n" . '					//赋值' . "\r\n" . '					$(this).find("input.sortinput").val(\'\');' . "\r\n" . '					$(this).attr("check","");' . "\r\n" . '				}' . "\r\n" . '				jQuery.Check_Survey_Conditions();' . "\r\n" . '		});' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//按钮' . "\r\n" . '	if( thisPageStep != count(PagesBreakArray)-1 ) //不为最后分页标记' . "\r\n" . '	{' . "\r\n" . '		action_button_html = "<input class=btn type=button value=\\"  上一页  \\" name=\\"SurveyPreSubmit\\" id=\\"SurveyPreSubmit\\" onclick=\\"javascript:document.Survey_Form.Action.value = \'SurveyPreSubmit\';Survey_Form_Submit();\\">&nbsp;";' . "\r\n" . '		action_button_html += "<input class=btn type=button value=\\"中断，结束\\" name=\\"SurveyCacheSubmit\\" id=\\"SurveyCacheSubmit\\" onclick=\\"javascript:pageCacheSubmit();\\">&nbsp;";' . "\r\n" . '		action_button_html += "<input class=btn type=button value=\\"  下一页  \\" name=\\"SurveyNextSubmit\\" id=\\"SurveyNextSubmit\\" onclick=\\"javascript:document.Survey_Form.Action.value = \'SurveyNextSubmit\'; Survey_Form_Submit();\\">";' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		action_button_html = "<input class=btn type=button value=\\"  上一页  \\" name=\\"SurveyPreSubmit\\" id=\\"SurveyPreSubmit\\" onclick=\\"javascript:document.Survey_Form.Action.value = \'SurveyPreSubmit\';Survey_Form_Submit();\\">&nbsp;";' . "\r\n" . '		action_button_html += "&nbsp;<input class=btn type=button value=\\"完成，结束\\" name=\\"SurveyOverSubmit\\" id=\\"SurveyOverSubmit\\" onclick=\\"javascript:pageOverSubmit();\\">";' . "\r\n" . '    }' . "\r\n" . '	$(\'#actionButtonContainer\').html(action_button_html);' . "\r\n" . '	scroll(0, 0);' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '$(window).load(function(){' . "\r\n" . '    //判断问卷有效' . "\r\n" . '	dataRow = eval(\'(\'+ getDbRows(\'SELECT * FROM eq_response_\'+qid+\' WHERE responseID =\'+rid+\' LIMIT 1\',\'rexsee:enableq.db\')+\')\');' . "\r\n" . '	var theColNameArray = new Array(\'responseID\',\'administratorsGroupID\',\'ajaxRtnValue_1\',\'ajaxRtnValue_2\',\'ajaxRtnValue_3\',\'ajaxRtnValue_4\',\'ajaxRtnValue_5\',\'ajaxRtnValue_6\',\'area\',\'submitTime\',\'overTime\',\'cateID\',\'overFlag0\',\'authStat\',\'version\',\'adminID\',\'line1Number\',\'deviceId\',\'brand\',\'model\',\'currentCity\',\'simOperatorName\',\'simSerialNumber\',\'gpsTime\',\'accuracy\',\'longitude\',\'latitude\',\'speed\',\'bearing\',\'altitude\');' . "\r\n" . '	for( var tmp in dataRow.columns )' . "\r\n" . '	{' . "\r\n" . '		if( in_array(dataRow.columns[tmp],theColNameArray) == false )' . "\r\n" . '		{' . "\r\n" . '			dataIndex[dataRow.columns[tmp]] = tmp;' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '	theOriRecFile = dataRow.rows[0][dataIndex[\'recordFile\']];' . "\r\n" . '	theJoinTime = dataRow.rows[0][dataIndex[\'joinTime\']];' . "\r\n" . '	theColNameArray = null;' . "\r\n" . '	//初始化' . "\r\n" . '	var theReplyPage = parseInt(dataRow.rows[0][dataIndex[\'replyPage\']]);' . "\r\n" . '	var theOverFlag = parseInt(dataRow.rows[0][dataIndex[\'overFlag\']]);' . "\r\n" . '	//原有完成标记' . "\r\n" . '	theOriOverFlag = theOverFlag;' . "\r\n" . '	if( theReplyPage != 0 && theOverFlag == 0 )' . "\r\n" . '	{' . "\r\n" . '		//断点' . "\r\n" . '		thisPageStep = theReplyPage;' . "\r\n" . '' . "\r\n" . '		var thisBreakAllHidden = \'\';' . "\r\n" . '		var thisBreakAllFields = \'\';' . "\r\n" . '		this_fields_list = \'\';' . "\r\n" . '		this_hidden_list = \'\';' . "\r\n" . '		for( var tmp in PagesListArray )' . "\r\n" . '		{' . "\r\n" . '			var thePageQtnList = PagesListArray[tmp];' . "\r\n" . '			if( tmp >= thisPageStep ) break;' . "\r\n" . '			for( var k in thePageQtnList )' . "\r\n" . '			{' . "\r\n" . '				var questionID = thePageQtnList[k];' . "\r\n" . '				switch( QtnListArray[questionID].questionType )' . "\r\n" . '				{' . "\r\n" . '					case 1:' . "\r\n" . '						yesno_fields(questionID);' . "\r\n" . '					break;			' . "\r\n" . '					case 2:' . "\r\n" . '						radio_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 3:' . "\r\n" . '						checkbox_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 4:' . "\r\n" . '						text_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 5:' . "\r\n" . '						textarea_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 6:' . "\r\n" . '						range_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 7:' . "\r\n" . '						multiple_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 10:' . "\r\n" . '						rank_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 11:' . "\r\n" . '						upload_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 9:' . "\r\n" . '					case 12:' . "\r\n" . '					case 13:' . "\r\n" . '						continue;' . "\r\n" . '					break;' . "\r\n" . '					case 14:' . "\r\n" . '						list_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 15:' . "\r\n" . '						rating_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 16:' . "\r\n" . '						weight_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 17:' . "\r\n" . '						auto_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 18:' . "\r\n" . '						cond_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 19:' . "\r\n" . '						autorange_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 20:' . "\r\n" . '						autorank_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 21:' . "\r\n" . '						autorating_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 22:' . "\r\n" . '						autoweight_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 23:' . "\r\n" . '						combtext_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 24:' . "\r\n" . '						combradio_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 25:' . "\r\n" . '						combcheckbox_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 26:' . "\r\n" . '						combrange_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 27:' . "\r\n" . '						multipletext_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 28:' . "\r\n" . '						automultiple_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 29:' . "\r\n" . '						automultipletext_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 30:' . "\r\n" . '						empty_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '					case 31:' . "\r\n" . '						cascade_fields(questionID);' . "\r\n" . '					break;' . "\r\n" . '				}//end of switch' . "\r\n" . '			}//end of for' . "\r\n" . '		}' . "\r\n" . '		thisBreakAllFields += this_fields_list;' . "\r\n" . '		this_fields_list = \'\';' . "\r\n" . '		thisBreakAllHidden += this_hidden_list;' . "\r\n" . '		this_hidden_list = \'\';' . "\r\n" . '' . "\r\n" . '		//打开问卷' . "\r\n" . '		show_survey_page();' . "\r\n" . '' . "\r\n" . '		//本页应有的逻辑题值' . "\r\n" . '		$(\'#allHidden\').val(thisBreakAllHidden+this_hidden_list);' . "\r\n" . '		//本页的全部字段' . "\r\n" . '		$(\'#allFields\').val(base64_encode(thisBreakAllFields+this_fields_list+this_file_list));' . "\r\n" . '		//前述页面传递给本页的逻辑题值' . "\r\n" . '		var hiddenFields = \'\';' . "\r\n" . '		var lastPageFieldsList = substr(thisBreakAllFields,0,-1);' . "\r\n" . '		//前页的全部字段' . "\r\n" . '		if( lastPageFieldsList != \'\' )' . "\r\n" . '		{' . "\r\n" . '			var lastPageFields = lastPageFieldsList.split(\'|\');' . "\r\n" . '			for( var tmp in lastPageFields )' . "\r\n" . '			{' . "\r\n" . '				var lastFields = lastPageFields[tmp];' . "\r\n" . '				//存在逻辑关系' . "\r\n" . '				if( in_array(lastFields,valueLogicQtnList) )' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						if(dataRow.rows[0][dataIndex[lastFields]] != \'\' )' . "\r\n" . '						{' . "\r\n" . '							var theTmpQtnArray = lastFields.split(\'_\');' . "\r\n" . '							switch(QtnListArray[theTmpQtnArray[1]].questionType)' . "\r\n" . '							{' . "\r\n" . '								case 2: //Radio' . "\r\n" . '									var theDatabaseValue = dataRow.rows[0][dataIndex[lastFields]];' . "\r\n" . '									if( theDatabaseValue == \'0\')' . "\r\n" . '									{' . "\r\n" . '										if( QtnListArray[theTmpQtnArray[1]].isHaveOther == 1 ) //Other' . "\r\n" . '										{' . "\r\n" . '											if(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theTmpQtnArray[1]]] == \'\' ) //Other' . "\r\n" . '											{' . "\r\n" . '												var lastFieldsValue = \'\';' . "\r\n" . '											}' . "\r\n" . '											else' . "\r\n" . '											{' . "\r\n" . '												var lastFieldsValue = \'0\';' . "\r\n" . '											}' . "\r\n" . '										}' . "\r\n" . '										else' . "\r\n" . '										{' . "\r\n" . '											var lastFieldsValue = \'\';' . "\r\n" . '										}' . "\r\n" . '									}' . "\r\n" . '									else' . "\r\n" . '									{' . "\r\n" . '										var lastFieldsValue = theDatabaseValue;' . "\r\n" . '									}											' . "\r\n" . '								break;' . "\r\n" . '								default:' . "\r\n" . '									var lastFieldsValue = dataRow.rows[0][dataIndex[lastFields]];' . "\r\n" . '								break;' . "\r\n" . '							}' . "\r\n" . '							theTmpQtnArray = null;' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							var lastFieldsValue = \'\';' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var lastFieldsValue = \'\';' . "\r\n" . '					}' . "\r\n" . '					//利用Input hidden传入' . "\r\n" . '					hiddenFields += "<input name=\\""+lastFields+"\\" id=\\""+lastFields+"\\" type=\\"hidden\\" value=\\""+lastFieldsValue+"\\">\\n\\t\\t";' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		$(\'#hiddenFields\').html(hiddenFields);' . "\r\n" . '		lastPageFields = null;' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		show_survey_page_0();' . "\r\n" . '	}' . "\r\n" . '  	InitSurveyPageData();' . "\r\n" . '' . "\r\n" . '	//删除所有原取得的GPS记录' . "\r\n" . '	var sql = " DELETE FROM eq_gps_trace WHERE flag=0 ;";' . "\r\n" . '	rexseeDatabase.exec(sql,\'rexsee:enableq.db\');' . "\r\n" . '	var sql = " DELETE FROM eq_gps_trace_upload WHERE flag=0 ;";' . "\r\n" . '	rexseeDatabase.exec(sql,\'rexsee:enableq.db\');' . "\r\n" . '});' . "\r\n" . '$(window).unload(function(){' . "\r\n" . '	//重新初始化' . "\r\n" . '	check_survey_form_list = \'\';' . "\r\n" . '	check_survey_conditions_list = \'\';' . "\r\n" . '	this_fields_list = \'\';' . "\r\n" . '	this_fields_type = \'\';' . "\r\n" . '	this_file_list = \'\';' . "\r\n" . '	this_size_list = \'\';' . "\r\n" . '	this_hidden_list = \'\';' . "\r\n" . '	this_check_list = \'\';' . "\r\n" . '	survey_quota_list = \'\';' . "\r\n" . '	survey_empty_list = \'\';' . "\r\n" . '	thisCheckStr = \'\';' . "\r\n" . '	emptyCheckStr = \'\';' . "\r\n" . '' . "\r\n" . '	theMgtFunc =0;' . "\r\n" . '	theResponseID = rid;' . "\r\n" . '	theJoinTime = 0;' . "\r\n" . '' . "\r\n" . '	thisPageStep =0;' . "\r\n" . '	theActionPage = 1;' . "\r\n" . '	theHaveRatingSlider = false;' . "\r\n" . '	theHaveDatePicker = false;' . "\r\n" . '	dataRow = null;' . "\r\n" . '	dataIndex = null;' . "\r\n" . '	survey_content_container_html = \'\';' . "\r\n" . '	quota_info_id =0;' . "\r\n" . '	is_record_file = 0;' . "\r\n" . '	rec_file_time = 0;' . "\r\n" . '' . "\r\n" . '	//释放内存' . "\r\n" . '	QtnListArray = null;' . "\r\n" . '	YesNoListArray = null;' . "\r\n" . '	RadioListArray = null;' . "\r\n" . '	CheckBoxListArray = null;' . "\r\n" . '	InfoListArray = null;' . "\r\n" . '	AnswerListArray = null;' . "\r\n" . '	OptionListArray = null;' . "\r\n" . '	LabelListArray = null;' . "\r\n" . '	RankListArray = null;' . "\r\n" . '	CondListArray = null;' . "\r\n" . '	ValueRelArray = null;' . "\r\n" . '	valueLogicQtnList = null;' . "\r\n" . '	QuotaListArray = null;' . "\r\n" . '	PagesListArray = null;' . "\r\n" . '	PagesBreakArray = null;' . "\r\n" . '});' . "\r\n" . 'window.onRexseeReady = function() {	' . "\r\n" . '    //处理终端信息' . "\r\n" . '	rexseeSpecialKey.enableBackKeyListener(false);' . "\r\n" . '	//设置屏幕始终打开' . "\r\n" . '	rexseeScreen.setScreenAlwaysOn(true);' . "\r\n" . '	//GPS' . "\r\n" . '	if( rexseeGps.isReady() )' . "\r\n" . '	{}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		rexseeDialog.toast("检测到设备GPS关闭，请启用GPS...");' . "\r\n" . '		if( parseInt(surveyRow.rows[0][7] ) == 1) //强行开启GPS' . "\r\n" . '		{' . "\r\n" . '			rexseeGps.openSettings();' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//开启全程录音' . "\r\n" . '	if( parseInt(surveyRow.rows[0][4] ) == 1)' . "\r\n" . '	{' . "\r\n" . '		var rt = window.prompt(\'3button\',\'title=录音提示;message=本调查问卷需要对回复的过程进行全程录音，现在开始录音？;options=开始录音|放弃返回;\');' . "\r\n" . '		if ( rt == \'开始录音\'){' . "\r\n" . '			var theTmpFilePath = rexseeStorage.getRoot()+\'enableq_offline/files/\'+qid;' . "\r\n" . '			if( ! rexseeFile.exists(theTmpFilePath) )' . "\r\n" . '			{' . "\r\n" . '				rexseeFile.newDir(theTmpFilePath);' . "\r\n" . '			}' . "\r\n" . '			is_record_file = 1;' . "\r\n" . '			rec_file_time = time();' . "\r\n" . '			rexseeAudioCapture.stop();' . "\r\n" . '			if( parseInt(surveyRow.rows[0][11] ) == 1)' . "\r\n" . '			{' . "\r\n" . '				rexseeDialog.toast(\'系统采用低质量录音参数进行录音！\');				rexseeAudioCapture.setArguments(\'format=RAW_AMR;audioSource=MIC;audioEncoder=AMR_NB;audioBitRate=12200;audioChannels=1;audioSamplingRate=8000;\');' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				rexseeDialog.toast(\'系统采用高质量录音参数进行录音！\');' . "\r\n" . '				rexseeAudioCapture.setArguments(\'format=RAW_AMR;audioSource=MIC;audioEncoder=AMR_NB;audioBitRate=96000;audioChannels=2;audioSamplingRate=44100;\');' . "\r\n" . '			}' . "\r\n" . '			theNowRecFile = \'r_\'+nickUserId+\'_\'+date(\'YmdHis\',rec_file_time)+\'_\'+qid+\'.amr.qf\';' . "\r\n" . '			rexseeAudioCapture.start(theTmpFilePath + \'/\' + theNowRecFile);' . "\r\n" . '			rexseePush.remove(876543211);' . "\r\n" . '		    rexseePush.add(\'id=876543211;message=开启全程录音机;title=开启全程录音机;\');' . "\r\n" . '			rexseeDialog.toast(\'全程录音机已开启，从现在开始录音啦！\');' . "\r\n" . '			document.getElementById(\'rtnimg\').style.display = \'none\' ;' . "\r\n" . '			rexseeMenu.setOptionsMenuId("");' . "\r\n" . '		}' . "\r\n" . '		else{' . "\r\n" . '			rexseeAudioCapture.stop();' . "\r\n" . '			rexseeDialog.toast(\'放弃全程录音，系统将转回调查数据列表！\');' . "\r\n" . '			returnPage();' . "\r\n" . '		}' . "\r\n" . '	}' . "\r\n" . '' . "\r\n" . '	//关闭滑到底部事件' . "\r\n" . '	try {' . "\r\n" . '	　　rexseeBrowser.setAllowScrollEvent(false);' . "\r\n" . '	} catch (e) {}' . "\r\n" . '}' . "\r\n" . 'function InitSurveyPageData()' . "\r\n" . '{' . "\r\n" . '	//初始化函数' . "\r\n" . '	eval("jQuery.Run_Survey_Conditions = function(){" + check_survey_conditions_list + "};");' . "\r\n" . '	eval("jQuery.Survey_Form_Validator = function(){ " + check_survey_form_list + "};");' . "\r\n" . '	eval("jQuery.Survey_Quota_List = function(){ " + survey_quota_list + "};");' . "\r\n" . '	eval("jQuery.Survey_Empty_List = function(){ " + survey_empty_list + "};");' . "\r\n" . '	eval("jQuery.Check_Survey_Conditions = function(){check_survey_empty();}");' . "\r\n" . '' . "\r\n" . '	//初始化级联选择' . "\r\n" . '	for(var u = 0; u < cascadeArray.length; u++)' . "\r\n" . '	{' . "\r\n" . '		eval(\'var cascade_cont_\'+cascadeArray[u]+\' = new LinkageSel(cascadeOpts[cascadeArray[u]]);\');' . "\r\n" . '		eval(\'cascade_cont_\'+cascadeArray[u]).onChange(jQuery.Check_Survey_Conditions);' . "\r\n" . '	}' . "\r\n" . '	cascadeArray = [];' . "\r\n" . '	cascadeOpts = [];' . "\r\n" . '' . "\r\n" . '	jQuery.Check_Survey_Conditions();' . "\r\n" . '	if( thisPageStep == 0 )' . "\r\n" . '	{' . "\r\n" . '		if( is_record_file == 0 )' . "\r\n" . '		{' . "\r\n" . '			document.getElementById(\'rtnimg\').style.display = \'\' ;' . "\r\n" . '			rexseeMenu.setOptionsMenuId("mainOptionsMenu1");' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			document.getElementById(\'rtnimg\').style.display = \'none\' ;' . "\r\n" . '			rexseeMenu.setOptionsMenuId("");' . "\r\n" . '		}			' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		document.getElementById(\'rtnimg\').style.display = \'none\' ;' . "\r\n" . '		rexseeMenu.setOptionsMenuId("");' . "\r\n" . '	}		' . "\r\n" . '	initLightbox();' . "\r\n" . '}' . "\r\n" . 'function Survey_Form_Submit()' . "\r\n" . '{' . "\r\n" . '	//清除问卷本页的jQuery.Check_Survey_Conditions函数定义' . "\r\n" . '	//eval("jQuery.Check_Survey_Conditions = function(){};");' . "\r\n" . '' . "\r\n" . '	//开始处理本页Form请求' . "\r\n" . '	var action = document.Survey_Form.Action.value;	' . "\r\n" . '	if( action == \'SurveyPreSubmit\')' . "\r\n" . '	{' . "\r\n" . '		//rexseeProgressDialog.show("正在努力为您加载...");' . "\r\n" . '		rexseeDialog.toast(\'正在努力为您加载...\');' . "\r\n" . '' . "\r\n" . '		if( document.getElementById(\'SurveyNextSubmit\') != null )  {  document.getElementById(\'SurveyNextSubmit\').disabled = true;  }' . "\r\n" . '		if( document.getElementById(\'SurveyCacheSubmit\') != null ) {  document.getElementById(\'SurveyCacheSubmit\').disabled = true; }' . "\r\n" . '		if( document.getElementById(\'SurveyCacheSubmit\') != null ) {  document.getElementById(\'SurveyCacheSubmit\').disabled = true; }' . "\r\n" . '		if( document.getElementById(\'SurveyPreSubmit\') != null )   {  document.getElementById(\'SurveyPreSubmit\').disabled = true;   }' . "\r\n" . '		if( document.getElementById(\'SurveyOverSubmit\') != null )  {  document.getElementById(\'SurveyOverSubmit\').disabled = true;  }' . "\r\n" . '' . "\r\n" . '		var thisLastPageStep = parseInt($(\'#thisStep\').val()) -1;' . "\r\n" . '		if(thisLastPageStep <= 0 ){' . "\r\n" . '			thisLastPageStep = 0;' . "\r\n" . '		}' . "\r\n" . '		thisPageStep = isSkipPage(thisLastPageStep,2);' . "\r\n" . '		if( thisPageStep == 0 )' . "\r\n" . '		{' . "\r\n" . '			show_survey_page_0();' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			$(\'#allHidden\').val(str_replace($(\'#thisHidden\').val(),\'\',$(\'#allHidden\').val()));' . "\r\n" . '			//后述页的全部字段减出后续页应有字段即为本页的全部字段' . "\r\n" . '			var thisAllFields = str_replace(base64_decode($(\'#thisFields\').val()),\'\',base64_decode($(\'#allFields\').val()));' . "\r\n" . '			$(\'#allFields\').val(base64_encode(thisAllFields));' . "\r\n" . '			//打开问卷' . "\r\n" . '			show_survey_page();' . "\r\n" . '			//本页应有的逻辑题值' . "\r\n" . '			var hiddenFields = \'\';' . "\r\n" . '			//本页的全部字段减出本页应有字段即为前述页的全部字段' . "\r\n" . '			var lastPageFieldsList = substr(str_replace(this_fields_list,\'\',thisAllFields),0,-1);' . "\r\n" . '			if( lastPageFieldsList != \'\' )' . "\r\n" . '			{' . "\r\n" . '				var lastPageFields = lastPageFieldsList.split(\'|\');' . "\r\n" . '				for( var tmp in lastPageFields )' . "\r\n" . '				{' . "\r\n" . '					var lastFields = lastPageFields[tmp];' . "\r\n" . '					//存在逻辑关系' . "\r\n" . '					if( in_array(lastFields,valueLogicQtnList) )' . "\r\n" . '					{' . "\r\n" . '						if( count(dataRow.rows) != 0 )' . "\r\n" . '						{' . "\r\n" . '							if( dataRow.rows[0][dataIndex[lastFields]] != \'\' )' . "\r\n" . '							{' . "\r\n" . '								var theTmpQtnArray = lastFields.split(\'_\');' . "\r\n" . '								switch(QtnListArray[theTmpQtnArray[1]].questionType)' . "\r\n" . '								{' . "\r\n" . '									case 2: //Radio' . "\r\n" . '										var theDatabaseValue = dataRow.rows[0][dataIndex[lastFields]];' . "\r\n" . '										if( theDatabaseValue == \'0\')' . "\r\n" . '										{' . "\r\n" . '											if( QtnListArray[theTmpQtnArray[1]].isHaveOther == 1 ) //Other' . "\r\n" . '											{' . "\r\n" . '												if(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theTmpQtnArray[1]]] == \'\' ) //Other' . "\r\n" . '												{' . "\r\n" . '													var lastFieldsValue = \'\';' . "\r\n" . '												}' . "\r\n" . '												else' . "\r\n" . '												{' . "\r\n" . '													var lastFieldsValue = \'0\';' . "\r\n" . '												}' . "\r\n" . '											}' . "\r\n" . '											else' . "\r\n" . '											{' . "\r\n" . '												var lastFieldsValue = \'\';' . "\r\n" . '											}' . "\r\n" . '										}' . "\r\n" . '										else' . "\r\n" . '										{' . "\r\n" . '											var lastFieldsValue = theDatabaseValue;' . "\r\n" . '										}											' . "\r\n" . '									break;' . "\r\n" . '									default:' . "\r\n" . '										var lastFieldsValue = dataRow.rows[0][dataIndex[lastFields]];' . "\r\n" . '									break;' . "\r\n" . '								}' . "\r\n" . '								theTmpQtnArray = null;' . "\r\n" . '							}' . "\r\n" . '							else' . "\r\n" . '							{' . "\r\n" . '								var lastFieldsValue = \'\';' . "\r\n" . '							}' . "\r\n" . '						}' . "\r\n" . '						else' . "\r\n" . '						{' . "\r\n" . '							var lastFieldsValue = \'\';' . "\r\n" . '						}' . "\r\n" . '						//利用Input hidden传入' . "\r\n" . '						hiddenFields += "<input name=\\""+lastFields+"\\" id=\\""+lastFields+"\\" type=\\"hidden\\" value=\\""+lastFieldsValue+"\\">\\n\\t\\t";' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '			}' . "\r\n" . '			$(\'#hiddenFields\').html(hiddenFields);' . "\r\n" . '			lastPageFields = null;' . "\r\n" . '		}' . "\r\n" . '		//初始化函数' . "\r\n" . '		InitSurveyPageData();' . "\r\n" . '		//rexseeProgressDialog.hide();' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		if( action == \'SurveyCacheSubmit\' )' . "\r\n" . '		{' . "\r\n" . '			if( parseInt($(\'#thisStep\').val()) == 0 ) //第1页' . "\r\n" . '			{' . "\r\n" . '				var actionCheckThisPage = jQuery.Survey_Form_Validator();' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				var actionCheckThisPage = true;' . "\r\n" . '			}' . "\r\n" . '		}' . "\r\n" . '		else' . "\r\n" . '		{' . "\r\n" . '			var actionCheckThisPage = jQuery.Survey_Form_Validator();' . "\r\n" . '		}' . "\r\n" . '			' . "\r\n" . '		if( actionCheckThisPage != false)' . "\r\n" . '		{' . "\r\n" . '		    //动作标记' . "\r\n" . '			actionFlag = 1;' . "\r\n" . '			thisCheckStr = document.Survey_Form.thisCheck.value;' . "\r\n" . '			jQuery.Survey_Quota_List();' . "\r\n" . '			if( thisCheckStr != \'\' )' . "\r\n" . '			{' . "\r\n" . '				var checkfalse = check_survey_quota();' . "\r\n" . '			}' . "\r\n" . '			else' . "\r\n" . '			{' . "\r\n" . '				var checkfalse = true;' . "\r\n" . '			}' . "\r\n" . '			if( checkfalse != true )' . "\r\n" . '			{' . "\r\n" . '				var thisRtn = checkfalse.split(\'|\');' . "\r\n" . '				if( thisRtn[0] == 0 ) return false;' . "\r\n" . '			}' . "\r\n" . '' . "\r\n" . '			if( document.getElementById(\'SurveyNextSubmit\') != null )  {  document.getElementById(\'SurveyNextSubmit\').disabled = true;  }' . "\r\n" . '			if( document.getElementById(\'SurveyCacheSubmit\') != null ) {  document.getElementById(\'SurveyCacheSubmit\').disabled = true; }' . "\r\n" . '			if( document.getElementById(\'SurveyCacheSubmit\') != null ) {  document.getElementById(\'SurveyCacheSubmit\').disabled = true; }' . "\r\n" . '			if( document.getElementById(\'SurveyPreSubmit\') != null )   {  document.getElementById(\'SurveyPreSubmit\').disabled = true;   }' . "\r\n" . '			if( document.getElementById(\'SurveyOverSubmit\') != null )  {  document.getElementById(\'SurveyOverSubmit\').disabled = true;  }' . "\r\n" . '' . "\r\n" . '			var action = document.Survey_Form.Action.value;	' . "\r\n" . '			if( action == \'SurveyNextSubmit\')' . "\r\n" . '			{' . "\r\n" . '				//rexseeProgressDialog.show("正在努力为您加载...");' . "\r\n" . '				rexseeDialog.toast(\'正在努力为您加载...\');' . "\r\n" . '				//记录数据' . "\r\n" . '				var thisSurveyFieldsList = ( substr(base64_decode($(\'#thisFields\').val()),0,-1) == false) ? \'\': substr(base64_decode($(\'#thisFields\').val()),0,-1);' . "\r\n" . '				var thisSurveyFields = thisSurveyFieldsList.split(\'|\');' . "\r\n" . '				var thisSurveyFieldsTypeList = (substr($(\'#thisType\').val(),0,-1) == false )? \'\':substr($(\'#thisType\').val(),0,-1);' . "\r\n" . '				var thisSurveyTypes = thisSurveyFieldsTypeList.split(\'|\');' . "\r\n" . '				if( (document.getElementById(\'panel_name\') != null ) )' . "\r\n" . '				{' . "\r\n" . '					var panelName = qLiteCharFilter($("#panel_name").val());' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						var panelName = dataRow.rows[0][dataIndex[\'administratorsName\']];' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var panelName = \'\';' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				if( (document.getElementById(\'address_name\') != null ) )' . "\r\n" . '				{' . "\r\n" . '					var addressName = qLiteCharFilter($("#address_name").val());' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						var addressName = dataRow.rows[0][dataIndex[\'ipAddress\']];' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var addressName = nickUserName+\'_\'+date(\'YmdHis\',time());' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				//处理文件上传' . "\r\n" . '				if( $(\'#thisFiles\').val() != \'\' )' . "\r\n" . '				{' . "\r\n" . '					var thisPageFileUploadList = (substr($(\'#thisFiles\').val(),0,-1) == false )? \'\':substr($(\'#thisFiles\').val(),0,-1);' . "\r\n" . '					var thisPageFileUpload = thisPageFileUploadList.split(\'|\');' . "\r\n" . '					var thisPageFileOlderList = (substr($(\'#thisSizes\').val(),0,-1) == false )? \'\':substr($(\'#thisSizes\').val(),0,-1);' . "\r\n" . '					var thisPageFileOlder = thisPageFileOlderList.split(\'|\');' . "\r\n" . '						' . "\r\n" . '					var k=0;' . "\r\n" . '					for( var tmp in thisPageFileUpload )' . "\r\n" . '					{' . "\r\n" . '						var theFiles = thisPageFileUpload[tmp];' . "\r\n" . '						var theUploadFileName = $(\'#\'+theFiles).val();' . "\r\n" . '							' . "\r\n" . ' 						//判断旧文件' . "\r\n" . '						var theOlderFile = thisPageFileOlder[tmp].split(\'###\');' . "\r\n" . '						if( theUploadFileName != theOlderFile[0] )  //上传新文件' . "\r\n" . '						{' . "\r\n" . '						   var olderFilePhyPath = rexseeStorage.getRoot()+\'enableq_offline/files/\'+qid+\'/\';' . "\r\n" . '						   if( theOlderFile[0] != \'null\' && rexseeFile.exists(olderFilePhyPath+theOlderFile[0]) )' . "\r\n" . '						   {' . "\r\n" . '							   rexseeFile.remove(olderFilePhyPath+theOlderFile[0]);' . "\r\n" . '						   }' . "\r\n" . '						}' . "\r\n" . '						k++;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//处理结果表' . "\r\n" . '				var SQL = " UPDATE eq_response_"+qid+" SET administratorsName=\'"+panelName+"\',";' . "\r\n" . '				if( parseInt($(\'#thisStep\').val()) > parseInt(dataRow.rows[0][dataIndex[\'replyPage\']]) )' . "\r\n" . '				{' . "\r\n" . '					SQL += "replyPage=\'"+parseInt($(\'#thisStep\').val())+"\',";' . "\r\n" . '					var submitTime = time();' . "\r\n" . '					var over_time = submitTime - theJoinTime;' . "\r\n" . '					SQL += "submitTime=\'"+submitTime+"\',overTime=\'"+over_time+"\',";' . "\r\n" . '				}' . "\r\n" . '				if( base64_decode($(\'#thisFields\').val()) != \'\' )' . "\r\n" . '				{' . "\r\n" . '					for(var tmp in thisSurveyFields )' . "\r\n" . '					{' . "\r\n" . '						surveyFields = thisSurveyFields[tmp];' . "\r\n" . '						switch(thisSurveyTypes[tmp])' . "\r\n" . '						{' . "\r\n" . '							case \'3\': //text' . "\r\n" . '							case \'4\': //textarea' . "\r\n" . '							case \'5\': //select' . "\r\n" . '								SQL += " "+surveyFields+" = \'"+ qLiteCharFilter($("#"+surveyFields).val())+"\',";' . "\r\n" . '							break;' . "\r\n" . '							case \'1\': //radio' . "\r\n" . '								if( typeof $(\'input[id=\'+surveyFields+\']:checked\').val() == \'undefined\' )' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'0\',";' . "\r\n" . '								}' . "\r\n" . '								else' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'"+ $(\'input[id=\'+surveyFields+\']:checked\').val()+"\',";' . "\r\n" . '								}' . "\r\n" . '							break;' . "\r\n" . '							case \'9\': //auto' . "\r\n" . '								if( typeof $(\'input[id=\'+surveyFields+\']:checked\').val() == \'undefined\' )' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'\',";' . "\r\n" . '								}' . "\r\n" . '								else' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'"+ $(\'input[id=\'+surveyFields+\']:checked\').val()+"\',";' . "\r\n" . '								}' . "\r\n" . '							break;' . "\r\n" . '							case \'2\': //checkbox' . "\r\n" . '								var tmp =\'\';' . "\r\n" . '								var arr = $(\'input[id=\'+surveyFields+\']:checked\');' . "\r\n" . '								arr = arr.sort(function(a,b){' . "\r\n" . '									return parseInt($(a).val()) - parseInt($(b).val());' . "\r\n" . '								});' . "\r\n" . '								arr.each(function(){' . "\r\n" . '									tmp += $(this).val() + ",";' . "\r\n" . '								});' . "\r\n" . '								tmp = substr(tmp,0,-1);' . "\r\n" . '								SQL += " "+surveyFields+" = \'"+ tmp +"\',";' . "\r\n" . '							break;' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				SQL = substr(SQL,0,-1)+" WHERE responseID = " + theResponseID;' . "\r\n" . '				rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '				' . "\r\n" . '				//GPS轨迹' . "\r\n" . '				SQL = " UPDATE eq_gps_trace SET responseID = \'"+theResponseID+"\',flag=1 WHERE surveyID = "+qid+" AND flag=0 ";' . "\r\n" . '				rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '				SQL = " UPDATE eq_gps_trace_upload SET responseID = \'"+theResponseID+"\',flag=1 WHERE surveyID = "+qid+" AND flag=0 ";' . "\r\n" . '				rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '' . "\r\n" . '				//释放内存' . "\r\n" . '				thisSurveyFields = null;' . "\r\n" . '				thisSurveyTypes = null;' . "\r\n" . '' . "\r\n" . '				//处理下一页问题展示' . "\r\n" . '				var thisNextPageStep = parseInt($(\'#thisStep\').val()) +1;' . "\r\n" . '				if( thisNextPageStep >= count(PagesBreakArray)-1 ) {' . "\r\n" . '					thisNextPageStep = count(PagesBreakArray)-1;' . "\r\n" . '				}' . "\r\n" . '				thisPageStep = isSkipPage(thisNextPageStep,1);' . "\r\n" . '				' . "\r\n" . '				//存储页面的值' . "\r\n" . '				var thisHiddenTmp = $(\'#thisHidden\').val();' . "\r\n" . '				var allFieldsTmp = $(\'#allFields\').val();' . "\r\n" . '				//打开问卷' . "\r\n" . '				show_survey_page();' . "\r\n" . '				//本页应有的逻辑题值' . "\r\n" . '				$(\'#allHidden\').val(thisHiddenTmp+this_hidden_list);' . "\r\n" . '				//本页的全部字段' . "\r\n" . '				$(\'#allFields\').val(base64_encode(base64_decode(allFieldsTmp)+this_fields_list));' . "\r\n" . '				//前述页面传递给本页的逻辑题值' . "\r\n" . '				var hiddenFields = \'\';' . "\r\n" . '				var lastPageFieldsList = substr(base64_decode(allFieldsTmp),0,-1);' . "\r\n" . '				//前页的全部字段' . "\r\n" . '				if( lastPageFieldsList != \'\' )' . "\r\n" . '				{' . "\r\n" . '					var lastPageFields = lastPageFieldsList.split(\'|\');' . "\r\n" . '					for( var tmp in lastPageFields )' . "\r\n" . '					{' . "\r\n" . '						var lastFields = lastPageFields[tmp];' . "\r\n" . '						//存在逻辑关系' . "\r\n" . '						if( in_array(lastFields,valueLogicQtnList) )' . "\r\n" . '						{' . "\r\n" . '							if( count(dataRow.rows) != 0 )' . "\r\n" . '							{' . "\r\n" . '								if(dataRow.rows[0][dataIndex[lastFields]] != \'\' )' . "\r\n" . '								{' . "\r\n" . '									var theTmpQtnArray = lastFields.split(\'_\');' . "\r\n" . '									switch(QtnListArray[theTmpQtnArray[1]].questionType)' . "\r\n" . '									{' . "\r\n" . '										case 2: //Radio' . "\r\n" . '											var theDatabaseValue = dataRow.rows[0][dataIndex[lastFields]];' . "\r\n" . '											if( theDatabaseValue == \'0\')' . "\r\n" . '											{' . "\r\n" . '												if( QtnListArray[theTmpQtnArray[1]].isHaveOther == 1 ) //Other' . "\r\n" . '												{' . "\r\n" . '													if(dataRow.rows[0][dataIndex[\'TextOtherValue_\'+theTmpQtnArray[1]]] == \'\' ) //Other' . "\r\n" . '													{' . "\r\n" . '														var lastFieldsValue = \'\';' . "\r\n" . '													}' . "\r\n" . '													else' . "\r\n" . '													{' . "\r\n" . '														var lastFieldsValue = \'0\';' . "\r\n" . '													}' . "\r\n" . '												}' . "\r\n" . '												else' . "\r\n" . '												{' . "\r\n" . '													var lastFieldsValue = \'\';' . "\r\n" . '												}' . "\r\n" . '											}' . "\r\n" . '											else' . "\r\n" . '											{' . "\r\n" . '												var lastFieldsValue = theDatabaseValue;' . "\r\n" . '											}											' . "\r\n" . '										break;' . "\r\n" . '										default:' . "\r\n" . '											var lastFieldsValue = dataRow.rows[0][dataIndex[lastFields]];' . "\r\n" . '										break;' . "\r\n" . '									}' . "\r\n" . '									theTmpQtnArray = null;' . "\r\n" . '								}' . "\r\n" . '								else' . "\r\n" . '								{' . "\r\n" . '									var lastFieldsValue = \'\';' . "\r\n" . '								}' . "\r\n" . '							}' . "\r\n" . '							else' . "\r\n" . '							{' . "\r\n" . '								var lastFieldsValue = \'\';' . "\r\n" . '							}' . "\r\n" . '							//利用Input hidden传入' . "\r\n" . '							hiddenFields += "<input name=\\""+lastFields+"\\" id=\\""+lastFields+"\\" type=\\"hidden\\" value=\\""+lastFieldsValue+"\\">\\n\\t\\t";' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				$(\'#hiddenFields\').html(hiddenFields);' . "\r\n" . '				lastPageFields = null;' . "\r\n" . '' . "\r\n" . '				//初始化函数' . "\r\n" . '				InitSurveyPageData();' . "\r\n" . '				//rexseeProgressDialog.hide();' . "\r\n" . '			}' . "\r\n" . '			if( action == \'SurveyOverSubmit\' || action == \'SurveyCacheSubmit\' )' . "\r\n" . '			{' . "\r\n" . '				if( parseInt(surveyRow.rows[0][4] ) == 1 )' . "\r\n" . '				{' . "\r\n" . '					rexseeAudioCapture.stop();' . "\r\n" . '					rexseePush.remove(876543212);' . "\r\n" . '					rexseePush.add(\'id=876543212;message=关闭全程录音机;title=关闭全程录音机;\');' . "\r\n" . '					rexseeDialog.toast(\'全程录音机已帮您关闭！不会再录音啦！\');' . "\r\n" . '					setTimeout(function(){},1000);' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//记录数据' . "\r\n" . '				var thisSurveyFieldsList = ( substr(base64_decode($(\'#thisFields\').val()),0,-1) == false) ? \'\': substr(base64_decode($(\'#thisFields\').val()),0,-1);' . "\r\n" . '				var thisSurveyFields = thisSurveyFieldsList.split(\'|\');' . "\r\n" . '				var thisSurveyFieldsTypeList = (substr($(\'#thisType\').val(),0,-1) == false )? \'\':substr($(\'#thisType\').val(),0,-1);' . "\r\n" . '				var thisSurveyTypes = thisSurveyFieldsTypeList.split(\'|\');' . "\r\n" . '				if( (document.getElementById(\'panel_name\') != null ) )' . "\r\n" . '				{' . "\r\n" . '					var panelName = qLiteCharFilter($("#panel_name").val());' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						var panelName = dataRow.rows[0][dataIndex[\'administratorsName\']];' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var panelName = \'\';' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				if( (document.getElementById(\'address_name\') != null ) )' . "\r\n" . '				{' . "\r\n" . '					var addressName = qLiteCharFilter($("#address_name").val());' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					if( count(dataRow.rows) != 0 )' . "\r\n" . '					{' . "\r\n" . '						var addressName = dataRow.rows[0][dataIndex[\'ipAddress\']];' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						var addressName = nickUserName+\'_\'+date(\'YmdHis\',time());' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				' . "\r\n" . '				var thisOverFlag = 0;' . "\r\n" . '				if( action == \'SurveyOverSubmit\' ) thisOverFlag =1;' . "\r\n" . '' . "\r\n" . '				//处理文件上传' . "\r\n" . '				if( $(\'#thisFiles\').val() != \'\' )' . "\r\n" . '				{' . "\r\n" . '					var thisPageFileUploadList = (substr($(\'#thisFiles\').val(),0,-1) == false )? \'\':substr($(\'#thisFiles\').val(),0,-1);' . "\r\n" . '					var thisPageFileUpload = thisPageFileUploadList.split(\'|\');' . "\r\n" . '					var thisPageFileOlderList = (substr($(\'#thisSizes\').val(),0,-1) == false )? \'\':substr($(\'#thisSizes\').val(),0,-1);' . "\r\n" . '					var thisPageFileOlder = thisPageFileOlderList.split(\'|\');' . "\r\n" . '						' . "\r\n" . '					var k=0;' . "\r\n" . '					for( var tmp in thisPageFileUpload )' . "\r\n" . '					{' . "\r\n" . '						var theFiles = thisPageFileUpload[tmp];' . "\r\n" . '						var theUploadFileName = $(\'#\'+theFiles).val();' . "\r\n" . '							' . "\r\n" . '						 //判断旧文件' . "\r\n" . '						 var theOlderFile = thisPageFileOlder[tmp].split(\'###\');' . "\r\n" . '						 if( theUploadFileName != theOlderFile[0] )  //上传新文件' . "\r\n" . '						 {' . "\r\n" . '							 var olderFilePhyPath = rexseeStorage.getRoot()+\'enableq_offline/files/\'+qid+\'/\';' . "\r\n" . '							 if( theOlderFile[0] != \'null\' && rexseeFile.exists(olderFilePhyPath+theOlderFile[0]) )' . "\r\n" . '							 {' . "\r\n" . '								 rexseeFile.remove(olderFilePhyPath+theOlderFile[0]);' . "\r\n" . '							 }' . "\r\n" . '						 }' . "\r\n" . '						 k++;' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//录音文件' . "\r\n" . '				if( parseInt(surveyRow.rows[0][4] ) == 1 ) { var recFile = theNowRecFile;}' . "\r\n" . '				else { var recFile = \'\'; }' . "\r\n" . '' . "\r\n" . '				//处理结果表' . "\r\n" . '				if( action == \'SurveyOverSubmit\' )' . "\r\n" . '				{' . "\r\n" . '					var SQL = " UPDATE eq_response_"+qid+" SET recordFile = \'"+recFile+"\',overFlag = \'"+thisOverFlag+"\',administratorsName=\'"+panelName+"\',";' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					var SQL = " UPDATE eq_response_"+qid+" SET recordFile = \'"+recFile+"\',administratorsName=\'"+panelName+"\',";' . "\r\n" . '				}' . "\r\n" . '				if( parseInt($(\'#thisStep\').val()) > parseInt(dataRow.rows[0][dataIndex[\'replyPage\']]) )' . "\r\n" . '				{' . "\r\n" . '					SQL += "replyPage=\'"+parseInt($(\'#thisStep\').val())+"\',";' . "\r\n" . '					var submitTime = time();' . "\r\n" . '					var over_time = submitTime - theJoinTime;' . "\r\n" . '					SQL += "submitTime=\'"+submitTime+"\',overTime=\'"+over_time+"\',";' . "\r\n" . '				}' . "\r\n" . '				if( base64_decode($(\'#thisFields\').val()) != \'\' )' . "\r\n" . '				{' . "\r\n" . '					for(var tmp in thisSurveyFields )' . "\r\n" . '					{' . "\r\n" . '						surveyFields = thisSurveyFields[tmp];' . "\r\n" . '						switch(thisSurveyTypes[tmp])' . "\r\n" . '						{' . "\r\n" . '							case \'3\': //text' . "\r\n" . '							case \'4\': //textarea' . "\r\n" . '							case \'5\': //select' . "\r\n" . '								SQL += " "+surveyFields+" = \'"+ qLiteCharFilter($("#"+surveyFields).val())+"\',";' . "\r\n" . '							break;' . "\r\n" . '							case \'1\': //radio' . "\r\n" . '								if( typeof $(\'input[id=\'+surveyFields+\']:checked\').val() == \'undefined\' )' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'0\',";' . "\r\n" . '								}' . "\r\n" . '								else' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'"+ $(\'input[id=\'+surveyFields+\']:checked\').val()+"\',";' . "\r\n" . '								}' . "\r\n" . '							break;' . "\r\n" . '							case \'9\': //auto' . "\r\n" . '								if( typeof $(\'input[id=\'+surveyFields+\']:checked\').val() == \'undefined\' )' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'\',";' . "\r\n" . '								}' . "\r\n" . '								else' . "\r\n" . '								{' . "\r\n" . '									SQL += " "+surveyFields+" = \'"+ $(\'input[id=\'+surveyFields+\']:checked\').val()+"\',";' . "\r\n" . '								}' . "\r\n" . '							break;' . "\r\n" . '							case \'2\': //checkbox' . "\r\n" . '								var tmp =\'\';' . "\r\n" . '								var arr = $(\'input[id=\'+surveyFields+\']:checked\');' . "\r\n" . '								arr = arr.sort(function(a,b){' . "\r\n" . '									return parseInt($(a).val()) - parseInt($(b).val());' . "\r\n" . '								});' . "\r\n" . '								arr.each(function(){' . "\r\n" . '									tmp += $(this).val() + ",";' . "\r\n" . '								});' . "\r\n" . '								if( tmp != \'\' )' . "\r\n" . '								{' . "\r\n" . '									tmp = substr(tmp,0,-1);' . "\r\n" . '								}' . "\r\n" . '								SQL += " "+surveyFields+" = \'"+ tmp +"\',";' . "\r\n" . '							break;' . "\r\n" . '						}' . "\r\n" . '					}' . "\r\n" . '				}' . "\r\n" . '				SQL = substr(SQL,0,-1)+" WHERE responseID = " + theResponseID;' . "\r\n" . '				rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '				' . "\r\n" . '				//GPS轨迹' . "\r\n" . '				SQL = " UPDATE eq_gps_trace SET responseID = \'"+theResponseID+"\',flag=1 WHERE surveyID = "+qid+" AND flag=0 ";' . "\r\n" . '				rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '				SQL = " UPDATE eq_gps_trace_upload SET responseID = \'"+theResponseID+"\',flag=1 WHERE surveyID = "+qid+" AND flag=0 ";' . "\r\n" . '				rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '' . "\r\n" . '				//清除不正确的逻辑数据' . "\r\n" . '				if( action == \'SurveyOverSubmit\' || parseInt($(\'#surveyQuotaFlag\').val()) == 2 ) //结束' . "\r\n" . '				{' . "\r\n" . '					//问卷中的全集' . "\r\n" . '					var survey_fields_name = surveyRow.rows[0][3].split(\',\');' . "\r\n" . '' . "\r\n" . '					//页面中的全集' . "\r\n" . '					var thisSurveyFieldsList = ( substr(base64_decode($(\'#allFields\').val()),0,-1) == false) ? \'\': substr(base64_decode($(\'#allFields\').val()),0,-1);' . "\r\n" . '					var thisSurveyFields = thisSurveyFieldsList.split(\'|\');' . "\r\n" . '' . "\r\n" . '					//计算差集' . "\r\n" . '					var this_diff_fields_list = array_diff(survey_fields_name,thisSurveyFields);' . "\r\n" . '					survey_fields_name = null;' . "\r\n" . '					thisSurveyFields = null;' . "\r\n" . '					if( count(this_diff_fields_list) != 0 && this_diff_fields_list != \'\' )' . "\r\n" . '					{' . "\r\n" . '						var SQL = " UPDATE eq_response_"+qid+" SET ";' . "\r\n" . '						for( var tmp in this_diff_fields_list )' . "\r\n" . '						{' . "\r\n" . '							SQL += " "+this_diff_fields_list[tmp]+" = \'\',";' . "\r\n" . '						}' . "\r\n" . '						SQL = substr(SQL,0,-1)+ " WHERE responseID = " + theResponseID;' . "\r\n" . '						rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '					}' . "\r\n" . '					this_diff_fields_list = null;' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//后续处理' . "\r\n" . '				if( parseInt($(\'#surveyQuotaFlag\').val()) == 2 )' . "\r\n" . '				{' . "\r\n" . '					var SQL = " UPDATE eq_response_"+qid+" SET overFlag = 2 WHERE responseID = " + theResponseID;' . "\r\n" . '					rexseeDatabase.exec(SQL,\'rexsee:enableq.db\');' . "\r\n" . '' . "\r\n" . '					//释放内存' . "\r\n" . '					thisSurveyFields = null;' . "\r\n" . '					thisSurveyTypes = null;' . "\r\n" . '					theJoinTime = 0;' . "\r\n" . '					theResponseID = rid;' . "\r\n" . '' . "\r\n" . '					if( QuotaNumArray[quota_info_id].quotaText == null || QuotaNumArray[quota_info_id].quotaText == \'\' )' . "\r\n" . '					{' . "\r\n" . '						rexseeChronometer.show(\'label:到达问卷预先设定的结束条件，问卷结束并努力为您记录问卷数据...;align:left;background-color:transparent;color:#000000;border-width:0;window-style:light;\',4,\'javascript:locatIndex()\');' . "\r\n" . '					}' . "\r\n" . '					else' . "\r\n" . '					{' . "\r\n" . '						rexseeChronometer.show(\'label:\'+QuotaNumArray[quota_info_id].quotaText+\'...;align:left;background-color:transparent;color:#000000;border-width:0;window-style:light;\',4,\'javascript:locatIndex()\');' . "\r\n" . '					}' . "\r\n" . '					return false;' . "\r\n" . '				}' . "\r\n" . '' . "\r\n" . '				//释放内存' . "\r\n" . '				thisSurveyFields = null;' . "\r\n" . '				thisSurveyTypes = null;' . "\r\n" . '				theJoinTime = 0;' . "\r\n" . '				theResponseID = rid;' . "\r\n" . '				quota_info_id =0;' . "\r\n" . '' . "\r\n" . '				//成功信息' . "\r\n" . '				if( action == \'SurveyOverSubmit\' )' . "\r\n" . '				{' . "\r\n" . '					rexseeChronometer.show(\'label:问卷结束，正在努力为您记录问卷数据...;align:left;background-color:transparent;color:#000000;border-width:0;window-style:light;\',3,\'javascript:locatIndex()\');' . "\r\n" . '				}' . "\r\n" . '				else' . "\r\n" . '				{' . "\r\n" . '					rexseeChronometer.show(\'label:问卷中断，正在努力为您缓存问卷数据...;align:left;background-color:transparent;color:#000000;border-width:0;window-style:light;\',3,\'javascript:locatIndex()\');' . "\r\n" . '				}' . "\r\n" . '			}//Action' . "\r\n" . '		} //Jqeury' . "\r\n" . '	}//If' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function locatIndex()' . "\r\n" . '{' . "\r\n" . '	if( parseInt(surveyRow.rows[0][4] ) == 1 ) //全程录音' . "\r\n" . '	{' . "\r\n" . '		rexseeChronometer.dismiss();' . "\r\n" . '		rexseeChronometer.show(\'label:正在努力为您合并录音文件，可能花费较长时间...;align:left;background-color:transparent;color:#000000;border-width:0;window-style:light;\',1800,\'javascript:showMoreTime()\');' . "\r\n" . '' . "\r\n" . '		//开始合并录音文件' . "\r\n" . '		rexseeAudio.clearMergeList();' . "\r\n" . '		var the_rec_file_path = rexseeStorage.getRoot()+\'enableq_offline/files/\'+qid+\'/\';' . "\r\n" . '		//原录音文件' . "\r\n" . '		if( rexseeFile.exists(the_rec_file_path + theOriRecFile) )' . "\r\n" . '		{' . "\r\n" . '			rexseeAudio.addToMergeList(the_rec_file_path + theOriRecFile);' . "\r\n" . '		}' . "\r\n" . '		//现在录音文件' . "\r\n" . '		if( rexseeFile.exists(the_rec_file_path + theNowRecFile) )' . "\r\n" . '		{' . "\r\n" . '			rexseeAudio.addToMergeList(the_rec_file_path + theNowRecFile);' . "\r\n" . '		}' . "\r\n" . '		//合并' . "\r\n" . '		rexseeAudio.merge(the_rec_file_path + \'merge_\' + date(\'YmdHis\',time()) + \'.amr.qf\');' . "\r\n" . '	}' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		returnPage();' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function showMoreTime()' . "\r\n" . '{' . "\r\n" . '	rexseeDialog.toast("合并录音文件仍然可能需要较长时间，敬请再耐心等待...");' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . '//监控事件' . "\r\n" . 'function onAudioMerged(path){ ' . "\r\n" . '    ' . "\r\n" . '	//删除原录音文件' . "\r\n" . '	var ori_rec_file_name = rexseeAudio.getFromMergeList(0);' . "\r\n" . '	if( rexseeFile.exists(ori_rec_file_name) )' . "\r\n" . '	{' . "\r\n" . '		rexseeFile.remove(ori_rec_file_name);' . "\r\n" . '	}' . "\r\n" . '	' . "\r\n" . '	//删除现在录音文件' . "\r\n" . '	var now_rec_file_name = rexseeAudio.getFromMergeList(1);' . "\r\n" . '	if( rexseeFile.exists(now_rec_file_name) )' . "\r\n" . '	{' . "\r\n" . '		rexseeFile.remove(now_rec_file_name);' . "\r\n" . '	}' . "\r\n" . '	' . "\r\n" . '	//重命名' . "\r\n" . '	rexseeFile.renameTo(path,now_rec_file_name);' . "\r\n" . '' . "\r\n" . '	//清空队列' . "\r\n" . '	rexseeAudio.clearMergeList();' . "\r\n" . '' . "\r\n" . '	//返回' . "\r\n" . '	rexseeChronometer.dismiss();' . "\r\n" . '	returnPage();' . "\r\n" . '} ' . "\r\n" . '';

?>
