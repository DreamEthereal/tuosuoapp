<?php
//dezend by http://www.yunlu99.com/
echo 'function doExecCommand(command) {	' . "\r\n" . '    var textEdit = document.getElementById("theEditor");' . "\r\n" . '	textEdit.focus();' . "\r\n" . '	edit = textEdit.document.selection.createRange();' . "\r\n" . '    if ((command == "Undo") || (command == "Redo"))' . "\r\n" . '			document.execCommand(command);' . "\r\n" . '	else' . "\r\n" . '	{' . "\r\n" . '		if ( arguments[1] == null )				' . "\r\n" . '			 edit.execCommand(command,false);' . "\r\n" . '		else' . "\r\n" . '			 edit.execCommand(command,false,arguments[1]);' . "\r\n" . '	}' . "\r\n" . '	textEdit.focus();' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function savehtml() {' . "\r\n" . '   var html = document.getElementById("theEditor").innerHTML;' . "\r\n" . '   //消除特殊字符' . "\r\n" . '   html = html.replace(/<\\\\?\\?xml[^>]*>/gi, "") ;' . "\r\n" . '   //html = html.replace(/<\\/?st[^>]*>/gi, "" );' . "\r\n" . '   html = html.replace(/<o:p>/gi,"");' . "\r\n" . '   html = html.replace(/<\\/o:p>/gi,"");' . "\r\n" . '   html = CleanWord(html,false,false);' . "\r\n" . '   html = html.replace(/\'/g,"\\\'"); ' . "\r\n" . '' . "\r\n" . '   //发送email内的关键内容' . "\r\n" . '   html = html.replace(/\\{[^\\}]*userName[^\\}]*\\}/gi, "{userName}");' . "\r\n" . '   html = html.replace(/\\{[^\\}]*userEmail[^\\}]*\\}/gi, "{userEmail}");' . "\r\n" . '' . "\r\n" . '   document.getElementById("emailContent").value = html;' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function CleanWord( html ,bIgnoreFont,bRemoveStyles)' . "\r\n" . '{' . "\r\n" . '    html = html.replace(/<o:p>\\s*<\\/o:p>/g, "") ;' . "\r\n" . '    html = html.replace(/<o:p>.*?<\\/o:p>/g, "&nbsp;") ;' . "\r\n" . '  ' . "\r\n" . '    // Remove mso-xxx styles.' . "\r\n" . '    html = html.replace( /\\s*mso-[^:]+:[^;"]+;?/gi, "" ) ;' . "\r\n" . '' . "\r\n" . '    // Remove margin styles.' . "\r\n" . '    html = html.replace( /\\s*MARGIN: 0cm 0cm 0pt\\s*;/gi, "" ) ;' . "\r\n" . '    html = html.replace( /\\s*MARGIN: 0cm 0cm 0pt\\s*"/gi, "\\"" ) ;' . "\r\n" . '' . "\r\n" . '    html = html.replace( /\\s*TEXT-INDENT: 0cm\\s*;/gi, "" ) ;' . "\r\n" . '    html = html.replace( /\\s*TEXT-INDENT: 0cm\\s*"/gi, "\\"" ) ;' . "\r\n" . '' . "\r\n" . '    html = html.replace( /\\s*TEXT-ALIGN: [^\\s;]+;?"/gi, "\\"" ) ;' . "\r\n" . '	' . "\r\n" . '    html = html.replace( /\\s*PAGE-BREAK-BEFORE: [^\\s;]+;?"/gi, "\\"" ) ;' . "\r\n" . '	' . "\r\n" . '    html = html.replace( /\\s*FONT-VARIANT: [^\\s;]+;?"/gi, "\\"" ) ;' . "\r\n" . '	' . "\r\n" . '    html = html.replace( /\\s*tab-stops:[^;"]*;?/gi, "" ) ;' . "\r\n" . '    html = html.replace( /\\s*tab-stops:[^"]*/gi, "" ) ;' . "\r\n" . '	' . "\r\n" . '    // Remove FONT face attributes.' . "\r\n" . '    if ( bIgnoreFont )' . "\r\n" . '    {' . "\r\n" . '        html = html.replace( /\\s*face="[^"]*"/gi, "" ) ;' . "\r\n" . '        html = html.replace( /\\s*face=[^ >]*/gi, "" ) ;' . "\r\n" . '	' . "\r\n" . '        html = html.replace( /\\s*FONT-FAMILY:[^;"]*;?/gi, "" ) ;' . "\r\n" . '    }' . "\r\n" . '	    ' . "\r\n" . '    // Remove Class attributes' . "\r\n" . '    html = html.replace(/<(\\w[^>]*) class=([^ |>]*)([^>]*)/gi, "<$1$3") ;' . "\r\n" . '	' . "\r\n" . '    // Remove styles.' . "\r\n" . '    if ( bRemoveStyles )' . "\r\n" . '        html = html.replace( /<(\\w[^>]*) style="([^\\"]*)"([^>]*)/gi, "<$1$3" ) ;' . "\r\n" . '' . "\r\n" . '	// Remove empty styles.' . "\r\n" . '    html =  html.replace( /\\s*style="\\s*"/gi, \'\' ) ;' . "\r\n" . '    ' . "\r\n" . '    html = html.replace( /<SPAN\\s*[^>]*>\\s*&nbsp;\\s*<\\/SPAN>/gi, \'&nbsp;\' ) ;' . "\r\n" . '    ' . "\r\n" . '    html = html.replace( /<SPAN\\s*[^>]*><\\/SPAN>/gi, \'\' ) ;' . "\r\n" . '    ' . "\r\n" . '    // Remove Lang attributes' . "\r\n" . '    html = html.replace(/<(\\w[^>]*) lang=([^ |>]*)([^>]*)/gi, "<$1$3") ;' . "\r\n" . '    ' . "\r\n" . '    html = html.replace( /<SPAN\\s*>(.*?)<\\/SPAN>/gi, \'$1\' ) ;' . "\r\n" . '    ' . "\r\n" . '    html = html.replace( /<FONT\\s*>(.*?)<\\/FONT>/gi, \'$1\' ) ;' . "\r\n" . '' . "\r\n" . '    // Remove XML elements and declarations' . "\r\n" . '    html = html.replace(/<\\\\?\\?xml[^>]*>/gi, "") ;' . "\r\n" . '    ' . "\r\n" . '    // Remove Tags with XML namespace declarations: <o:p><\\/o:p>' . "\r\n" . '    html = html.replace(/<\\/?\\w+:[^>]*>/gi, "") ;' . "\r\n" . '    ' . "\r\n" . '    // Remove comments [SF BUG-1481861].' . "\r\n" . '    html = html.replace(/<\\!--.*-->/g, "") ;' . "\r\n" . '    ' . "\r\n" . '    html = html.replace( /<H\\d>\\s*<\\/H\\d>/gi, \'\' ) ;' . "\r\n" . '' . "\r\n" . '    html = html.replace( /<H1([^>]*)>/gi, \'<div$1><b><font size="6">\' ) ;' . "\r\n" . '    html = html.replace( /<H2([^>]*)>/gi, \'<div$1><b><font size="5">\' ) ;' . "\r\n" . '    html = html.replace( /<H3([^>]*)>/gi, \'<div$1><b><font size="4">\' ) ;' . "\r\n" . '    html = html.replace( /<H4([^>]*)>/gi, \'<div$1><b><font size="3">\' ) ;' . "\r\n" . '    html = html.replace( /<H5([^>]*)>/gi, \'<div$1><b><font size="2">\' ) ;' . "\r\n" . '    html = html.replace( /<H6([^>]*)>/gi, \'<div$1><b><font size="1">\' ) ;' . "\r\n" . '' . "\r\n" . '    html = html.replace( /<\\/H\\d>/gi, \'<\\/font><\\/b><\\/div>\' ) ;' . "\r\n" . '    ' . "\r\n" . '    html = html.replace( /<(U|I|STRIKE)>&nbsp;<\\/\\1>/g, \'&nbsp;\' ) ;' . "\r\n" . '	' . "\r\n" . '    // Remove empty tags (three times, just to be sure).' . "\r\n" . '    //html = html.replace( /<([^\\s>]+)(\\s[^>]*)?>\\s*<\\/\\1>/g, \'\' ) ;' . "\r\n" . '    //html = html.replace( /<([^\\s>]+)(\\s[^>]*)?>\\s*<\\/\\1>/g, \'\' ) ;' . "\r\n" . '    //html = html.replace( /<([^\\s>]+)(\\s[^>]*)?>\\s*<\\/\\1>/g, \'\' ) ;' . "\r\n" . '' . "\r\n" . '    // Transform <P> to <DIV>' . "\r\n" . '    var re = new RegExp( "(<P)([^>]*>.*?)(<\\/P>)", "gi" ) ; // Different because of a IE 5.0 error' . "\r\n" . '    html = html.replace( re, "<div$2<\\/div>" ) ;' . "\r\n" . '    ' . "\r\n" . '    // Fix relative anchor URLs (IE automatically adds the current page URL).' . "\r\n" . '	var theURL = window.location;' . "\r\n" . '	theURL = theURL.toString().replace(/\\+/g,"\\\\s");' . "\r\n" . '    re = new RegExp( theURL + "#", "g" ) ;' . "\r\n" . '    html = html.replace( re, \'#\') ;' . "\r\n" . '' . "\r\n" . '    return html ;' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function doSelectClick(str, el) {' . "\r\n" . '	var Index = el.selectedIndex;' . "\r\n" . '	if (Index != 0){' . "\r\n" . '		el.selectedIndex = 0;' . "\r\n" . '		doFormat(str,el.options[Index].value);' . "\r\n" . '	}' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function doFormat(what) {' . "\r\n" . '	doExecCommand(what, arguments[1]);' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function savesurveyinfo() {' . "\r\n" . '   var html = document.getElementById("theEditor").innerHTML;' . "\r\n" . '   //消除特殊字符' . "\r\n" . '   html = html.replace(/<\\\\?\\?xml[^>]*>/gi, "") ;' . "\r\n" . '   //html = html.replace(/<\\/?st[^>]*>/gi, "" );' . "\r\n" . '   html = html.replace(/<o:p>/gi,"");' . "\r\n" . '   html = html.replace(/<\\/o:p>/gi,"");' . "\r\n" . '   html = CleanWord(html,false,false);' . "\r\n" . '   html = html.replace(/\'/g,"\\\'"); ' . "\r\n" . '   document.getElementById("surveyInfo").value = html;' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'function saveinfotext() {' . "\r\n" . '   var html = document.getElementById("theEditor").innerHTML;' . "\r\n" . '   //消除特殊字符' . "\r\n" . '   html = html.replace(/<\\\\?\\?xml[^>]*>/gi, "") ;' . "\r\n" . '   //html = html.replace(/<\\/?st[^>]*>/gi, "" );' . "\r\n" . '   html = html.replace(/<o:p>/gi,"");' . "\r\n" . '   html = html.replace(/<\\/o:p>/gi,"");' . "\r\n" . '   html = CleanWord(html,false,false);' . "\r\n" . '   html = html.replace(/\'/g,"\\\'"); ' . "\r\n" . '   document.getElementById("optionName").value = html;' . "\r\n" . '}';

?>
