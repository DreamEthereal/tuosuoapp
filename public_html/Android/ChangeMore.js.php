<?php
//dezend by http://www.yunlu99.com/
echo '//2011-7-25 zhangying' . "\r\n" . '(function(){' . "\r\n" . 'function load_script(xyUrl, callback){' . "\r\n" . '    var head = document.getElementsByTagName(\'head\')[0];' . "\r\n" . '    var script = document.createElement(\'script\');' . "\r\n" . '    script.type = \'text/javascript\';' . "\r\n" . '    script.src = xyUrl;' . "\r\n" . '    //借鉴了jQuery的script跨域方法' . "\r\n" . '    script.onload = script.onreadystatechange = function(){' . "\r\n" . '        if((!this.readyState || this.readyState === "loaded" || this.readyState === "complete")){' . "\r\n" . '            callback && callback();' . "\r\n" . '            // Handle memory leak in IE' . "\r\n" . '            script.onload = script.onreadystatechange = null;' . "\r\n" . '            if ( head && script.parentNode ) {' . "\r\n" . '                head.removeChild( script );' . "\r\n" . '            }' . "\r\n" . '        }' . "\r\n" . '    };' . "\r\n" . '    // Use insertBefore instead of appendChild  to circumvent an IE6 bug.' . "\r\n" . '    head.insertBefore( script, head.firstChild );' . "\r\n" . '}' . "\r\n" . 'function transMore(points,type,callback){' . "\r\n" . '	var xyUrl = "http://api.map.baidu.com/ag/coord/convert?from=" + type + "&to=4&mode=1";' . "\r\n" . '	var xs = [];' . "\r\n" . '	var ys = [];' . "\r\n" . '	var maxCnt = 20;//每次发送的最大个数' . "\r\n" . '	var send = function(){' . "\r\n" . '		var url = xyUrl + "&x=" + xs.join(",") + "&y=" + ys.join(",") + "&callback=callback";' . "\r\n" . '	    //动态创建script标签' . "\r\n" . '	    load_script(url);' . "\r\n" . '		xs = [];' . "\r\n" . '		ys = [];' . "\r\n" . '	}' . "\r\n" . '    for(var index in points){' . "\r\n" . '		if(index % maxCnt == 0 && index != 0){' . "\r\n" . '			send();' . "\r\n" . '		}' . "\r\n" . '    	xs.push(points[index].lng);' . "\r\n" . '    	ys.push(points[index].lat);' . "\r\n" . '		if(index == points.length - 1){' . "\r\n" . '			send();' . "\r\n" . '		}' . "\r\n" . '    }' . "\r\n" . '    ' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'window.BMap = window.BMap || {};' . "\r\n" . 'BMap.Convertor = {};' . "\r\n" . 'BMap.Convertor.transMore = transMore;' . "\r\n" . '})();' . "\r\n" . '';

?>
