<?php
//dezend by http://www.yunlu99.com/
echo '//2011-7-25' . "\r\n" . '(function(){        //闭包' . "\r\n" . 'function load_script(xyUrl, callback){' . "\r\n" . '    var head = document.getElementsByTagName(\'head\')[0];' . "\r\n" . '    var script = document.createElement(\'script\');' . "\r\n" . '    script.type = \'text/javascript\';' . "\r\n" . '    script.src = xyUrl;' . "\r\n" . '    //借鉴了jQuery的script跨域方法' . "\r\n" . '    script.onload = script.onreadystatechange = function(){' . "\r\n" . '        if((!this.readyState || this.readyState === "loaded" || this.readyState === "complete")){' . "\r\n" . '            callback && callback();' . "\r\n" . '            // Handle memory leak in IE' . "\r\n" . '            script.onload = script.onreadystatechange = null;' . "\r\n" . '            if ( head && script.parentNode ) {' . "\r\n" . '                head.removeChild( script );' . "\r\n" . '            }' . "\r\n" . '        }' . "\r\n" . '    };' . "\r\n" . '    // Use insertBefore instead of appendChild  to circumvent an IE6 bug.' . "\r\n" . '    head.insertBefore( script, head.firstChild );' . "\r\n" . '}' . "\r\n" . 'function translate(point,type,callback){' . "\r\n" . '    var callbackName = \'cbk_\' + Math.round(Math.random() * 10000);    //随机函数名' . "\r\n" . '    var xyUrl = "http://api.map.baidu.com/ag/coord/convert?from="+ type + "&to=4&x=" + point.lng + "&y=" + point.lat + "&callback=BMap.Convertor." + callbackName;' . "\r\n" . '    //动态创建script标签' . "\r\n" . '    load_script(xyUrl);' . "\r\n" . '    BMap.Convertor[callbackName] = function(xyResult){' . "\r\n" . '        delete BMap.Convertor[callbackName];    //调用完需要删除改函数' . "\r\n" . '        var point = new BMap.Point(xyResult.x, xyResult.y);' . "\r\n" . '        callback && callback(point);' . "\r\n" . '    }' . "\r\n" . '}' . "\r\n" . '' . "\r\n" . 'window.BMap = window.BMap || {};' . "\r\n" . 'BMap.Convertor = {};' . "\r\n" . 'BMap.Convertor.translate = translate;' . "\r\n" . '})();' . "\r\n" . '';

?>
